# è¯´è¯´ç¬”è®°

| ![kXN6dnZQIR7lu2B](https://s2.loli.net/2025/12/04/kXN6dnZQIR7lu2B.png) | ![UftWIozH5EC1aQx](https://s2.loli.net/2025/12/04/UftWIozH5EC1aQx.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![sR2nh7I1G8MmvCa](https://s2.loli.net/2025/12/04/sR2nh7I1G8MmvCa.png) | ![jlBtEUaZwfDdgqI](https://s2.loli.net/2025/12/04/jlBtEUaZwfDdgqI.png) |

## ä»‹ç»

åŸºäº [Ech0](https://github.com/lin-snow/Ech0) åŸæ¡†æ¶é­”æ”¹å®Œå–„çš„è½»åšå®¢/æœ‹å‹åœˆå¼ã€Œè¯´è¯´ç¬”è®°ã€ã€‚é¢å‘ä¸ªäººçš„é«˜åº¦è‡ªå®šä¹‰åœºæ™¯ï¼Œå¹¶æä¾›å®Œå–„çš„å¼€æ”¾ API ä¸ MCP æ”¯æŒï¼Œé€‚é…è‡ªåŠ¨åŒ–å¹³å°ä¸ä¸€é”®å‘å¸ƒ/æ›´æ–°/åˆ é™¤/æœç´¢ã€‚é€šè¿‡å†…ç½®ç»„ä»¶ä¸æ‰©å±•èƒ½åŠ›ï¼Œå®ƒæ—¢å¯ä½œä¸ºå†…å®¹ç¬”è®°ï¼Œä¹Ÿå¯ä½œä¸ºè·¨å¹³å°çš„å‘å¸ƒä¸ä¸­è½¬ä¸­å¿ƒã€‚

------

## ç‰¹å¾

- ç»Ÿä¸€çš„å‰ç«¯äº¤äº’ä¸å†…ç½®ç»„ä»¶ä½“éªŒï¼Œæ”¯æŒå¤–éƒ¨æ‰©å±•ã€ç½‘é¡µç»„ä»¶
- å¯è‡ªç”±åˆ‡æ¢å¤šæ é£æ ¼ï¼Œæ”¯æŒä¸‰æ ã€åŒæ ã€å•æ 
- å†…ç½®è¯„è®ºåŠsmtp å‘ä¿¡ï¼Œå®Œå–„çš„åå°æ§åˆ¶ç³»ç»Ÿ
- å‰ç«¯ä¼˜åŒ–å®«æ ¼å›¾ç‰‡ã€é•¿æ–‡æŠ˜å ä¸ç¯ç®±ï¼Œæµç•… Markdown é¢„è§ˆä¸å®«æ ¼å›¾å¡ç‰‡æ¸²æŸ“
- å®Œæ•´å¼€æ”¾ API ä¸ Token è®¤è¯ï¼Œä¾¿äºç¬¬ä¸‰æ–¹æ¥å…¥ä¸è‡ªåŠ¨åŒ–å·¥ä½œæµ
- æ”¯æŒ MCP å·¥å…·ï¼Œåœ¨ AI ç¯å¢ƒä¸­ä¸€é”®å‘å¸ƒ/æ›´æ–°/åˆ é™¤/æœç´¢
- æ¨é€å¢å¼ºï¼Œæ”¯æŒ webhookã€Telegramã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ ç­‰æ¸ é“
- å…¼å®¹è‡ªåŠ¨åŒ–å¹³å°ï¼ˆå¦‚ n8nï¼‰ï¼Œå¯æ„å»ºè¿ç»­çš„ API å·¥ä½œæµ
- å¤šæ•°æ®åº“æ”¯æŒï¼šSQLite / PostgreSQL / MySQL
- æ”¯æŒå¤šå¹³å°éƒ¨ç½²è¿è¡Œï¼Œä¸€é”®dockerè¿è¡ŒåŠfly.ioç­‰å¹³å°è¿è¡Œ

å¿«é€Ÿä¸Šæ‰‹-[å®‰è£…éƒ¨ç½²](#å®‰è£…éƒ¨ç½²)

[TOC]

<details>
<summary><h2>âœ… æ›´æ–°çŠ¶å†µã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>


## 2025æ›´æ–°çŠ¶æ€

- ç»Ÿä¸€ç«¯å£ä¸º1314ï¼Œå‰ç«¯å¼€å‘ã€åç«¯æœåŠ¡ä¸ MCP ä¸‰è€…ååŒ

- å¢å¼ºå¯†ç åˆ¤å®šä¸å…¼å®¹ç­–ç•¥ï¼Œç”¨æˆ·é¦–æ¬¡ç™»å½•æˆåŠŸå¹¶è‡ªåŠ¨å‡çº§

- è°ƒæ•´é¦–é¡µå¸ƒå±€åŠç»„ä»¶æ•ˆæœ

- å¢åŠ ç‚¹èµè®°æ•°åŠå•ç‹¬çš„å…³äºã€å‹é“¾ã€ç•™è¨€é¡µé¢

- ä¸ºå¤šè§†é¢‘æ·»åŠ å®«æ ¼æ˜¾ç¤ºï¼ˆå«HTMLåµŒå…¥ï¼‰

- é‡æ„åå°ç•Œé¢ï¼ˆåŒ…æ‹¬uié‡æ„ã€é…è‰²å¯è‡ªå®šä¹‰ç­‰ï¼‰

- å»ºç«‹å•ç‹¬çš„ç™»å½•æ³¨å†Œé¡µé¢ï¼Œå¢åŠ éªŒè¯æœºåˆ¶ï¼Œå¢åŠ githubä¸€é”®ç™»å½•æ³¨å†Œ

- å¢åŠ å¿˜è®°å¯†ç é‚®ä»¶SMTPå›å¤ç³»ç»Ÿ

- å¢åŠ ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯æƒé™è®¾ç½®ï¼Œå¯è®¾ç½®ç®¡ç†æƒé™å’Œåˆ é™¤ç”¨æˆ·

- å¢åŠ éŸ³ä¹è®¾ç½®ç»„ä»¶ï¼Œå¤–æŒ‚NeteaseCloudMusicApi

- å†…ç½®è¯„è®ºä»£æ›¿è¿œç¨‹è¯„è®ºï¼Œå†…ç½®è¯„è®ºè°ƒç”¨smtpå›å¤è¯„è®º

- å¢åŠ æ•°æ®åº“äº‘å­˜å‚¨R2/S3æ¥å…¥ï¼Œæ”¯æŒå¤‡ä»½ä¸Šæ¬¡ã€è‡ªåŠ¨åŒæ­¥

- å¢åŠ åå°é™„ä»¶ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥ç®¡ç†å·²ä¸Šä¼ çš„å›¾ç‰‡å’Œè§†é¢‘

- MCPåŠŸèƒ½åŠ å…¥ï¼Œæ”¯æŒaiä¸€é”®æ“ä½œæœç´¢ã€å‘å¸ƒã€æ›´æ–°ç­‰

- å®ç° Markdown è¿ç»­å›¾ç‰‡å®«æ ¼æ¸²æŸ“,å°†å›¾ç‰‡è¿ç»­å†™ä¸”ä¸­é—´ä¿ç•™æ¢è¡Œå³å¯è§¦å‘å®«æ ¼ã€‚æ’å…¥æ–‡æœ¬æˆ–å…¶ä»–å…ƒç´ ä¼šå–æ¶ˆå®«æ ¼å¹¶æŒ‰æ­£å¸¸é¢„è§ˆæ˜¾ç¤ºã€‚

- å¢åŠ å†…å®¹ç½®é¡¶åŠŸèƒ½

- å¢åŠ å…¬å‘Šæ ç»„ä»¶

- åå°å¢åŠ æš—é»‘æ¨¡å¼ä¸»é¢˜æ§åˆ¶å¼€å…³ï¼Œå‰ç«¯é¡µé¢æ•´ä½“ç»Ÿä¸€ä¸»é¢˜è‰²ï¼Œä¼˜åŒ–ç¼–è¾‘å™¨ä¸»é¢˜è‰²æ•ˆæœ

- ç²¾ç®€é•œåƒåŒ…ä½“ç§¯å¤§å°ï¼ˆæ— mcpåŒ…æ—¶ï¼‰

- å¢åŠ githubå¡ç‰‡è§£æåå°å¼€å…³ï¼Œä¼˜åŒ–pwaæ¨¡å¼é¡µé¢åŠ è½½

- ç»Ÿä¸€å†…å®¹å¡ç‰‡é¢œè‰²æ¨¡å¼åˆ‡æ¢

- æ–°å¢å…¬å¼€æ¥å£ï¼š /api/messages/search ã€ /api/messages ã€ /api/messages/calendar ã€ /api/status ã€ /api/version/check

- å¢åŠ å†…å®¹åˆ—è¡¨çš„é¢œè‰²æ¨¡å¼å¼€å…³ï¼Œé»˜è®¤æš—é»‘æ¨¡å¼

- ä¿®å¤ç§å¯†å‘å¸ƒåŠŸèƒ½

- ç»Ÿä¸€ç«™ç‚¹ä¸PWAå›¾æ ‡ä¸º/favicon.ico

- å®Œå–„å‰åç«¯åˆ†ç¦»éƒ¨ç½²

- å¢åŠ ç”¨æˆ·æ³¨å†Œé€‰é¡¹å¼€å…³ï¼Œå¯åœ¨åå°é¡µé¢ç½‘ç«™é…ç½®ä¸­è®¾ç½®

- ä¼˜åŒ–é¦–é¡µåˆå§‹åŒ–åŠ è½½é€»è¾‘å’Œé€Ÿåº¦

- å› ç§å¯†å‘å¸ƒå­˜åœ¨é€»è¾‘å†²çªï¼Œæš‚æ—¶å»é™¤ç§å¯†å†…å®¹å‘å¸ƒæŒ‰é’®

- ä¼˜åŒ–å›¾ç‰‡ç¯ç®±æ•ˆæœï¼Œå»é™¤é‡å¤çš„ç¯ç®±ä»£ç ï¼Œä¼˜åŒ–ç‚¹å‡»ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæ—¶çš„åŠ è½½é€»è¾‘å’Œé€Ÿåº¦

- è°ƒæ•´githubå¡ç‰‡æ¸²æŸ“æ—¶æ–‡æœ¬å’Œå¤´åƒçš„å®¹å™¨å¤§å°ï¼Œä¼˜åŒ–å¡ç‰‡æ˜¾ç¤ºæ•ˆæœ

- å¢åŠ githubé“¾æ¥çš„é¢„è§ˆå¡ç‰‡æ¸²æŸ“åŠŸèƒ½

- å¢åŠ å›¾åºŠç»„ä»¶ï¼Œæ”¯æŒå›¾ç‰‡ä¸Šä¼ è‡³github å¹¶å¯è®¾ç½®cdn åŠ é€Ÿ

- å¢åŠ äº†è§†é¢‘é™„ä»¶çš„ä¸Šä¼ è·¯ç”±åŠæ§åˆ¶å›¾æ ‡ï¼Œè°ƒæ•´äº†é™„ä»¶å›¾ç‰‡ã€è§†é¢‘ä¸Šä¼ æ—¶çš„é€»è¾‘ï¼ˆç›´æ¥æ·»åŠ åˆ°ç¼–è¾‘å™¨ä¸­ï¼‰ä¿®å¤äº†ç™»å½•ååˆ·æ–°é¡µé¢æ— æ³•å­˜å‚¨ç™»å½•çŠ¶æ€çš„bug

  æ­¤æ¬¡è°ƒæ•´çš„é™„ä»¶ä¸Šä¼ ä¾æ—§ä¸ºæœ¬åœ°å­˜å‚¨ï¼Œæ¨èNAS ç©å®¶ä½¿ç”¨ï¼Œå…¶å®ƒç”¨æˆ·ä¸æ¨èï¼Œä¼šå ç”¨å¸¦å®½

- ä¿®å¤rssæŒ‡å‘å‰ç«¯åœ°å€bugï¼Œä¿®å¤æ¶ˆæ¯å†…å®¹idæŒ‡å‘é“¾æ¥ä¸èƒ½å®šä½çš„bug

- å¢åŠ å®Œå–„webç»„ä»¶ï¼Œå¯ä»¥åœ¨ä»»æ„ç½‘ç«™å†…åµŒå…¥è¯¥ç»„ä»¶

- å¢åŠ æµè§ˆå™¨æ‰©å±•æ’ä»¶ï¼Œä½äºchromeExpandæ–‡ä»¶å¤¹å†…

- ä¿®å¤æ ‡ç­¾ä¸èƒ½è¢«ç‚¹å‡»çš„bugï¼Œè°ƒæ•´ç‚¹å‡»å‘é€æŒ‰é’®åæç¤ºä¸ºä¸€ä¸ªæç¤ºï¼Œå¢åŠ æœªç™»é™†æ—¶ç‚¹å‘è¡¨çš„ç™»é™†æç¤º

- å¢åŠ ä¸€é”®éƒ¨ç½²æ— æœåŠ¡å™¨å¹³å°-fly.ioã€zeaburã€railway

- å¢åŠ æ‰©å±•-å¿«æ·æŒ‡ä»¤åŠpopclipä¸€é”®å‘å¸ƒå†…å®¹åˆ°ç«™ç‚¹

- å¢åŠ æ¨é€æ¸ é“ï¼ˆwebhookã€tgã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ï¼‰åŠå®ç°ä¸€é”®æ¨é€-ç¼–è¾‘å™¨ç»„ä»¶

- æ·»åŠ æ”¯æŒåŒæ ¼å¼è®¤è¯

  - Authorization: Bearer your_token_here
  - Authorization: your_token_here



- å¢åŠ äº†æ ‡ç­¾ç³»ç»Ÿå’Œå›¾ç‰‡api è·¯ç”±

- å¢åŠ åå°ç³»ç»Ÿç‰ˆæœ¬æ£€æµ‹

- å¢åŠ è¿œç¨‹æ•°æ®åº“PostgreSQLã€MySQLçš„è¿æ¥æ”¯æŒï¼Œé»˜è®¤SQLite

- é™¤äº†session è®¤è¯å¤–å¢åŠ Tokenè®¤è¯ï¼Œåå°å¯è®¾ç½®æ›´æ”¹ï¼Œæ–¹ä¾¿ä½¿ç”¨apiå‘å¸ƒä¿¡æ¯

- å¢åŠ æœç´¢åŠŸèƒ½ç»„ä»¶

- å¢åŠ å†…å®¹å‘å¸ƒæ—¥å†-çƒ­åŠ›å›¾ç»„ä»¶ï¼Œé»˜è®¤ä¸æ˜¾ç¤ºï¼Œç‚¹å‡»æ—¥å†å›¾æ ‡åæ˜¾ç¤º

- æ·»åŠ æ¯æ¡ç¬”è®°æ¡ç›®çš„è¯„è®ºåŠŸèƒ½ï¼ˆå±äºå¤–æŒ‚è¯„è®ºï¼Œå› ä¸ºå®¹æ˜“é›†æˆå’Œçœäº‹ï¼‰

- å¢åŠ mdæ ¼å¼å›¾ç‰‡ä¸‹Fancyboxç¯ç®±æ¨¡å¼ï¼ˆåŒ…æ‹¬ç¼–è¾‘å™¨åŠç¬”è®°åˆ—è¡¨ä¸­ï¼‰ï¼Œå¼•å…¥medium-zoomã€fancyboxç»„ä»¶

- å¢åŠ ç¬”è®°å†…å®¹æ˜¾ç¤ºé«˜åº¦çš„æ˜¾ç¤ºï¼Œè¶…è¿‡700pxæ—¶ä¼šæŠ˜å æ˜¾ç¤º

- å†…å®¹æ¡ç›®ä¸Šæ–¹æ·»åŠ ä¸€é”®å¤åˆ¶åŠŸèƒ½

- å¢åŠ ç¬”è®°å†…å®¹äºŒæ¬¡ç¼–è¾‘ä¿®æ”¹åŠŸèƒ½ï¼ˆç®¡ç†å‘˜æˆ–åŸå‘å¸ƒè€…æƒé™ï¼‰

- ä¼˜åŒ–ç¼–è¾‘å™¨é¢„è§ˆåŠä¿®æ”¹å†…å®¹çš„é¢„è§ˆæ ·å¼

- å¢åŠ ç”Ÿæˆå†…å®¹å¡ç‰‡çš„åŠŸèƒ½

- æ·»åŠ äº†ç¬”è®°å†…å®¹å‘å¸ƒè€…åç§°çš„æ˜¾ç¤ºï¼ˆæ—¶é—´çŠ¶æ€å³ä¾§ï¼‰

- ä¿®æ”¹åˆ é™¤é€»è¾‘ï¼Œå…è®¸å‘å¸ƒè€…åˆ é™¤è‡ªå·±çš„ä¿¡æ¯

- å°†ç®¡ç†å‘˜åˆ¤æ–­é€»è¾‘ç§»åˆ°äº† services å±‚

- è°ƒæ•´åå°ç•Œé¢

- ä¼˜åŒ–è½½å…¥é€Ÿåº¦åŠè°ƒæ•´èƒŒæ™¯å›¾ç‰‡è½½å…¥é€»è¾‘

- ä¼˜åŒ–ç”Ÿæˆå¡ç‰‡å›¾ç‰‡æ•ˆæœ

- å¢åŠ åå°æ•°æ®é…ç½®ï¼ŒåŒ…æ‹¬è¯„è®ºã€åº•éƒ¨é¡µè„šã€rssè®¾ç½®ç­‰

- å¢åŠ æ•°æ®åº“æ–‡ä»¶çš„å¤‡ä»½ã€ä¸Šä¼ 

  

  </details>

  

------

## ğŸš€å®‰è£…éƒ¨ç½²

> ğŸ’¡ éƒ¨ç½²å®Œæˆåè®¿é—® ip:1314 å³å¯ä½¿ç”¨ï¼Œå·²æ·»åŠ é»˜è®¤æµ‹è¯•æ•°æ®ï¼Œç™»å½•åå¯åˆ é™¤ä¿®æ”¹
>
> â€‹    é»˜è®¤ç”¨æˆ·åï¼šadmin
>
> â€‹    é»˜è®¤ç”¨æˆ·å¯†ç ï¼šadmin

## [dockeréƒ¨ç½²](https://hub.docker.com/repository/docker/noise233/echo-noise)

ä¸€é”®éƒ¨ç½²

æ— ä»»ä½•æ•°æ®åº“æŒ‚è½½æ—¶é»˜è®¤ï¼š

```
docker run -d \
  --name Ech0-Noise \
  --platform linux/amd64 \
  -p 1314:1314 \
noise233/echo-noise:latest
```

æœ‰åŸæ•°æ®åº“æ–‡ä»¶æŒ‚è½½æ—¶é»˜è®¤ï¼š

```
docker run -d \
  --name Ech0-Noise \
  --platform linux/amd64 \
  -v /opt/data:/app/data \
  -p 1314:1314 \
noise233/echo-noise:latest
```

### é€‰æ‹©é•œåƒæ ‡ç­¾ç‰ˆæœ¬å¹¶å±•ç¤ºåˆ°åå°

éƒ¨ç½²æ—¶æ˜¾å¼æŒ‡å®šé•œåƒæ ‡ç­¾ç‰ˆæœ¬ï¼š

```
docker run -d \
  --name Ech0-Noise \
  -v /opt/data:/app/data \
  -p 1314:1314 \
  noise233/echo-noise:2025.12.04
```

è¯´æ˜ï¼š
- ä½¿ç”¨ `noise233/echo-noise:<æ ‡ç­¾>` æŒ‡å®šç‰ˆæœ¬ï¼›åå°â€œç³»ç»Ÿç®¡ç†é¢æ¿â€ä¼šæ˜¾ç¤ºå½“å‰é•œåƒç‰ˆæœ¬ã€‚
- å®˜æ–¹é•œåƒå·²å†…ç½®ç‰ˆæœ¬åˆ°å˜é‡ï¼Œè‹¥ä½ è‡ªè¡Œæ„å»ºé•œåƒï¼Œè¯·åœ¨æ„å»ºæ—¶åŠ å…¥ï¼š

```
docker build --target final \
  --build-arg VERSION=2025.12.04 \
  -t noise233/echo-noise:2025.12.04 .
```

æˆ–åœ¨è¿è¡Œæ—¶è¦†ç›–ï¼ˆä»…å½“ä½ ä½¿ç”¨ç¬¬ä¸‰æ–¹é•œåƒæˆ–æœªè®¾ç½®æ„å»ºå‚æ•°æ—¶ï¼‰ï¼š

```
docker run -d \
  -e APP_VERSION=2025.12.04 \
  -p 1314:1314 \
  noise233/echo-noise:2025.12.04
```

docker-compose å›ºå®šé•œåƒæ ‡ç­¾ç¤ºä¾‹ï¼š

```yaml
services:
  ech0-noise:
    image: noise233/echo-noise:2025.12.04
    ports:
      - "1314:1314"
    volumes:
      - /opt/data:/app/data
```

> ä½¿ç”¨ -v /opt/data:/app/data \ å¯æŒ‚è½½ä½ åŸæœ‰çš„æ•°æ®ï¼Œè¯·ç¡®ä¿/opt/dataæ–‡ä»¶å¤¹ä¸­åŒ…å«åŸæ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœ‰å›¾ç‰‡è¯·ä¸€èµ·æ”¾åœ¨dataæ–‡ä»¶å¤¹ä¸‹images æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœæ²¡æœ‰åŸæ•°æ®åº“æ–‡ä»¶è¿˜ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œè¿›å…¥é¡µé¢ä¼šæ— ä»»ä½•å¯ç”¨æ•°æ®æ˜¾ç¤º ä½¿ç”¨ --platform linux/amd64 å‘½ä»¤å¯é€‰æ‹©ä¸åŒæ¶æ„è¿è¡Œéƒ¨ç½²
>

------

è¿è¡Œå¸¦MCP é•œåƒåŒ…ï¼š
æä¾› HTTP/SSEï¼ˆå¯¹å¤–æš´éœ² 1315ï¼Œä¾¿äº curl /æµè§ˆå™¨è°ƒç”¨ MCPï¼‰ï¼š

```
docker run -d \
  --name Ech0-Noise \
  -p 1314:1314 \
  -p 1315:1315 \
  -e NOTE_HOST=http://localhost:1314 \
  -e NOTE_HTTP_PORT=1315 \
  -v /opt/data:/app/data \
  noise233/echo-noise:latest-mcp
```

éªŒè¯ï¼š curl http://<æœåŠ¡å™¨IP>:1315/mcp/tools

ä»…åç«¯ APIï¼ˆä¸å¯¹å¤–æä¾› MCP HTTP/SSEï¼Œåç»­ç”¨ docker exec ä»¥ Stdio è¿æ¥ MCPï¼‰ï¼š

```
docker run -d \
  --name Ech0-Noise \
  -p 1314:1314 \
  -e NOTE_HOST=http://localhost:1314 \
  -e NOTE_HTTP_PORT=0 \
  -v /opt/data:/app/data \
  noise233/echo-noise:latest-mcp
```

## ğŸ‰å·²å‘å¸ƒDockeré•œåƒç‰ˆæœ¬

- ç¨³å®šåŒæ¶æ„é•œåƒç‰ˆï¼šlatest é•œåƒ  åŒæ—¶æ”¯æŒlinux/amd64,linux/arm64ï¼Œæ‹‰å–æ—¶ä¼šç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹© 


- å¸¦MCPåŒæ¶æ„é•œåƒç‰ˆï¼šlatest-mcp é•œåƒ  åŒæ—¶æ”¯æŒlinux/amd64,linux/arm64 


- ç²¾ç®€å•æ¶æ„é•œåƒç‰ˆï¼šlast é•œåƒ  æ”¯æŒlinux/amd64


### docker-componseæ„å»ºéƒ¨ç½²

åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼ˆä¸ä¿®æ”¹ç¯å¢ƒå˜é‡æ—¶é»˜è®¤ä½¿ç”¨æœ¬åœ°æ•°æ®åº“.db æ–‡ä»¶ï¼‰ï¼š

```shell
docker-compose up -d
```

æ— ç¼“å­˜æ„å»º

```
docker compose build --no-cache my-app && docker compose up -d 
```



#### é•œåƒæ„å»ºç›®æ ‡è¯´æ˜

- `final`ï¼ˆä¸å¸¦ MCPï¼Œè½»é‡ï¼‰ï¼šä»…åŒ…å«åç«¯ä¸å‰ç«¯é™æ€èµ„æºï¼Œæ—  Node.js è¿è¡Œæ—¶ã€‚
  - æ‰‹åŠ¨æ„å»ºç¤ºä¾‹ï¼š`docker build -t ech0-noise:nomcp .`
- `final-mcp`ï¼ˆå¸¦ MCPï¼‰ï¼šå®‰è£… `nodejs`ï¼Œå¤åˆ¶ `mcp/server.bundle.mjs`ï¼Œå®¹å™¨å†…åŒæ—¶å¯åŠ¨ MCP ä¸åç«¯ã€‚
  - æ‰‹åŠ¨æ„å»ºç¤ºä¾‹ï¼š`docker build --target final-mcp -t ech0-noise:mcp .`
- æœ¬ä»“åº“çš„ `docker-compose.yml` å·²é»˜è®¤ä½¿ç”¨ `final-mcp`ï¼š
  - å¦‚éœ€ä¸å¸¦ MCPï¼Œè¯·åˆ é™¤æˆ–ä¿®æ”¹ `build.target: final-mcp` ä¸º `final`ã€‚

## æ— æœåŠ¡å™¨å¹³å°+postgreså…è´¹æ•°æ®åº“éƒ¨ç½²

æ•°æ®åº“ä½¿ç”¨ [Neon PostgreSQL](https://console.neon.tech/) äº‘æ•°æ®åº“æœåŠ¡ï¼Œå…¶å®ƒä¹Ÿæ”¯æŒ

è¯·å…ˆå‰å¾€å®˜ç½‘https://console.neon.tech éƒ¨ç½²å¥½ä½ çš„åŸºç¡€æ•°æ®åº“

ä»¥ä¸‹éƒ¨ç½²æ–‡ä»¶å·²æ”¾å…¥æ ¹ç›®å½•ä¸‹çš„noiseæ–‡ä»¶å¤¹å†…

éƒ¨ç½²æˆåŠŸç¤ºä¾‹ï¼š

![SDOAt8BsdIiCzXF](https://s2.loli.net/2025/04/12/SDOAt8BsdIiCzXF.png)

<details>
<summary><h2>âœ… Fly.ioéƒ¨ç½²ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>

### Fly.ioéƒ¨ç½²

fly.toml

```
app = 'ech0-noise'    # ä¿®æ”¹ä¸ºä½ çš„è‡ªå®šä¹‰å®¹å™¨å
primary_region = 'hkg'

[experimental]
  auto_rollback = true

[build]
  image = 'noise233/echo-noise'
  dockerfile = 'Dockerfile'

[env]
  CGO_ENABLED = '1'
  DB_HOST = 'example.aws.neon.tech' # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„HOSTåœ°å€
  DB_NAME = 'noise'        # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„åç§°
  DB_PASSWORD = 'example'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„å¯†ç 
  DB_PORT = '5432'
  DB_SSL_MODE = 'require'
  DB_TYPE = 'postgres'
  DB_USER = 'noise_owner'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„ç”¨æˆ·å
  TZ = 'Asia/Shanghai'

[http_service]
  internal_port = 1314
  force_https = true
  auto_stop_machines = 'stop'
  auto_start_machines = true
  min_machines_running = 0

[[services]]
  protocol = 'tcp'
  internal_port = 1314

  [[services.ports]]
    port = 1314

[[vm]]
  memory = '512mb'
  cpu_kind = 'shared'
  cpus = 1
```

éƒ¨ç½²å‘½ä»¤
åœ¨å‡†å¤‡å¥½ fly.toml æ–‡ä»¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²ä½ çš„åº”ç”¨åˆ° Fly.ioï¼š

#### åˆå§‹åŒ– Fly.io åº”ç”¨ï¼ˆå¦‚æœå°šæœªåˆå§‹åŒ–ï¼‰
`fly launch`

#### éƒ¨ç½²åº”ç”¨
`fly deploy`

ç¡®ä¿ä½ å·²ç»å®‰è£…å¹¶é…ç½®å¥½äº† Fly.io çš„ CLI å·¥å…·ï¼Œå¹¶ä¸”å·²ç»ç™»å½•åˆ°ä½ çš„ Fly.io è´¦å·ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Fly.io CLIï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š

```
curl -L https://fly.io/install.sh | sh
```

å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ `fly auth login` ç™»å½•åˆ°ä½ çš„ Fly.io è´¦å·ã€‚

</details>

<details>
<summary><h2>âœ… Zeaburéƒ¨ç½²ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>
æ–°ç‰ˆzeaburéƒ¨ç½²

ç›´æ¥è¾“å…¥é•œåƒåŒ…åç§°åŠç«¯å£å·å³å¯

![aZU81x6DXFCbQcO](https://s2.loli.net/2025/11/25/aZU81x6DXFCbQcO.jpg)

![RhTzuBgmpt3diVQ](https://s2.loli.net/2025/11/25/RhTzuBgmpt3diVQ.jpg)![qyOCxBEon8AmGJ4](https://s2.loli.net/2025/11/25/qyOCxBEon8AmGJ4.jpg)

zeabur.toml

```
app = "ech0-noise"

[build]
  dockerfile = "Dockerfile"
  image = "noise233/echo-noise"

[env]
  DB_TYPE = "postgres"
  DB_HOST = 'example.aws.neon.tech' # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„HOSTåœ°å€
  DB_PORT = "5432"
  DB_USER = 'noise_owner'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„ç”¨æˆ·å
  DB_PASSWORD = 'example'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„å¯†ç 
  DB_NAME = 'noise'        # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„åç§°
  DB_SSL_MODE = "require"
  CGO_ENABLED = "1"
  TZ = "Asia/Shanghai"

[http_service]
  internal_port = 1314
  force_https = true

[[services]]
  protocol = "tcp"
  internal_port = 1314

  [[services.ports]]
    port = 1314

[[vm]]
  memory = "512mb"
  cpu_kind = "shared"
  cpus = 1
```

#### éƒ¨ç½²å‘½ä»¤ï¼š

```
zeabur deploy
```

</details>

<details>
<summary><h2>âœ… Railwayéƒ¨ç½²ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>

railway.toml

```
app = "ech0-noise"

[build]
  dockerfile = "Dockerfile"
  image = "noise233/echo-noise"

[env]
  DB_TYPE = "postgres"
  DB_HOST = 'example.aws.neon.tech' # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„HOSTåœ°å€
  DB_PORT = "5432"
  DB_USER = 'noise_owner'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„ç”¨æˆ·å
  DB_PASSWORD = 'example'  # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„å¯†ç 
  DB_NAME = 'noise'        # ä¿®æ”¹ä¸ºæ•°æ®åº“çš„åç§°
  DB_SSL_MODE = "require"
  CGO_ENABLED = "1"
  TZ = "Asia/Shanghai"

[service]
  internal_port = 1314
  protocol = "tcp"

[service.ports]
  port = 1314

[vm]
  memory = "512mb"
  cpu_kind = "shared"
  cpus = 1

```

#### éƒ¨ç½²å‘½ä»¤ï¼š

```
railway up
```

![é¢„è§ˆ](https://s2.loli.net/2025/03/25/7gyEspef1ZhOtrH.png)

</details>

æ³¨æ„âš ï¸

å¦‚æœä½ æ˜¯ç›´æ¥åœ¨å¹³å°æ‹‰å–é¡¹ç›®éƒ¨ç½²è€Œä¸æ˜¯é€šè¿‡å‘½ä»¤éƒ¨ç½²ï¼Œä½ éœ€è¦æ‹·è´forkæœ¬é¡¹ç›®å¹¶å°†fly.tomlã€railway.tomlã€zeabur.tomlæ–‡ä»¶æ”¾å…¥æ ¹ç›®å½•ä¸‹æ‰èƒ½ä¸€é”®éƒ¨ç½²

## æ•°æ®åº“è¿æ¥

æœ¬åœ°æ•°æ®åº“ç›´æ¥dockeréƒ¨ç½²å³å¯

è¿œç¨‹æ•°æ®åº“æœåŠ¡åˆ™å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è¿æ¥

è¿æ¥è¿œç¨‹ PostgreSQLï¼š
```bash
docker run -d \
  --name Ech0-Noise \
  --platform linux/amd64 \
  -p 1314:1314 \
  -e DB_TYPE=postgres \
  -e DB_HOST=your.postgres.host \
  -e DB_PORT=5432 \
  -e DB_USER=your_username \
  -e DB_PASSWORD=your_password \
  -e DB_NAME=noise \
  -v /opt/data/images:/app/data/images \
  noise233/echo-noise
```

è¿æ¥è¿œç¨‹ MySQLï¼š
```bash
docker run -d \
  --name Ech0-Noise \
  --platform linux/amd64 \
  -p 1314:1314 \
  -e DB_TYPE=mysql \
  -e DB_HOST=your.mysql.host \
  -e DB_PORT=3306 \
  -e DB_USER=your_username \
  -e DB_PASSWORD=your_password \
  -e DB_NAME=noise \
  -v /opt/data/images:/app/data/images \
  noise233/echo-noise
```

æ³¨æ„äº‹é¡¹ï¼š
1. ç¡®ä¿è¿œç¨‹æ•°æ®åº“å…è®¸å¤–éƒ¨è¿æ¥
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. ä½¿ç”¨æ­£ç¡®çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
4. å»ºè®®ä½¿ç”¨åŠ å¯†è¿æ¥
5. æ³¨æ„æ•°æ®åº“çš„å­—ç¬¦é›†è®¾ç½®

å¯¹äº [Neon PostgreSQL](https://console.neon.tech/) è¿™æ ·çš„äº‘æ•°æ®åº“æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨ç‰¹å®šçš„è¿æ¥å‚æ•°ã€‚ä»¥ä¸‹æ˜¯è¿æ¥å‘½ä»¤ï¼š

```bash
docker run -d \
  --name Ech0-Noise \
  --platform linux/amd64 \
  -p 1314:1314 \
  -e DB_TYPE=postgres \
  -e DB_HOST=your.host \
  -e DB_PORT=5432 \
  -e DB_USER=user_owner \
  -e DB_PASSWORD=password \
  -e DB_NAME=yourname \
  -e DB_SSL_MODE=require \
  -v /opt/data/images:/app/data/images \
  noise233/echo-noise
```

æ³¨æ„äº‹é¡¹ï¼š
1. æ·»åŠ äº† `DB_SSL_MODE=require` ç¯å¢ƒå˜é‡ï¼Œå› ä¸º Neon è¦æ±‚ SSL è¿æ¥
2. ä½¿ç”¨äº†è¿æ¥ URL ä¸­æä¾›çš„ä¸»æœºåã€ç”¨æˆ·åã€å¯†ç å’Œæ•°æ®åº“å
4. ä¿æŒå›¾ç‰‡ç›®å½•çš„æŒ‚è½½

## æ•°æ®çš„å¤‡ä»½æ¢å¤

å¯¹äºæ‰€æœ‰æ•°æ®åº“ç±»å‹ï¼ˆSQLite/PostgreSQL/MySQLï¼‰ï¼Œç‚¹å‡»åå°æ•°æ®åº“ä¸‹è½½æŒ‰é’®åï¼Œéƒ½ä¼šå…ˆå¤‡ä»½æ•°æ®åº“æ–‡ä»¶

- ç„¶åä¼šå°†åŒ…å«æ•°æ®åº“å¤‡ä»½å’Œå›¾ç‰‡æ‰“åŒ…æˆ zip æ–‡ä»¶
- zip æ–‡ä»¶ä¸­ä¼šåŒ…å«ï¼š
  - æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ï¼ˆ.db/.sqlï¼‰
  - images ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡

```plaintext
å¤‡ä»½è¿‡ç¨‹ï¼š
æœ¬åœ° -> æ‰§è¡Œå¤‡ä»½å‘½ä»¤ -> ç”Ÿæˆå¤‡ä»½æ–‡ä»¶ -> æ‰“åŒ…ä¸‹è½½

æ¢å¤è¿‡ç¨‹ï¼š
ä¸Šä¼ å¤‡ä»½æ–‡ä»¶ -> è§£å‹ç¼© -> æ‰§è¡Œæ¢å¤å‘½ä»¤ -> å¯¼å…¥åˆ°äº‘æ•°æ®åº“
```

æ¢å¤è¦æ±‚ï¼š

- SQLiteæœ¬åœ°æ•°æ®åº“å¤‡ä»½å’Œä¸Šä¼ æ—¶é»˜è®¤ä½¿ç”¨çš„æ–‡ä»¶åæ˜¯ä¸€è‡´ä¸ºnoise.db
- éæœ¬åœ°æ•°æ®åº“PostgreSQL/MySQLè¯·å‘½åä¸ºdatabase.sqlå¹¶æ”¾å…¥database.zipæ¥æ¢å¤
- å¦‚æœå¤‡ä»½æ—¶zipä¸­æœ‰å›¾ç‰‡æ–‡ä»¶å¤¹åˆ™åŒæ—¶ä¼šæ¢å¤ images ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡

âš ï¸ ï¼šå› PostgreSQL/MySQLäº‘æœåŠ¡ä¼šæœ‰SSLè¿æ¥ã€å…¼å®¹ç‰ˆæœ¬å·ã€æ•°æ®è¡¨æ ¼å¼ç­‰è¦æ±‚ï¼Œåå°ä¸€é”®å¤‡ä»½æ¢å¤ä¸ä¸€å®šèƒ½æ»¡è¶³ä½ éœ€è¦è¿æ¥çš„è¿œç¨‹æ•°æ®åº“ï¼Œè¯·å°½é‡å‰å¾€æœåŠ¡å•†å¤„ä¸‹è½½å¤‡ä»½

### äº‘å­˜å‚¨åŠŸèƒ½æ¦‚è§ˆ

- äº‘å­˜å‚¨è‡ªåŠ¨åŒæ­¥å¼€å…³ä¸æ¨¡å¼å·²åŠ å…¥â€œäº‘å­˜å‚¨æ¥å…¥ï¼ˆR2/S3ï¼‰â€æ¨¡å—ï¼ŒåŒ…å«ï¼š
  - è‡ªåŠ¨åŒæ­¥å¼€å…³ï¼š è‡ªåŠ¨åŒæ­¥è‡³äº‘ç«¯
  - æ¨¡å¼é€‰æ‹©ï¼š å³æ—¶ æˆ– å®šæ—¶
  - å®šæ—¶é—´éš”ï¼šåˆ†é’Ÿæ•°
  - çŠ¶æ€æ˜¾ç¤ºï¼š ä¸Šæ¬¡åŒæ­¥æ—¶é—´
  - æ“ä½œæŒ‰é’®ï¼š ç«‹å³åŒæ­¥
  - ä½ç½®ï¼š web/components/index/StatusPanel.vue:695-715 ï¼›æ•°æ®åŠ è½½ä¸ä¿å­˜åœ¨ web/components/index/StatusPanel.vue:2663-2690ã€2699-2706ã€2681-2694 ä¸­
    åç«¯å®ç°
- ç«™ç‚¹é…ç½®æ–°å¢å­—æ®µï¼š
  - StorageAutoSyncEnabled ã€ StorageSyncMode ã€ StorageSyncIntervalMinute ã€ StorageLastSyncTime
  - ä½ç½®ï¼š internal/models/models.go:120-144 é™„è¿‘
- é…ç½®è¯»å†™æ”¯æŒä¸Šè¿°å­—æ®µï¼š
  - è¿”å›å‰ç«¯ï¼š internal/services/setting_service.go:85-106 çš„ storageConfig ä¸­å¢åŠ äº† autoSyncEnabled/syncMode/syncIntervalMinute/lastSyncTime
  - ä¿å­˜æ›´æ–°ï¼š internal/services/setting_service.go:342-369 å®Œæˆè§£æä¸èµ‹å€¼
- åŒæ­¥ç®¡ç†å™¨ï¼š
  - åŒ…è·¯å¾„ï¼š internal/syncmanager/auto_sync.go:1-135
  - å³æ—¶æ¨¡å¼ï¼šé˜²æŠ– 15 ç§’è§¦å‘äº‘ç«¯å¤‡ä»½ä¸Šä¼ 
  - å®šæ—¶æ¨¡å¼ï¼šæŒ‰ StorageSyncIntervalMinute å¯åŠ¨ goroutine å‘¨æœŸä»»åŠ¡
  - åŒæ­¥é€»è¾‘ï¼šæ‰“åŒ… backup.zip ï¼ˆå« database.db ã€ images/ ã€ video/ ï¼‰ï¼Œç”¨åç«¯é¢„ç­¾åä¸Šä¼ è‡³ R2/S3ï¼Œå¹¶è®°å½• StorageLastSyncTime
  - é…ç½®å˜æ›´åè‡ªåŠ¨é‡æ–°åº”ç”¨ï¼š internal/services/setting_service.go:433-436
- ç«‹å³åŒæ­¥æ¥å£ä¸è·¯ç”±ï¼š
  - æ§åˆ¶å™¨ï¼š internal/controllers/backup.go:379-401 æ–°å¢ HandleBackupSyncNow
  - è·¯ç”±ï¼š internal/routers/routers.go:156-158 å¢åŠ  POST /api/backup/storage/sync-now
- å³æ—¶æ¨¡å¼è§¦å‘ç‚¹ï¼š
  - å‘å¸ƒä¸æ›´æ–°æ¶ˆæ¯åè§¦å‘åŒæ­¥é˜²æŠ–ï¼š internal/controllers/controllers.go:793-794ã€1410-1412
- å‰ç«¯æ“ä½œï¼š
  - æ‰“å¼€â€œäº‘å­˜å‚¨æ¥å…¥ï¼ˆR2/S3ï¼‰â€
  - å¯ç”¨â€œäº‘å­˜å‚¨æ¥å…¥â€å¼€å…³å¹¶å¡«å†™ provider/endpoint/region/bucket/accessKey/secretKey/publicBaseURL
  - å¼€å¯â€œè‡ªåŠ¨åŒæ­¥è‡³äº‘ç«¯â€ï¼Œé€‰æ‹©æ¨¡å¼ï¼š
    - å³æ—¶ï¼šå¯¹æ¶ˆæ¯å‘å¸ƒ/æ›´æ–°è‡ªåŠ¨è§¦å‘ï¼Œé˜²æŠ–åˆå¹¶ 15 ç§’å†…çš„å˜æ›´
    - å®šæ—¶ï¼šè®¾ç½®é—´éš”åˆ†é’Ÿæ•°ï¼Œåå°æŒ‰é—´éš”è‡ªåŠ¨å¤‡ä»½ä¸Šä¼ 
  - éšæ—¶ç‚¹å‡»â€œç«‹å³åŒæ­¥â€æ‰§è¡Œä¸€æ¬¡ä¸Šä¼ ï¼›â€œä¸Šæ¬¡åŒæ­¥â€æ˜¾ç¤ºæœ€è¿‘æˆåŠŸæ—¶é—´
- åç«¯çº¦æŸï¼š
  - R2 å¼ºåˆ¶è·¯å¾„é£æ ¼ï¼›S3 å¯é€‰è·¯å¾„é£æ ¼ï¼š web/components/index/StatusPanel.vue:682-685ã€2699-2706
  - è‡ªåŠ¨åŒæ­¥ä¾èµ–äº‘å­˜å‚¨å¯ç”¨ä¸å¿…è¦å­—æ®µå®Œæ•´ï¼Œå¦åˆ™ä¸ä¼šå¯åŠ¨
    æ³¨æ„äº‹é¡¹
- R2/S3 æ˜¯å¯¹è±¡å­˜å‚¨ï¼Œä»…ç”¨äºå¤‡ä»½ä¸èµ„æºå­˜å‚¨ï¼›ä¸é€‚åˆä½œä¸ºåœ¨çº¿äº‹åŠ¡æ•°æ®åº“ã€‚è‹¥å¸Œæœ›â€œæ•°æ®åœ¨äº‘ç«¯å³æ—¶å¯è¯»å†™â€ï¼Œå»ºè®®æŠŠ DB_TYPE åˆ‡æ¢è‡³äº‘æ•°æ®åº“ï¼ˆPostgres/MySQLï¼‰ã€‚

## å¼€å‘

<details>
<summary>âœ… æœ¬åœ°å‰åç«¯åˆ†ç¦»ã€ç‚¹å‡»å±•å¼€ã€‘</summary>

æœ¬åœ°å¯åŠ¨ç¤ºä¾‹

- ä¿®æ”¹ä¸ºæœ¬åœ°å¼€å‘é…ç½®ï¼š
  - config/config.yaml:2-8 è®¾ç½®ä¸ºï¼š
    - port: 1314
    - host: "127.0.0.1"
    - database.path: "./data/noise.db"

å¿«é€ŸæŒ‡å¼•

1. ç”Ÿæˆå‰ç«¯é™æ€æ–‡ä»¶

```
cd web
npm run generate
```

ç”Ÿæˆäº§ç‰©è¾“å‡ºåˆ° `web/.output/public`ã€‚

1. åŒæ­¥é™æ€æ–‡ä»¶åˆ°åç«¯ `./public`

```
rsync -a --delete .output/public/ ../public/
# æˆ–è€…
cp -r .output/public ../
```

åç«¯é™æ€æœåŠ¡è¯»å– `./public` ç›®å½•ï¼Œè§ `internal/routers/routers.go:62`ã€‚

1. ä¸€é”®æ‰§è¡Œ

```
bash scripts/build.sh
```

å®Œæˆåè®¿é—® `http://localhost:1314/`ï¼Œæ¥å£ä½äºåŒåŸŸçš„ `/api/*`ã€‚

å‰åç«¯è¯¦ç»†è¯´æ˜

- åŒåŸŸéƒ¨ç½²ï¼ˆæ¨èï¼‰
  - æ„å»ºå‰ç«¯ï¼šåœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œ `bash scripts/build.sh`
  - æ„å»ºäº§ç‰©è¾“å‡ºåˆ°æ ¹ç›®å½• `./public`ï¼Œåç«¯é™æ€æœåŠ¡è¯»å–è¯¥ç›®å½•ï¼Œæ˜ å°„è§ `internal/routers/routers.go:62`
  - æ„å»ºåç«¯ï¼š`go build -o server ./cmd/server/main.go`
  - å¯åŠ¨åç«¯ï¼š`./server`
  - æœåŠ¡åœ°å€ç”±é…ç½®å†³å®šï¼š`config/config.yaml:1-4`ï¼ˆ`host`ã€`port`ã€`mode`ï¼‰ï¼Œåç«¯ç›‘å¬è®¾ç½®è§ `cmd/server/main.go:70-76`
  - éªŒè¯ï¼š
    - é¡µé¢ï¼š`curl http://localhost:1314/ | head -n 20` åº”è¿”å› HTML
    - æ¥å£ï¼š`curl http://localhost:1314/api/status`ã€`curl http://localhost:1314/api/messages/page`
    - å‰ç«¯è„šæœ¬å†…çš„ `baseApi` ä¸º `"/api"`ï¼šå¯åœ¨é¦–é¡µ HTML ä¸­çœ‹åˆ° `window.__NUXT__.config.public.baseApi`
- çœŸæ­£å‰åç«¯åˆ†ç¦»ï¼ˆè·¨åŸŸ/åå‘ä»£ç†ï¼‰
  - å‰ç«¯ï¼šæŒ‰ä¸Šæ–‡ç”Ÿæˆçš„ `./public` éƒ¨ç½²åˆ°å‰ç«¯åŸŸï¼ˆä¾‹å¦‚ `https://note.example.com`ï¼‰æˆ–ç”±åå‘ä»£ç†æ‰˜ç®¡
  - åç«¯ï¼šåœ¨ç‹¬ç«‹ä¸»æœºæˆ–å®¹å™¨æ„å»ºå¹¶è¿è¡Œ `./server`ï¼Œæä¾›æ¥å£åŸŸï¼ˆä¾‹å¦‚ `https://api.example.com`ï¼‰
  - åç«¯è·¨åŸŸï¼šè®¾ç½®ç¯å¢ƒå˜é‡ `CORS_ORIGINS="https://note.example.com"`ï¼ˆæ”¯æŒé€—å·åˆ†éš”å¤šä¸ªæ¥æºï¼‰ï¼Œæ¥æºè§£æä¸åº”ç”¨è§ `internal/routers/routers.go:37-55`
  - å‰ç«¯ä¸æ¥å£å¯¹æ¥ï¼šä¿æŒå‰ç«¯ `baseApi` ä¸º `"/api"`ï¼Œé€šè¿‡å‰ç«¯æœåŠ¡å™¨æˆ–åå‘ä»£ç†å°† `"/api"` è·¯å¾„è½¬å‘åˆ°åç«¯æ¥å£åŸŸ

è¯´æ˜

- ç”Ÿäº§é™æ€æ¨¡å¼è®¿é—®åœ°å€ï¼š`http://localhost:1314/`
- å‰ç«¯é™æ€èµ„æºç›®å½•ï¼š`./public`ï¼ˆæ„å»ºäº§ç‰©ï¼‰
- åç«¯æ¥å£ï¼šåŒåŸŸä¸‹çš„ `/api/*`ï¼Œä¾‹å¦‚ï¼š
  - é…ç½®ï¼š`/api/frontend/config`
  - åˆ—è¡¨åˆ†é¡µï¼š`/api/messages/page`
  - çŠ¶æ€ï¼š`/api/status`

`.env.prod.example`æ¨¡ç‰ˆç¯å¢ƒå˜é‡è¯´æ˜

- å½“ `DB_TYPE=sqlite` æ—¶ï¼Œåç«¯åªä½¿ç”¨ `DB_PATH` æŒ‡å‘ `noise.db` æ–‡ä»¶ï¼›ç¯å¢ƒå˜é‡ä¸­çš„ `DB_USER`ã€`DB_PASSWORD`ã€`DB_HOST` ç­‰ä¸ä¼šç”¨äºè¿æ¥ã€‚
- `DB_USER` / `DB_PASSWORD` ç­‰ä»…åœ¨ `postgres` æˆ– `mysql` ä½œä¸ºæ•°æ®åº“ç±»å‹æ—¶ç”¨äºæ„å»ºè¿æ¥ä¸²ã€‚

- åŸºç¡€
  - `LOG_LEVEL` æ§åˆ¶æ—¥å¿—çº§åˆ«
  - `TZ` è®¾ç½®æ—¶åŒº
- æ•°æ®åº“
  - `DB_TYPE` æ”¯æŒ `sqlite`ã€`postgres`ã€`mysql`
  - `DB_PATH` ä»…åœ¨ `sqlite` æ—¶ç”Ÿæ•ˆï¼›ä»“åº“é»˜è®¤é…ç½®æ–‡ä»¶ä¸º `/app/data/noise.db`ï¼ˆ`config/config.yaml:6-9`ï¼‰ï¼Œæœ¬åœ°äºŒè¿›åˆ¶è¿è¡Œå»ºè®®è®¾ç½®ä¸º `./data/noise.db`
  - `DB_HOST`ã€`DB_PORT`ã€`DB_USER`ã€`DB_PASSWORD`ã€`DB_NAME` å¯¹åº”è¿œç¨‹æ•°æ®åº“è¿æ¥
  - `DB_SSL_MODE`ï¼ˆPostgreSQLï¼‰ï¼šå¸¸ç”¨ `disable` æˆ–äº‘æœåŠ¡è¦æ±‚çš„ `require`
  - `DB_TIMEZONE`ï¼ˆPostgreSQLï¼‰ï¼šå»ºè®® `Asia/Shanghai`
  - `DB_CHARSET`ï¼ˆMySQLï¼‰ï¼šå»ºè®® `utf8mb4`
- è·¨åŸŸ
  - `CORS_ORIGINS` ç•™ç©ºè¡¨ç¤ºä½¿ç”¨é»˜è®¤åŒæºï¼›å¦‚éœ€åˆ†ç¦»å‰åç«¯æˆ–åå‘ä»£ç†åˆ°ä¸åŒåŸŸï¼Œè®¾ç½®é€—å·åˆ†éš”æ¥æºåˆ—è¡¨ï¼Œä¾‹å¦‚ `http://note.example.com`

### åç«¯ä¾èµ–

- è¿è¡Œä¾èµ–å‡çº§ï¼š`go get -u ./...`
- æ•´ç†æ¨¡å—æ–‡ä»¶ï¼š`go mod tidy`

</details>

## APIæŒ‡å—ğŸ§­

å…ˆåˆ°åå°è·å–api token,ç„¶åå¯ä»¥å‚è€ƒä¸‹é¢çš„å‘½ä»¤è¿è¡Œæˆ–ä½¿ç”¨å…¶å®ƒæœåŠ¡ï¼ˆè®°å¾—å°†https://your.localhost.com æ›´æ”¹ä¸ºä½ è‡ªå·±çš„æœåŠ¡åœ°å€ï¼‰

```
# å‘é€çº¯æ–‡æœ¬ä¿¡æ¯
curl -X POST 'https://your.localhost.com/api/token/messages' \
-H 'Content-Type: application/json' \
-H 'Authorization: Bearer c721249bd66e1133fba430ea9e3c32f1' \
-d '{
  "content": "æµ‹è¯•ä¿¡æ¯",
  "type": "text"
}'
```

```
# æ–¹å¼1ï¼šä½¿ç”¨ Markdown è¯­æ³•å‘é€æ–‡æœ¬
curl -X POST 'https://your.localhost.com/api/token/messages' \
-H 'Content-Type: application/json' \
-H 'Authorization: c721249bd66e1133fba430ea9e3c32f1' \
-d '{
  "content": "# æ ‡é¢˜\nè¿™æ˜¯ä¸€æ®µæ–‡å­—\n![å›¾ç‰‡æè¿°](https://example.com/image.jpg)",
  "type": "text"
}'

# æ–¹å¼2ï¼šä½¿ç”¨ type: image å‘é€å›¾ç‰‡æ¶ˆæ¯
curl -X POST 'https://your.localhost.com/api/token/messages' \
-H 'Content-Type: application/json' \
-H 'Authorization: c721249bd66e1133fba430ea9e3c32f1' \
-d '{
  "content": "å›¾ç‰‡æè¿°æ–‡å­—",
  "type": "image",
  "image": "https://example.com/image.jpg"
}'
```

å¦‚æœä½ æƒ³ä½¿ç”¨session è®¤è¯æ–¹å¼

```
curl -v -X POST 'https://your.localhost.com/api/messages' \
-H 'Content-Type: application/json' \
--cookie "your_session_cookie" \
-d '{
  "content": "æµ‹è¯•ä¿¡æ¯",
  "type": "text"
}'
```

å¯¹äºå›¾æ–‡æ··åˆæ¶ˆæ¯ï¼Œå¯ä»¥è¿™æ ·å‘é€ï¼š

```bash
curl -X POST 'https://your.localhost.com/api/token/messages' \
-H 'Content-Type: application/json' \
-H 'Authorization: c721249bd66e1133fba430ea9e3c32f1' \
-d '{
  "content": "# è¿™æ˜¯æ ‡é¢˜\n\nè¿™æ˜¯ä¸€æ®µæ–‡å­—è¯´æ˜\n\n![å›¾ç‰‡æè¿°](https://example.com/image.jpg)\n\nç»§ç»­å†™æ–‡å­—å†…å®¹",
  "type": "text"
}'
```

```
æˆ–è€…ä½¿ç”¨ multipart ç±»å‹ï¼š

curl -X POST 'https://your.localhost.com/api/token/messages' \
-H 'Content-Type: application/json' \
-H 'Authorization: c721249bd66e1133fba430ea9e3c32f1' \
-d '{
  "content": "# è¿™æ˜¯æ ‡é¢˜\n\nè¿™æ˜¯ä¸€æ®µæ–‡å­—è¯´æ˜",
  "type": "multipart",
  "image": "https://example.com/image.jpg"
}
```

<details>
<summary><h2>âœ… APIè¯¦æƒ…ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>

# API æ–‡æ¡£ï¼ˆå¾…å¢åŠ ï¼‰

## å…¬å…±æ¥å£

### 1. è·å–å‰ç«¯é…ç½®
- **è·¯å¾„**: `/api/frontend/config`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–å‰ç«¯é…ç½®ä¿¡æ¯
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/frontend/config
```

### 2. ç”¨æˆ·ç™»å½•
- **è·¯å¾„**: `/api/login`
- **æ–¹æ³•**: POST
- **æè¿°**: ç”¨æˆ·ç™»å½•æ¥å£
- **è¯·æ±‚ä½“**:
```json
{
    "username": "admin",
    "password": "password"
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"password"}'
```

### 3. ç”¨æˆ·æ³¨å†Œ
- **è·¯å¾„**: `/api/register`
- **æ–¹æ³•**: POST
- **æè¿°**: ç”¨æˆ·æ³¨å†Œæ¥å£
- **è¯·æ±‚ä½“**:
```json
{
    "username": "newuser",
    "password": "password",
    "email": "user@example.com"
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/register \
     -H "Content-Type: application/json" \
     -d '{"username":"newuser","password":"password","email":"user@example.com"}'
```

### 4. è·å–ç³»ç»ŸçŠ¶æ€
- **è·¯å¾„**: `/api/status`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/status
```

### 5. æ¶ˆæ¯ç›¸å…³å…¬å…±æ¥å£

#### 5.1 è·å–æ‰€æœ‰æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–æ‰€æœ‰å…¬å¼€æ¶ˆæ¯
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/messages
```

#### 5.2 è·å–å•æ¡æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages/:id`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–æŒ‡å®šIDçš„æ¶ˆæ¯
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/messages/1
```

#### 5.3 åˆ†é¡µè·å–æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages/page`
- **æ–¹æ³•**: POSTæˆ–GET
- **æè¿°**: åˆ†é¡µè·å–æ¶ˆæ¯åˆ—è¡¨
- **è¯·æ±‚ä½“**:
```json
{
    "page": 1,
    "pageSize": 10
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/messages/page \
     -H "Content-Type: application/json" \
     -d '{"page":1,"pageSize":10}'
```

#### 5.4 è·å–æ¶ˆæ¯æ—¥å†æ•°æ®
- **è·¯å¾„**: `/api/messages/calendar`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–æ¶ˆæ¯å‘å¸ƒçƒ­åŠ›å›¾æ•°æ®
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/messages/calendar
```

#### 5.5 æœç´¢æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages/search`
- **æ–¹æ³•**: GET
- **å‚æ•°**: 
  - keyword: æœç´¢å…³é”®è¯
  - page: é¡µç 
  - pageSize: æ¯é¡µæ•°é‡
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl "http://localhost:8080/api/messages/search?keyword=æµ‹è¯•&page=1&pageSize=10"
```

### 6. RSS ç›¸å…³æ¥å£

#### 6.1 è·å– RSS è®¢é˜…
- **è·¯å¾„**: `/rss`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å– RSS è®¢é˜…å†…å®¹
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:1314/rss
```

## éœ€è¦è®¤è¯çš„æ¥å£

### 1. æ¶ˆæ¯æ“ä½œæ¥å£

#### 1.1 å‘å¸ƒæ¶ˆæ¯
- **è·¯å¾„**: `/api/messages`
- **æ–¹æ³•**: POST
- **æè¿°**: å‘å¸ƒæ–°æ¶ˆæ¯
- **è¯·æ±‚ä½“**:
```json
{
    "content": "æ¶ˆæ¯å†…å®¹",
    "private": false,
    "imageURL": ""
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/messages \
     -H "Content-Type: application/json" \
     -H "Cookie: session=xxx" \
     -d '{"content":"æµ‹è¯•æ¶ˆæ¯","private":false}'
```

#### 1.2 æ›´æ–°æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages/:id`
- **æ–¹æ³•**: PUT
- **æè¿°**: æ›´æ–°æŒ‡å®šæ¶ˆæ¯
- **è¯·æ±‚ä½“**:
```json
{
    "content": "æ›´æ–°åçš„å†…å®¹"
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X PUT http://localhost:8080/api/messages/1 \
     -H "Content-Type: application/json" \
     -H "Cookie: session=xxx" \
     -d '{"content":"æ›´æ–°åçš„å†…å®¹"}'
```

#### 1.3 åˆ é™¤æ¶ˆæ¯
- **è·¯å¾„**: `/api/messages/:id`
- **æ–¹æ³•**: DELETE
- **æè¿°**: åˆ é™¤æŒ‡å®šæ¶ˆæ¯
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X DELETE http://localhost:8080/api/messages/1 \
     -H "Cookie: session=xxx"
```

### 2. ç”¨æˆ·ç›¸å…³æ¥å£

#### 2.1 è·å–ç”¨æˆ·ä¿¡æ¯
- **è·¯å¾„**: `/api/user`
- **æ–¹æ³•**: GET
- **æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/user \
     -H "Cookie: session=xxx"
```

#### 2.2 ä¿®æ”¹å¯†ç 
- **è·¯å¾„**: `/api/user/change_password`
- **æ–¹æ³•**: PUT
- **è¯·æ±‚ä½“**:
```json
{
    "oldPassword": "æ—§å¯†ç ",
    "newPassword": "æ–°å¯†ç "
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X PUT http://localhost:8080/api/user/change_password \
     -H "Content-Type: application/json" \
     -H "Cookie: session=xxx" \
     -d '{"oldPassword":"old","newPassword":"new"}'
```

#### 2.3 æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- **è·¯å¾„**: `/api/user/update`
- **æ–¹æ³•**: PUT
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X PUT http://localhost:8080/api/user/update \
     -H "Content-Type: application/json" \
     -H "Cookie: session=xxx" \
     -d '{"username":"newname"}'
```

#### 2.4 é€€å‡ºç™»å½•
- **è·¯å¾„**: `/api/user/logout`
- **æ–¹æ³•**: POST
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/user/logout \
     -H "Cookie: session=xxx"
```

### 3. Token ç›¸å…³æ¥å£

#### 3.1 è·å–ç”¨æˆ· Token
- **è·¯å¾„**: `/api/user/token`
- **æ–¹æ³•**: GET
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/user/token \
     -H "Cookie: session=xxx"
```

#### 3.2 é‡æ–°ç”Ÿæˆ Token
- **è·¯å¾„**: `/api/user/token/regenerate`
- **æ–¹æ³•**: POST
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/user/token/regenerate \
     -H "Cookie: session=xxx"
```

### 4. ç³»ç»Ÿè®¾ç½®æ¥å£

#### 4.1 æ›´æ–°ç³»ç»Ÿè®¾ç½®
- **è·¯å¾„**: `/api/settings`
- **æ–¹æ³•**: PUT
- **è¯·æ±‚ä½“**:
```json
{
    "allowRegistration": true,
    "frontendSettings": {
        "siteTitle": "ç½‘ç«™æ ‡é¢˜",
        "subtitleText": "å‰¯æ ‡é¢˜",
        "avatarURL": "å¤´åƒURL",
        "username": "æ˜¾ç¤ºç”¨æˆ·å",
        "description": "æè¿°",
        "backgrounds": ["èƒŒæ™¯å›¾URL"],
        "cardFooterTitle": "é¡µè„šæ ‡é¢˜",
        "cardFooterLink": "é¡µè„šé“¾æ¥",
        "pageFooterHTML": "é¡µè„šHTML",
        "rssTitle": "RSSæ ‡é¢˜",
        "rssDescription": "RSSæè¿°",
        "rssAuthorName": "RSSä½œè€…",
        "rssFaviconURL": "RSSå›¾æ ‡URL",
        "walineServerURL": "è¯„è®ºç³»ç»ŸURL"
    }
}
```
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X PUT http://localhost:8080/api/settings \
     -H "Content-Type: application/json" \
     -H "Cookie: session=xxx" \
     -d '{"allowRegistration":true,"frontendSettings":{"siteTitle":"æˆ‘çš„ç½‘ç«™"}}'
```

### 5. å¤‡ä»½ç›¸å…³æ¥å£

#### 5.1 ä¸‹è½½å¤‡ä»½
- **è·¯å¾„**: `/api/backup/download`
- **æ–¹æ³•**: GET
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl http://localhost:8080/api/backup/download \
     -H "Cookie: session=xxx" \
     --output backup.sql
```

#### 5.2 æ¢å¤å¤‡ä»½
- **è·¯å¾„**: `/api/backup/restore`
- **æ–¹æ³•**: POST
- **æè¿°**: ä»å¤‡ä»½æ–‡ä»¶æ¢å¤æ•°æ®
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/backup/restore \
     -H "Cookie: session=xxx" \
     -F "file=@backup.sql"
```

### 6. å›¾ç‰‡ä¸Šä¼ æ¥å£

#### 6.1 ä¸Šä¼ å›¾ç‰‡
- **è·¯å¾„**: `/api/images/upload`
- **æ–¹æ³•**: POST
- **æè¿°**: ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
- **ç¤ºä¾‹è¯·æ±‚**:
```bash
curl -X POST http://localhost:8080/api/images/upload \
     -H "Cookie: session=xxx" \
     -F "file=@image.jpg"
```

### 7.æ¨é€é…ç½®è·¯ç”±ä½¿ç”¨è¯´æ˜

#### è·å–æ¨é€é…ç½®

- **è·¯å¾„**: `/api/notify/config`  
- **æ–¹æ³•**: GET  
- **æè¿°**: è·å–å½“å‰æ¨é€æ¸ é“é…ç½®  
- **ç¤ºä¾‹è¯·æ±‚**:

```bash
curl -X GET http://localhost:8080/api/notify/config \
     -H "Cookie: session=xxx"
```

#### ä¿å­˜æ¨é€é…ç½®

- **è·¯å¾„**: `/api/notify/config`  
- **æ–¹æ³•**: PUT  
- **æè¿°**: æ›´æ–°æ¨é€æ¸ é“é…ç½®  
- **è¯·æ±‚ä½“ç¤ºä¾‹**:

```json
{
  "webhookEnabled": true,
  "webhookURL": "https://webhook.example.com",
  "telegramEnabled": true,
  "telegramToken": "bot123:ABC",
  "telegramChatID": "-100123456",
  "weworkEnabled": false,
  "weworkKey": "",
  "feishuEnabled": true,
  "feishuWebhook": "https://open.feishu.cn/xxx",
  "feishuSecret": "signature_key"
}
```

- **ç¤ºä¾‹è¯·æ±‚**:

```bash
curl -X PUT http://localhost:8080/api/notify/config \
     -H "Cookie: session=xxx" \
     -H "Content-Type: application/json" \
     -d '{
           "webhookEnabled": true,
           "webhookURL": "https://webhook.example.com"
         }'
```

#### æµ‹è¯•æ¨é€

- **è·¯å¾„**: `/api/notify/test`  
- **æ–¹æ³•**: POST  
- **æè¿°**: æµ‹è¯•æŒ‡å®šæ¨é€æ¸ é“  
- **è¯·æ±‚ä½“ç¤ºä¾‹**:

```json
{
  "type": "telegram"
}
```

- **ç¤ºä¾‹è¯·æ±‚**:

```bash
curl -X POST http://localhost:8080/api/notify/test \
     -H "Cookie: session=xxx" \
     -H "Content-Type: application/json" \
     -d '{"type": "telegram"}'
```

#### å‘é€æ¨é€

- **è·¯å¾„**: `/api/notify/send`  
- **æ–¹æ³•**: POST  
- **æè¿°**: æ‰‹åŠ¨è§¦å‘æ¨é€ï¼ˆéœ€å·²é…ç½®æ¨é€æ¸ é“ï¼‰  
- **è¯·æ±‚ä½“ç¤ºä¾‹**:

```json
{
  "content": "æµ‹è¯•æ¶ˆæ¯å†…å®¹",
  "images": ["https://example.com/image.jpg"],
  "format": "markdown"
}
```

- **ç¤ºä¾‹è¯·æ±‚**:

```bash
curl -X POST http://localhost:8080/api/notify/send \
     -H "Cookie: session=xxx" \
     -H "Content-Type: application/json" \
     -d '{"content": "ç´§æ€¥é€šçŸ¥ï¼"}'
```

æ³¨æ„äº‹é¡¹ï¼š
1. æ‰€æœ‰éœ€è¦è®¤è¯çš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦æœ‰æ•ˆçš„ session cookie
2. éƒ¨åˆ†æ¥å£å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
3. æ‰€æœ‰è¯·æ±‚ç¤ºä¾‹ä¸­çš„åŸŸåå’Œç«¯å£å·éœ€è¦æ ¹æ®å®é™…éƒ¨ç½²æƒ…å†µè°ƒæ•´
4. æ–‡ä»¶ä¸Šä¼ æ¥å£éœ€è¦ä½¿ç”¨ multipart/form-data æ ¼å¼
5. Token è®¤è¯æ¥å£å¯ä»¥ä½¿ç”¨ Token æ›¿ä»£ session è¿›è¡Œè®¤è¯

</details>

## MCP æ¥å…¥ï¼ˆAI å®¢æˆ·ç«¯ï¼‰

å®Œæ•´çš„ MCP æ“ä½œè¯´æ˜å·²è¿ç§»è‡³å•ç‹¬æ–‡æ¡£ï¼š

[MCP æ“ä½œè¯´æ˜ï¼ˆdocs/mcp.mdï¼‰](docs/mcp.md)

- æ‹‰å–ä¸‹è½½ä»“åº“mcp æ–‡ä»¶å¤¹ï¼Œä¸»æ–‡ä»¶ä¸ºserver.js

- å®‰è£…ç¯å¢ƒä¾èµ–ï¼Œç¡®ä¿æœ¬åœ°å·²å®‰è£… Node

- npm install

  ```
  npm install
  ```

- æ¨èï¼ˆè·¨å¹³å°ï¼‰å†™æ³•ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡å­—æ®µè€Œä¸æ˜¯ `env` å‘½ä»¤

  ```json
  {
    "mcpServers": {
      "ech0-noise-local-stdio": {
        "command": "node",
        "args": ["/ä½ çš„æ–‡ä»¶åœ°å€/server.js"],
        "env": {
          "NOTE_HOST": "http://<æœåŠ¡å™¨IP>:1314",
          "NOTE_HTTP_PORT": "0",
          "NOTE_TOKEN": "<ä½ çš„Token>"
        }
      }
    }
  }
  ```

- å¯é€‰ï¼ˆç±» Unixï¼‰å†™æ³•ï¼šä½¿ç”¨ `env` ä½œä¸ºå‘½ä»¤è®¾ç½®ç¯å¢ƒå†è¿è¡Œ `node`

  ```json
  {
    "mcpServers": {
      "ech0-noise-local-stdio-env": {
        "command": "env",
        "args": [
          "NOTE_HOST=http://<æœåŠ¡å™¨IP>:1314",
          "NOTE_HTTP_PORT=0",
          "NOTE_TOKEN=<ä½ çš„Token>",
          "node",
          "/ä½ çš„æ–‡ä»¶åœ°å€/server.js"
        ]
      }
    }
  }
  ```

- ä½¿ç”¨æœ¬åœ°mcpå®ä¾‹å•ç‹¬è¿è¡Œ

  `docker exec` å¯åŠ¨ `stdio` æ¡æ‰‹çš„å®ä¾‹æ—¶ï¼Œå°† `NOTE_HTTP_PORT` è®¾ä¸º `0`ï¼Œåªè¿›è¡Œæ¡æ‰‹ï¼Œä¸å†ç›‘å¬ HTTP

```json
{
  "mcpServers": {
    "ech0-noise-mcp-stdio": {
      "command": "docker",
      "args": [
        "exec",
        "-i",
        "-e", "NOTE_HOST=http://<æœåŠ¡å™¨IP>:1314",
        "-e", "NOTE_HTTP_PORT=0",
        "-e", "NOTE_TOKEN=<ä½ çš„Token>",
        "Ech0-Noise",
        "node",
        "/app/mcp/server.bundle.mjs"
      ]
    }
  }
}
```

- ä¿ç•™ SSE ç›‘æ§ä»…ç”¨äºäº‹ä»¶è®¢é˜…ï¼Œä¸ä½œä¸ºæ¡æ‰‹è¿æ¥

```json
{
  "mcpServers": {
    "ech0-noise-mcp-sse-monitor": {
      "type": "sse",
      "url": "http://<æœåŠ¡å™¨IP>:1315/mcp/sse"
    }
  }
}
```

### SSE æ¡æ‰‹ä¸ä¿æ´»
- è¿æ¥åˆ° `GET /mcp/sse` åï¼ŒæœåŠ¡ä¼šç«‹å³æ¨é€æ¡æ‰‹äº‹ä»¶ï¼š
  - `event: mcp_hello` æºå¸¦æœåŠ¡åç§°ä¸ç‰ˆæœ¬
  - `event: mcp_tools` æºå¸¦å¯ç”¨å·¥å…·åˆ—è¡¨
  - `event: keepalive` æ¯ 30 ç§’æ¨é€ä¸€æ¬¡ï¼Œä¿æŒè¿æ¥æ´»è·ƒ
- ç¤ºä¾‹ï¼š
  ```bash
  curl -N http://localhost:1315/mcp/sse | head -n 10
  # é¢„æœŸè¾“å‡ºåŒ…å«ï¼š
  # event: mcp_hello
  # data: {"name":"ech0-noise-mcp","version":"0.1.0"}
  # event: mcp_tools
  # data: ["search","publish",...]
  ```
- æç¤ºï¼šSSE ä¾§ä»…æä¾›æ¡æ‰‹ä¿¡å·ä¸è¿è¡Œäº‹ä»¶ï¼›å®Œæ•´çš„ MCP åè®®äº¤äº’ä»é€šè¿‡ `stdio` å®Œæˆã€‚

### å·¥å…·ä¸å‘½ä»¤

- å·¥å…·åç§°ï¼ˆè‹±æ–‡ä¼˜å…ˆï¼‰ï¼š`search`ã€`publish`ã€`delete`ã€`update`ã€`message`ã€`page`ã€`status`ã€`calendar`ã€`config`ã€`login`ã€`token`ã€`rss`
- ä¸­æ–‡åç§°å…¼å®¹ä½†å¯èƒ½è§¦å‘å®¢æˆ·ç«¯æ ¡éªŒè­¦å‘Šï¼š`æœç´¢`ã€`å‘å¸ƒ`ã€`åˆ é™¤`ã€`æ›´æ–°`ã€`æ¶ˆæ¯`ã€`é¡µé¢`ã€`çŠ¶æ€`ã€`æ—¥å†`ã€`é…ç½®`ã€`ç™»å½•`ã€`ä»¤ç‰Œ`ã€`RSS`

#### è®¤è¯è¦æ±‚ä¸æç¤º
- æ— éœ€è®¤è¯ï¼š`search`ã€`page`ã€`message`ã€`status`ã€`calendar`ã€`config`ã€`rss`
- æ”¯æŒä»¤ç‰Œæˆ–ä¼šè¯ï¼š`publish`
- ä»¤ç‰Œæˆ–ä¼šè¯ï¼ˆéœ€åç«¯å¯ç”¨ token è·¯ç”±ï¼‰ï¼š`update`ã€`delete`ã€`pin`ã€`settings`
- æœªç™»å½•æˆ–æ— ä»¤ç‰Œæ—¶å·¥å…·ä¼šç›´æ¥è¿”å›å‹å¥½æç¤ºï¼š
  - `éœ€è¦ç™»å½•æˆ–ä»¤ç‰Œï¼šè¯·å…ˆè°ƒç”¨ ç™»å½• å·¥å…·ï¼Œæˆ–åœ¨é…ç½®ä¸­è®¾ç½® NOTE_TOKENã€‚å‘å¸ƒæ”¯æŒä»¤ç‰Œï¼›æ›´æ–°/åˆ é™¤/ç½®é¡¶/è®¾ç½®æ”¯æŒä»¤ç‰Œï¼ˆéœ€åç«¯å¯ç”¨ï¼‰æˆ–ä¼šè¯è®¤è¯ã€‚`
  - ä»¤ç‰Œæ— æ•ˆï¼š`ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸï¼šè¯·åœ¨åå°é‡æ–°ç”Ÿæˆ tokenï¼Œæˆ–å…ˆ ç™»å½•ã€‚`
  - åç«¯æœªå¯ç”¨ï¼š`åç«¯æœªå¯ç”¨ token è·¯ç”±ï¼šè¯·æ›´æ–°åç«¯å¹¶é‡å¯æœåŠ¡ï¼Œæˆ–ä½¿ç”¨ ç™»å½• è·å–ä¼šè¯åå†æ“ä½œã€‚`

#### å¿«æ·åˆ«åï¼ˆè‡ªç„¶è¯­è¨€æ›´å‹å¥½ï¼‰
- å‘å¸ƒåˆ«åï¼š`ç¬”è®°`ã€`è¯´è¯´`ã€`è¯´è¯´ç¬”è®°`ï¼ˆå‡ç­‰ä»·äº `å‘å¸ƒ`ï¼‰
- ç¤ºä¾‹ï¼š
  ```json
  { "tool": "ç¬”è®°", "params": { "content": "è¿™æ˜¯ä¸€æ®µå†…å®¹", "private": false } }
  { "tool": "è¯´è¯´", "params": { "type": "image", "image": "https://example.com/a.jpg", "content": "é…æ–‡å¯é€‰" } }
  ```

#### é¿å…æœªæ ¼å¼åŒ–çš„è¾“å‡º
- ä¸€äº›å®¢æˆ·ç«¯ä¼šåŸæ ·å±•ç¤ºå·¥å…·è°ƒç”¨æ—¥å¿—ï¼ˆå¦‚ `<tool_use_result>` ç­‰ï¼‰ã€‚å»ºè®®åœ¨æç¤ºè¯­ä¸­æ˜ç¡®è¦æ±‚ï¼š
  - â€œåªè¾“å‡ºè§£æåçš„ä¸­æ–‡åˆ—è¡¨ï¼Œä¸å±•ç¤ºå·¥å…·è°ƒç”¨æ—¥å¿—æˆ–åŸå§‹ JSONï¼Œä¸ä½¿ç”¨ä»»ä½•æœªæ¸²æŸ“æ ‡ç­¾ã€‚â€
  - â€œæŒ‰ä¸­æ–‡åˆ—å‡º idã€ç”¨æˆ·åã€æ—¶é—´ä¸å†…å®¹æ‘˜è¦ã€‚â€

#### æœç´¢ç©ºå‚å›é€€ä¸è¾“å‡ºæ ¼å¼
- å½“ `æœç´¢` æœªæä¾› `keyword/query` æ—¶è‡ªåŠ¨å›é€€åˆ°åˆ†é¡µåˆ—è¡¨ï¼ˆç¬¬ä¸€é¡µï¼‰ï¼Œé¿å…æ ¡éªŒé”™è¯¯
- `æœç´¢/é¡µé¢` ä¼šåŒæ—¶è¿”å›ï¼š
  - å¯è¯»æ‘˜è¦æ–‡æœ¬ï¼ˆ`id/ç”¨æˆ·å/æ—¶é—´/å†…å®¹å‰200å­—`ï¼‰
  - åŸå§‹ JSONï¼ˆä¾¿äºç¨‹åºæ¶ˆè´¹ï¼‰

### Docker ç‹¬ç«‹è¿è¡ŒMCP
1. æ„å»ºé•œåƒï¼š
   ```bash
   cd mcp
   docker build -t ech0-noise-mcp .
   ```
2. ä»¥ Token è®¤è¯è¿è¡Œï¼š
   ```bash
   docker run --rm -e NOTE_HOST=https://note.noisework.cn -e NOTE_TOKEN=ä½ çš„_token ech0-noise-mcp
   ```
3. ä»¥ç”¨æˆ·åå¯†ç è¿è¡Œï¼š
   ```bash
   docker run --rm -e NOTE_HOST=https://note.noisework.cn ech0-noise-mcp
   # åœ¨å®¢æˆ·ç«¯è°ƒç”¨â€œç™»å½•â€å·¥å…·è®¾ç½® Cookie ä¼šè¯
   ```

### docker-compose ä¸€é”®å¯åŠ¨ï¼ˆåç«¯ + å‰ç«¯é™æ€ + MCP åŒå®¹å™¨ï¼‰
ä»“åº“æ ¹ç›®å½•å·²æœ‰ `docker-compose.yml`ã€‚æ‰§è¡Œï¼š
```bash
docker-compose up -d
```
- æœåŠ¡ `my-app`ï¼šåç«¯ Go + å‰ç«¯é™æ€ï¼Œå¹¶å†…ç½® MCP æœåŠ¡ï¼ˆNodeï¼‰ã€‚
- ç«¯å£ï¼šåº”ç”¨ `1314`ã€MCP HTTP/SSE `1315`ï¼ˆçš†æ˜ å°„è‡³å®¿ä¸»ï¼‰ã€‚

æŸ¥çœ‹å·¥å…·åˆ—è¡¨ä¸æµå¼è°ƒç”¨ï¼š
```bash
curl http://localhost:1315/mcp/tools
curl -N -X POST http://localhost:1315/mcp/tool/æœç´¢ -H 'Content-Type: application/json' -d '{"keyword":"#CDN"}'
```

### HTTP ä¸ SSE
- å¼€å¯ HTTP ä¸ SSEï¼šè®¾ç½® `NOTE_HTTP_PORT` å¯åŠ¨æœåŠ¡ç«¯å£
  ```bash
  NOTE_HOST=https://note.noisework.cn \
  NOTE_TOKEN=ä½ çš„_token \
  NOTE_HTTP_PORT=1315 \
  npm start
  ```
- åˆ—å‡ºå·¥å…·ï¼š`GET /mcp/tools`
  ```bash
  curl http://localhost:1315/mcp/tools
  ```
- æµå¼è°ƒç”¨å·¥å…·ï¼š`POST /mcp/tool/{name}` è¿”å›æ¢è¡Œåˆ†éš” JSON
  ```bash
  curl -N -X POST http://localhost:1315/mcp/tool/æœç´¢ \
    -H 'Content-Type: application/json' \
    -d '{"keyword":"#CDN","page":1,"pageSize":10}'
  ```
- SSE è®¢é˜…ï¼š`GET /mcp/sse`ï¼Œæ¨é€ `tool_start`ã€`tool_end`
  ```bash
  curl -N http://localhost:1315/mcp/sse
  ```

#### å‰ç«¯è”åŠ¨
- ç½®é¡¶è”åŠ¨ï¼šå‰ç«¯åˆ—è¡¨ä¼šå°†ç½®é¡¶é¡¹æ’åœ¨é¡¶éƒ¨ï¼Œå–æ¶ˆç½®é¡¶åæŒ‰æ—¶é—´é¡ºåºæ’åˆ—ï¼ˆé€»è¾‘è§ `web/components/index/MessageList.vue:260-264`ï¼‰ã€‚
- æ›´æ–°è”åŠ¨ï¼šä¿®æ”¹å†…å®¹ååˆ—è¡¨å³æ—¶è¯»å–æ›´æ–°ï¼Œæ— éœ€é‡å»ºï¼›è¯¦æƒ…é¡µ `æ¶ˆæ¯` å·¥å…·å¯ç”¨äºéªŒè¯ã€‚
- è®¾ç½®è”åŠ¨ï¼šé€šè¿‡ `settings` æ›´æ–°åç«¯é…ç½®ï¼Œ`é…ç½®` å·¥å…·å¯ç›´æ¥è·å–æœ€æ–°å‰ç«¯é…ç½®ç”¨äºå‰ç«¯æ¸²æŸ“ã€‚

### å¸¸ç”¨å·¥å…·ä¸å…¥å‚
- æœç´¢/`search`ï¼š`{ keyword, page?, pageSize? }`ï¼ˆæ”¯æŒ `#æ ‡ç­¾`ï¼‰
- å‘å¸ƒ/`publish`ï¼š`{ content, private?, imageURL? }`
- åˆ é™¤/`delete`ï¼š`{ id }`
- æ›´æ–°/`update`ï¼š`{ id, content }`
- æ¶ˆæ¯/`æ¶ˆæ¯`ï¼š`{ id }`
- é¡µé¢/`é¡µé¢`ï¼š`{ page?, pageSize? }`
- çŠ¶æ€/`çŠ¶æ€`ï¼šæ— å…¥å‚
- æ—¥å†/`æ—¥å†`ï¼šæ— å…¥å‚
- é…ç½®/`é…ç½®`ï¼šæ— å…¥å‚
- ç™»å½•/`ç™»å½•`ï¼š`{ username, password }`ï¼ˆè®¾ç½® Cookie ä¼šè¯ï¼‰
- ä»¤ç‰Œ/`ä»¤ç‰Œ`ï¼šæ— å…¥å‚ï¼ˆåŸºäºä¼šè¯ç”Ÿæˆæ–° Tokenï¼‰
- RSS/`RSS`ï¼šæ— å…¥å‚ï¼ˆè¿”å›å…¨æ–‡ XMLï¼‰

### ä¸ç°æœ‰ API çš„å¯¹åº”å…³ç³»
- æœç´¢ï¼š`/api/messages/search` æˆ– `/api/messages/tags/:tag`
- å‘å¸ƒï¼š`/api/messages`ï¼ˆä¼šè¯ï¼‰ã€`/api/token/messages`ï¼ˆTokenï¼‰
- åˆ é™¤/æ›´æ–°ï¼š`/api/messages/:id`
- æ¶ˆæ¯ï¼š`/api/messages/:id`
- é¡µé¢ï¼š`/api/messages/page`
- çŠ¶æ€ï¼š`/api/status`
- æ—¥å†ï¼š`/api/messages/calendar`
- é…ç½®ï¼š`/api/frontend/config`
- ç™»å½•ï¼š`/api/login`ï¼ˆè¯»å– `Set-Cookie`ï¼‰
- ä»¤ç‰Œï¼š`/api/user/token/regenerate`
- RSSï¼š`/rss`

------

## ğŸå‘å¸ƒè¯´æ˜

å¦‚æœä½ éœ€è¦æ„å»ºè‡ªå·±çš„é•œåƒå‘å¸ƒ-ç¤ºä¾‹ï¼š

åˆ é™¤ç°æœ‰çš„ `mybuilder` å®ä¾‹ï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼ˆå¦‚æ²¡æœ‰ç°æœ‰å®ä¾‹å¯å¿½ç•¥ï¼‰

```
docker buildx rm mybuilder
docker buildx create --use --name mybuilder
```

ç„¶åå‘å¸ƒ

å¸¸è§„ä¸»é•œåƒï¼ˆä¸å« MCPï¼‰

```
docker buildx build --platform linux/amd64,linux/arm64 --target final -t noise233/echo-noise:latest --push --no-cache .
```

åŒæ—¶æ¨é€ç‰ˆæœ¬æ—¶é—´æ ‡ç­¾ä¸ latest ï¼š

```
docker buildx build --platform linux/amd64,linux/arm64 --target final --build-arg VERSION=2025.12.04 -t noise233/echo-noise:2025.12.04 -t noise233/echo-noise:latest --push --no-cache .
```

å¼€å¯ UPX å‹ç¼©ä»¥ç¡®ä¿é•œåƒæ›´å°ï¼ˆä¸å« MCPï¼‰ï¼š

```
docker buildx build --platform linux/amd64,linux/arm64 --target final --build-arg USE_UPX=1 -t noise233/echo-noise:latest --push --no-cache .
```

åŒ…å«MCPé•œåƒï¼š

```
docker buildx build --platform linux/amd64,linux/arm64 --target final-mcp -t noise233/echo-noise:latest-mcp --push --no-cache .
```

ç²¾ç®€ä¸»é•œåƒå•æ¶æ„amd64ï¼ˆä¸å¸¦ MCPï¼‰ï¼š

```
docker buildx build --platform linux/amd64 --target final --build-arg USE_UPX=1 -t noise233/echo-noise:last --push --no-cache .
```

Podmanï¼ˆæ›¿ä»£Dockerï¼‰

```
podman build --manifest docker.io/noise233/echo-noise:latest --platform linux/amd64,linux/arm64 --no-cache .
```

```
podman manifest push --all docker.io/noise233/echo-noise:latest docker://docker.io/noise233/echo-noise:latest
```

- å¢é‡æ„å»ºä¸ç¼“å­˜æ¨é€ï¼ˆé€‚åˆé¢‘ç¹è¿­ä»£ï¼‰ï¼š
  - ```
    docker buildx build --builder multi --platform linux/amd64,linux/arm64 --target final --pull --build-arg VERSION=$(date +%Y.%m.%d) -t noise233/echo-noise:$(date +%Y.%m.%d) -t noise233/echo-noise:latest --cache-from=type=registry,ref=noise233/echo-noise:buildcache --cache-to=type=registry,ref=noise233/echo-noise:buildcache,mode=max --provenance=false --sbom=false --push --progress=plain .
    ```
  
    
  
- å›ºåŒ–ç‰ˆæœ¬ï¼ˆæ‰‹åŠ¨è®¾å®šç‰ˆæœ¬ï¼Œä¸ç”¨æ—¥æœŸï¼‰ï¼š
  - ```
    docker buildx build --builder multi --platform linux/amd64,linux/arm64 --target final --pull --build-arg VERSION=2025.12.04 -t noise233/echo-noise:2025.12.04 -t noise233/echo-noise:latest --cache-from=type=registry,ref=noise233/echo-noise:buildcache --cache-to=type=registry,ref=noise233/echo-noise:buildcache,mode=max --provenance=false --sbom=false --push --progress=plain .
    ```
  
- --pull ï¼šç¡®ä¿åŸºç¡€é•œåƒæœ€æ–°ï¼Œå‡å°‘åç»­æ¨é€å·®å¼‚ã€‚

- åŒæ ‡ç­¾ -t ...:ç‰ˆæœ¬ -t ...:latest ï¼šä¸€æ¬¡æ€§äº§å‡ºç‰ˆæœ¬ä¸ latest ï¼Œé¿å…é¢å¤–é‡æŒ‡å‘ã€‚

- --cache-from/--cache-to ï¼šåˆ©ç”¨è¿œç«¯ç¼“å­˜ç¼©çŸ­åç»­æ„å»ºæ—¶é—´ï¼›ç¼“å­˜å­˜åˆ°æ³¨å†Œè¡¨ noise233/echo-noise:buildcache ã€‚

- --provenance=false --sbom=false ï¼šå…³é—­è¯æ˜ä¸ SBOM ç”Ÿæˆï¼Œç¼©çŸ­â€œå¯¼å‡ºé•œåƒâ€é˜¶æ®µå¼€é”€ã€‚

- --progress=plain ï¼šå¾—åˆ°æ›´æ¸…æ™°çš„è¾“å‡ºï¼Œå®šä½ç½‘ç»œç“¶é¢ˆæ›´æ–¹ä¾¿ã€‚

- ç§»é™¤ --no-cache ï¼šå…è®¸å¤ç”¨ BuildKit ç¼“å­˜ï¼ˆä½ åœ¨ Dockerfile çš„ Node/Go æ­¥éª¤å·²å¼€å¯ç¼“å­˜æŒ‚è½½ï¼Œæ•ˆæœæ˜¾è‘—ï¼‰ã€‚
å‰ç½®å‡†å¤‡

- ä½¿ç”¨æ”¯æŒå¤šå¹³å°çš„æ„å»ºå™¨å¹¶åˆå§‹åŒ–ï¼š
  - ```
    docker buildx create --name multi --driver docker-container --use
    docker buildx inspect --bootstrap
    ```
  
- ç™»å½•æ³¨å†Œè¡¨å‡å°‘é™æµä¸è®¤è¯äº¤äº’å¤±è´¥ï¼š
  - ```
    docker login
    ```

# Memosæ•°æ®åº“è¿ç§»ç¤ºä¾‹

å…¶ä¸­ï¼Œä½ éœ€è¦è®¾ç½®è®¾ç½®æºæ•°æ®åº“å’Œç›®æ ‡æ•°æ®åº“çš„è·¯å¾„ï¼Œæºæ•°æ®åº“ä¸ºmemos_prod.dbï¼ˆmemosæ•°æ®ï¼‰ç›®æ ‡æ•°æ®åº“ä¸ºdatabase.dbï¼ˆæœ¬ç«™æ•°æ®åº“ï¼‰ï¼Œä½ è¿˜éœ€è¦ä¿®æ”¹æ„å»ºæ’å…¥çš„æ•°æ®ä¸­çš„ç”¨æˆ·åä¸ºä½ è‡ªå·±çš„ç”¨æˆ·åï¼Œåˆ†åˆ«è¿ç§»äº†åŸæ–‡æœ¬å†…å®¹ã€å‘å¸ƒæ—¶é—´ï¼Œå¯ä»¥åœ¨noise/memosè¿ç§»æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°è¯¥è„šæœ¬

ï¼Œè¿è¡Œpython3 main.pyå³å¯ï¼Œ

![1744202949838](https://s2.loli.net/2025/04/09/3yq8aMoOmJHIvlT.png)

è¿ç§»ç»“æŸåå°†ä½ çš„æ•°æ®åº“æ–‡ä»¶å’ŒåŸå›¾ç‰‡æ–‡ä»¶å¤¹ï¼ˆæœ‰çš„è¯ï¼‰æ‰“åŒ…ä¸ºzipæ ¼å¼ï¼Œè¿›å…¥ç«™ç‚¹åå°é€‰æ‹©æ¢å¤æ•°æ®ä¸Šä¼ å³å¯ã€‚

## æ‰©å±•ç»„ä»¶

<details>
<summary><h2>âœ… Popclipå‘é€æ‰©å±•ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>

é€‰ä¸­åè‡ªåŠ¨è¯†åˆ«å®‰è£…ï¼Œå‘é€æ—¶ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªpopclipå¼€å¤´çš„æ ‡ç­¾ï¼Œtokenå¯åœ¨åå°æ‰¾åˆ°

```
// #popclip extension for Send to Shuo
// name: è¯´è¯´ç¬”è®°
// icon: square filled è¯´
// language: javascript
// module: true
// entitlements: [network]
// options: [{
//   identifier: "siteUrl",
//   label: "æœåŠ¡ç«¯åœ°å€",
//   type: "string",
//   defaultValue: "https://note.noisework.cn",
//   description: "è¯·ç¡®ä¿åœ°å€æ­£ç¡®ï¼Œä¸è¦å¸¦æœ«å°¾æ–œæ "
// }, {
//   identifier: "token",
//   label: "API Token",
//   type: "string",
//   description: "ä»è®¾ç½®é¡µé¢è·å–æœ€æ–°Token"
// }]

async function sendToShuo(input, options) {
    try {
        // å‚æ•°é¢„å¤„ç†
        const siteUrl = (options.siteUrl || "").replace(/\/+$/g, "");
        const token = (options.token || "").trim();
        const content = (input.text || "").trim();
        
        // éªŒè¯å‚æ•°
        if (!/^https:\/\/[\w.-]+(:\d+)?$/.test(siteUrl)) {
            throw new Error("åœ°å€æ ¼å¼é”™è¯¯ï¼Œç¤ºä¾‹: https://note.noisework.cn");
        }
        if (!token) throw new Error("Tokenä¸èƒ½ä¸ºç©º");
        if (!content) throw new Error("é€‰ä¸­æ–‡æœ¬ä¸èƒ½ä¸ºç©º");

        // å‘é€è¯·æ±‚
        await sendRequestWithXMLHttpRequest(siteUrl, token, content);
        PopClip.showText("âœ“ å‘é€æˆåŠŸ");
    } catch (error) {
        handleRequestError(error);
    }
}

// ä½¿ç”¨ XMLHttpRequest å®ç°ç½‘ç»œè¯·æ±‚
function sendRequestWithXMLHttpRequest(siteUrl, token, content) {
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        const url = `${siteUrl}/api/token/messages`;

        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Authorization", `Bearer ${token}`);

        xhr.timeout = 10000; // è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆ10ç§’ï¼‰
        
        // è®¾ç½®å›è°ƒå‡½æ•°
        xhr.onreadystatechange = () => {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status >= 200 && xhr.status < 300) {
                    resolve(xhr.responseText);
                } else {
                    let errorMsg = `è¯·æ±‚å¤±è´¥ (${xhr.status})`;
                    try {
                        const data = JSON.parse(xhr.responseText);
                        errorMsg = data.message || errorMsg;
                    } catch {}
                    reject(new Error(errorMsg));
                }
            }
        };

        // å¤„ç†ç½‘ç»œé”™è¯¯
        xhr.onerror = () => reject(new Error("ç½‘ç»œé”™è¯¯"));
        
        // å¤„ç†è¶…æ—¶é”™è¯¯
        xhr.ontimeout = () => reject(new Error("è¯·æ±‚è¶…æ—¶"));

        try {
            // å‘é€è¯·æ±‚
            const payload = JSON.stringify({
                content: `#Popclip\n${content}`,
                type: "text"
            });
            xhr.send(payload);
        } catch (error) {
            reject(new Error("è¯·æ±‚å‘é€å¤±è´¥: " + error.message));
        }
    });
}

// é”™è¯¯å¤„ç†
function handleRequestError(error) {
    console.error("è¯·æ±‚é”™è¯¯:", error);
    
    const errorMap = {
        "Failed to fetch": "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨",
        "aborted": "è¯·æ±‚è¶…æ—¶",
        "ç½‘ç»œé”™è¯¯": "ç½‘ç»œé”™è¯¯",
        "401": "è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥Token",
        "404": "APIåœ°å€ä¸å­˜åœ¨"
    };

    const message = Object.entries(errorMap).find(([key]) => 
        error.message.includes(key)
    )?.[1] || `è¯·æ±‚é”™è¯¯: ${error.message.split('\n')[0].slice(0, 50)}`;

    PopClip.showText(`âŒ ${message}`);
}

exports.actions = [{
    title: "å‘é€è‡³è¯´è¯´ç¬”è®°",
    code: sendToShuo,
    icon: "square filled è¯´"
}];

```

</details>

<details>
<summary><h2>âœ… æµè§ˆå™¨æ‰©å±•</h2></summary>

å‰å¾€[chromeExpand](https://github.com/rcy1314/echo-noise/tree/main/chromeExpand)æŸ¥çœ‹è¯´æ˜ï¼Œå®‰è£…è¯·åœ¨æµè§ˆå™¨æ‰©å±•é¡µé¢ç‚¹å‡»åŠ è½½å·²è§£å‹ç¼©æ–‡ä»¶å¤¹å®‰è£…

</details>

<details>
<summary><h2>âœ… Webç»„ä»¶ç¤ºä¾‹ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>


![](https://s2.loli.net/2025/04/16/uoHIvbq8FXMJSa2.png)

é…ç½®(htmlwidgetså†…)

ä¿®æ”¹å‰ç«¯htmlå³å¯

```
<script>
        window.note = {
            host: 'https://note.noisework.cn', // ä¿®æ”¹ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€
            limit: '10',
            domId: '#note',
            commentServer: 'https://yoursite.com', // ä¿®æ”¹ä¸ºä½ çš„è¯„è®ºæœåŠ¡å™¨åœ°å€
            sourceName: 'ã€Œè¯´è¯´ç¬”è®°ã€' // æ·»åŠ æ¥æºåç§°é…ç½®
        };
```



</details>

<details>
<summary><h2>âœ… ioså¿«æ·æŒ‡ä»¤ã€ç‚¹å‡»æŸ¥çœ‹ã€‘</h2></summary>

ä½¿ç”¨å¿«æ·æŒ‡ä»¤å‘å¸ƒå†…å®¹åˆ°ç«™å†…ï¼Œ[ç‚¹å‡»è·å–](https://www.icloud.com/shortcuts/8ba1240ab39d4bf2b4a02b69a5cc12bf)

![idpz8Ea9DQMfyex](https://s2.loli.net/2025/04/12/idpz8Ea9DQMfyex.png)

</details>

## é—®é¢˜ğŸ™‹

æ•°æ®åº“å¯ä»¥ç›´æ¥è¿ç§»å—

1ã€ç›´æ¥ä¸Šä¼ è‡³éƒ¨ç½²æ—¶æŒ‚è½½çš„è·¯å¾„ä¸­ï¼Œé‡æ–°å¯ç”¨ï¼Œæˆ–è€…åœ¨å®¹å™¨æ–‡ä»¶å¤¹/app/data/noise.dbç›´æ¥æ›¿æ¢å³å¯

2ã€ä½¿ç”¨åå°æ•°æ®åº“ç®¡ç†å¤‡ä»½åŠŸèƒ½ï¼Œæ”¯æŒä¸€é”®ä¸‹è½½ã€ä¸Šä¼ 

â€‹    æ•°æ®åº“æ–‡ä»¶ä¸‹è½½ä¸ºzipæ ¼å¼ï¼Œä¸Šä¼ ä¹Ÿå¿…é¡»ä¸ºzipï¼Œæœ¬åœ°æ•°æ®åº“æ¢å¤åŒ…ä¸­å¿…é¡»æœ‰noise.dbæ–‡ä»¶

## å…³äºé­”æ”¹æŒ‡å—ğŸŒˆ

ğŸ‘‰å¦‚ä½•è‡ªå®šä¹‰åŒ–å‰ç«¯æ•°æ®åæ·»åŠ åˆ°æ•°æ®åº“ï¼Ÿ

éœ€è¦åœ¨setting.goã€migrate.goã€models.goã€controllers.goåŒæ—¶å†™å…¥å‰ç«¯å‚æ•°çš„åç«¯å®šä¹‰ï¼Œå¹¶ä¿®æ”¹å‰ç«¯å‚æ•°ä¿¡æ¯ä¸ºåç«¯å¯è¯»å–çš„å‚æ•°ï¼Œå…¶ä¸­controllers.goä¸ºæ§åˆ¶å™¨

- database.go ç”¨äºæ•°æ®åº“è¿æ¥ç®¡ç†
- migrate.go ç”¨äºæ•°æ®åº“è¿ç§»å’Œæ•°æ®åˆå§‹åŒ–

ğŸ‘‰å‰ç«¯åŸºæœ¬åœ¨webç›®å½•ä¸‹ï¼Œç›®å‰æ¨¡ç‰ˆæ–‡ä»¶ä¸ºcomponentsç›®å½•æ–‡ä»¶ï¼Œpagesä¸‹index.vueä¸ºçˆ¶çº§æ¨¡ç‰ˆ

ğŸ‘‰å»ºè®®ï¼šä¸è¦å’Œæˆ‘ä¸€æ ·åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œä¿®æ”¹æ·»åŠ ï¼Œé€ æˆä¸€ä¸ªæ–‡ä»¶ä¸Šåƒè¡Œä»£ç ...è¯·å°½é‡ä½¿ç”¨çˆ¶å­å±‚çº§æ¥æ·»åŠ ä»£ç 

## To do

> æƒ³è¦çš„ä¸ä¸€å®šå®ç°ï¼Œä½†ä¸‡ä¸€åšæˆäº†å‘¢ï¼

- [x] å¡ç‰‡ç”Ÿæˆçš„ç¾åŒ–
- [x] ä¼˜åŒ–ç¼–è¾‘å™¨
- [x] å¢åŠ å‘å¸ƒçƒ­åŠ›å›¾ç»„ä»¶
- [x] åŠ å…¥æœç´¢åŠŸèƒ½
- [x] postè¯·æ±‚å‘å¸ƒå†…å®¹åˆ°ç«™å†…
- [x] åå°å’Œå‰ç«¯æ•°æ®çš„åŒ¹é…å®Œå–„
- [x] åŠ å…¥æ ‡ç­¾è·¯ç”±åŠç»„ä»¶
- [x] åŠ å…¥ä¸€é”®æ¨é€
- [x] å†…å®¹åŒºåŸŸåˆ‡æ¢äº®æš—æ¨¡å¼
- [x] ç²¾ç®€é•œåƒåŒ…ä½“ç§¯å¤§å°
- [x] å†…å®¹ç½®é¡¶åŠŸèƒ½
- [x] å¢åŠ å…¬å‘Šæ ç»„ä»¶
- [x] å®ç° Markdown è¿ç»­å›¾ç‰‡å®«æ ¼æ¸²æŸ“
- [x] MCPæ¨¡å¼ï¼ˆæœç´¢ã€å†™å…¥ç­‰ï¼‰AIå‘å¸ƒå†™å…¥
- [x] é¡µé¢åŠ è½½è¿‡æ¸¡ä¼˜åŒ–
- [x] åå°å¢åŠ éŸ³ä¹æ¿å—é…ç½®å¹¶é›†æˆåˆ°å‰ç«¯
- [x] å†…ç½®è¯„è®ºç³»ç»Ÿå¹¶å¯é€‰è¿œç¨‹è¯„è®ºç³»ç»Ÿ
- [x] å¢åŠ ç‚¹èµç»„ä»¶ï¼ˆæ¥å…¥SMTPåé¦ˆï¼‰
- [ ] å¢åŠ åœ¨çº¿èŠå¤©ç»„ä»¶ï¼ˆå®æ—¶æ¥æ”¶åé¦ˆã€æ”¯æŒmdå†™æ³•ï¼‰
- [x] å¢åŠ å‹æƒ…é“¾æ¥ç»„ä»¶ï¼ˆåº•éƒ¨æˆ–ä¾§æ ï¼‰
- [ ] å¢åŠ RSSé˜…è¯»ç»„ä»¶ï¼ˆåå°æ§åˆ¶ï¼‰
- [x] å¢åŠ æ—¶é—´æ—¥å†ç»„ä»¶
- [x] å¢åŠ å¹¿å‘Šç»„ä»¶ï¼ˆæ‚¬æµ®æˆ–å›ºå®šï¼‰
- [ ] æ‰©å±•æ”¯æŒä¸€é”®è¯†åˆ«å½“å‰ç½‘ç«™ä¿¡æ¯å¹¶å†™å…¥ç¬”è®°ï¼ˆä¹¦ç­¾æˆ–ç¨åé˜…è¯»ï¼‰
- [ ] è·¨å¹³å°æ¡Œé¢ç«¯
- [x] SQLæ•°æ®åº“æ–‡ä»¶æ”¯æŒä¸€é”®æ¥å…¥R2æˆ–S3å®ç°å¤‡ä»½å’Œæ¢å¤
- [x] ç™»å½•æ³¨å†Œä¼˜åŒ–
- [x] åå°ç•Œé¢çš„uiä¼˜åŒ–å®šåˆ¶
- [ ] å‰ç«¯å¯å®šåˆ¶åŒ–ä¸»é¢˜
- [ ] æ•°æ®åº“å¤‡ä»½ä¼˜åŒ–
- [ ] å…¶å®ƒç»„ä»¶çš„æ·»åŠ 

---

> [!CAUTION]
>
> æœ¬é¡¹ç›®ä¸ºä¸ªäººå®šåˆ¶åŒ–ä½¿ç”¨ï¼Œå¦‚æœ‰å…¶å®ƒéœ€æ±‚å¯è‡ªè¡Œä¿®æ”¹ï¼Œé¡¹ç›®å·²å®Œå…¨é‡æ„
