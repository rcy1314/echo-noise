import{b as At,_ as Sl,a as Bl,N as $l}from"./DDLgJrAu.js";import{m as Pt,n as ve,_ as ot,p as $e,B as It,t as _e,ad as jl,a2 as Al,i as B,C as Lt,D as Be,O as k,v as y,P as t,U as M,a9 as Rt,ae as Pl,z as Ht,W as n,y as Je,T as g,X as U,af as Il,a1 as nt,ag as Ll,Z as ge,$ as xe,Q as s,ah as jt,a3 as Ot,F as f,ai as zt,M as ne,k as Q,w as Ze,aj as Dt,S as it,x as p,L as at,q as He,r as I,c as Rl,h as oe,a4 as Hl,a8 as Ol,aa as zl,H as Dl,G as qe,I as Le,K as Wl,J as ye,ab as Ml}from"./Cqtbhlpx.js";import{u as Wt,_ as rt}from"./ERbK3GVq.js";import{_ as Nl}from"./DxWncjM2.js";import{_ as Kl}from"./qFO9sS9B.js";import{_ as Fl,a as Gl}from"./C9baz-cf.js";const ql={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},st=Pt(ve.ui.strategy,ve.ui.radio,ql),_l=$e({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>st.default.color,validator(i){return ve.ui.colors.includes(i)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(i,{emit:H}){const{ui:A,attrs:x}=It("radio",_e(i,"ui"),st,_e(i,"class")),c=i.id??jl(),V=Al("radio-group",null),{emitFormChange:F,color:b,name:$}=V??Wt(i,st),P=B({get(){return i.modelValue},set(D){H("update:modelValue",D),V||F()}});function o(D){H("change",D.target.value)}const X=B(()=>Lt(Be(A.value.base,A.value.form,A.value.background,A.value.border,b.value&&A.value.ring.replaceAll("{color}",b.value),b.value&&A.value.color.replaceAll("{color}",b.value)),i.inputClass));return{inputId:c,ui:A,attrs:x,pick:P,name:$,inputClass:X,onChange:o}}}),Jl=["data-n-ids"],Zl=["id","name","required","value","disabled"],Ql=["for"];function Xl(i,H,A,x,c,V){return y(),k("div",{class:n(i.ui.wrapper),"data-n-ids":i.attrs["data-n-ids"]},[t("div",{class:n(i.ui.container)},[Rt(t("input",Ht({id:i.inputId,"onUpdate:modelValue":H[0]||(H[0]=F=>i.pick=F),name:i.name,required:i.required,value:i.value,disabled:i.disabled,type:"radio",class:i.inputClass},i.attrs,{onChange:H[1]||(H[1]=(...F)=>i.onChange&&i.onChange(...F))}),null,16,Zl),[[Pl,i.pick]])],2),i.label||i.$slots.label?(y(),k("div",{key:0,class:n(i.ui.inner)},[t("label",{for:i.inputId,class:n(i.ui.label)},[Je(i.$slots,"label",{label:i.label},()=>[g(U(i.label),1)]),i.required?(y(),k("span",{key:0,class:n(i.ui.required)},"*",2)):M("",!0)],10,Ql),i.help||i.$slots.help?(y(),k("p",{key:0,class:n(i.ui.help)},[Je(i.$slots,"help",{help:i.help},()=>[g(U(i.help),1)])],2)):M("",!0)],2)):M("",!0)],10,Jl)}const Yl=ot(_l,[["render",Xl]]),se=Pt(ve.ui.strategy,ve.ui.select,Il),es=$e({components:{UIcon:nt},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>se.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>se.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(i){return Object.keys(se.size).includes(i)}},color:{type:String,default:()=>se.default.color,validator(i){return[...ve.ui.colors,...Object.keys(se.color)].includes(i)}},variant:{type:String,default:()=>se.default.variant,validator(i){return[...Object.keys(se.variant),...Object.values(se.color).flatMap(H=>Object.keys(H))].includes(i)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(i,{emit:H,slots:A}){const{ui:x,attrs:c}=It("select",_e(i,"ui"),se,_e(i,"class")),{size:V,rounded:F}=Ll({ui:x,props:i}),{emitFormChange:b,inputId:$,color:P,size:o,name:X}=Wt(i,se),D=B(()=>V.value??o.value),ie=z=>{H("update:modelValue",z.target.value)},S=z=>{H("change",z.target.value),b()},R=z=>jt(z,i.valueAttribute,""),r=z=>jt(z,i.optionAttribute,""),O=z=>["string","number","boolean"].includes(typeof z)?{[i.valueAttribute]:z,[i.optionAttribute]:z}:{...z,[i.valueAttribute]:R(z),[i.optionAttribute]:r(z)},E=B(()=>i.options.map(z=>O(z))),j=B(()=>i.placeholder?[{[i.valueAttribute]:"",[i.optionAttribute]:i.placeholder,disabled:!0},...E.value]:E.value),G=B(()=>{const z=O(i.modelValue),fe=j.value.find(Ce=>Ce[i.valueAttribute]===z[i.valueAttribute]);return fe?fe[i.valueAttribute]:""}),w=B(()=>{var fe,Ce;const z=((Ce=(fe=x.value.color)==null?void 0:fe[P.value])==null?void 0:Ce[i.variant])||x.value.variant[i.variant];return Lt(Be(x.value.base,x.value.form,F.value,x.value.size[D.value],i.padded?x.value.padding[D.value]:"p-0",z==null?void 0:z.replaceAll("{color}",P.value),(v.value||A.leading)&&x.value.leading.padding[D.value],(ae.value||A.trailing)&&x.value.trailing.padding[D.value]),i.placeholder&&!i.modelValue&&x.value.placeholder,i.selectClass)}),v=B(()=>i.icon&&i.leading||i.icon&&!i.trailing||i.loading&&!i.trailing||i.leadingIcon),ae=B(()=>i.icon&&i.trailing||i.loading&&i.trailing||i.trailingIcon),re=B(()=>i.loading?i.loadingIcon:i.leadingIcon||i.icon),he=B(()=>i.loading&&!v.value?i.loadingIcon:i.trailingIcon||i.icon),ke=B(()=>Be(x.value.icon.leading.wrapper,x.value.icon.leading.pointer,x.value.icon.leading.padding[D.value])),je=B(()=>Be(x.value.icon.base,P.value&&ve.ui.colors.includes(P.value)&&x.value.icon.color.replaceAll("{color}",P.value),x.value.icon.size[D.value],i.loading&&x.value.icon.loading)),Ve=B(()=>Be(x.value.icon.trailing.wrapper,x.value.icon.trailing.pointer,x.value.icon.trailing.padding[D.value])),J=B(()=>Be(x.value.icon.base,P.value&&ve.ui.colors.includes(P.value)&&x.value.icon.color.replaceAll("{color}",P.value),x.value.icon.size[D.value],i.loading&&!v.value&&x.value.icon.loading));return{ui:x,attrs:c,name:X,inputId:$,normalizedOptionsWithPlaceholder:j,normalizedValue:G,isLeading:v,isTrailing:ae,selectClass:w,leadingIconName:re,leadingIconClass:je,leadingWrapperIconClass:ke,trailingIconName:he,trailingIconClass:J,trailingWrapperIconClass:Ve,onInput:ie,onChange:S}}}),ts=["id","name","value","required","disabled"],ls=["value","label"],ss=["value","selected","disabled","textContent"],as=["value","selected","disabled","textContent"];function os(i,H,A,x,c,V){const F=nt;return y(),k("div",{class:n(i.ui.wrapper)},[t("select",Ht({id:i.inputId,name:i.name,value:i.modelValue,required:i.required,disabled:i.disabled,class:i.selectClass},i.attrs,{onInput:H[0]||(H[0]=(...b)=>i.onInput&&i.onInput(...b)),onChange:H[1]||(H[1]=(...b)=>i.onChange&&i.onChange(...b))}),[(y(!0),k(ge,null,xe(i.normalizedOptionsWithPlaceholder,(b,$)=>(y(),k(ge,null,[b.children?(y(),k("optgroup",{key:`${b[i.valueAttribute]}-optgroup-${$}`,value:b[i.valueAttribute],label:b[i.optionAttribute]},[(y(!0),k(ge,null,xe(b.children,(P,o)=>(y(),k("option",{key:`${P[i.valueAttribute]}-${$}-${o}`,value:P[i.valueAttribute],selected:P[i.valueAttribute]===i.normalizedValue,disabled:P.disabled,textContent:U(P[i.optionAttribute])},null,8,ss))),128))],8,ls)):(y(),k("option",{key:`${b[i.valueAttribute]}-${$}`,value:b[i.valueAttribute],selected:b[i.valueAttribute]===i.normalizedValue,disabled:b.disabled,textContent:U(b[i.optionAttribute])},null,8,as))],64))),256))],16,ts),i.isLeading&&i.leadingIconName||i.$slots.leading?(y(),k("span",{key:0,class:n(i.leadingWrapperIconClass)},[Je(i.$slots,"leading",{disabled:i.disabled,loading:i.loading},()=>[s(F,{name:i.leadingIconName,class:n(i.leadingIconClass)},null,8,["name","class"])],!0)],2)):M("",!0),i.isTrailing&&i.trailingIconName||i.$slots.trailing?(y(),k("span",{key:1,class:n(i.trailingWrapperIconClass)},[Je(i.$slots,"trailing",{disabled:i.disabled,loading:i.loading},()=>[s(F,{name:i.trailingIconName,class:n(i.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):M("",!0)],2)}const dt=ot(es,[["render",os],["__scopeId","data-v-db8f1118"]]),ns=()=>{const i=Ot(),H=f(),A=zt(),x=async()=>{const $=await i.getStatus();return $&&i.setUserStatus($),$},c=async $=>{await i.register($)&&H.add({title:"注册成功",description:"欢迎使用！请登录",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3})},V=async $=>{await i.login($)&&(await x(),H.add({title:"登录成功",description:"欢迎回来！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}))},F=async()=>{await i.logout(),i.clearUserStatus(),H.add({title:"注销成功",description:"欢迎再次使用！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),A.push("/")},b=async()=>await x();return ne(async()=>{await x()}),{register:c,login:V,logout:F,getStatus:b}},is={class:"rounded-lg p-4 mb-6"},rs={class:"flex justify-between items-center mb-4"},ds={class:"flex justify-between items-center mb-2"},us={class:"flex items-center gap-2"},cs={key:0,class:"space-y-2"},ms={class:"flex justify-end gap-2"},ps={class:"flex justify-between items-center mb-2"},gs={class:"flex items-center gap-2"},vs={key:0,class:"space-y-2"},fs={class:"flex justify-end gap-2"},bs={class:"flex justify-between items-center mb-2"},ws={class:"flex items-center gap-2"},ys={key:0,class:"space-y-2"},xs={class:"flex justify-end gap-2"},hs={class:"flex justify-between items-center mb-2"},ks={class:"flex items-center gap-2"},Vs={key:0,class:"space-y-2"},Cs={class:"flex justify-end gap-2"},Us={class:"flex justify-between items-center mb-2"},Ts={class:"flex items-center gap-2"},Es={key:0,class:"space-y-2"},Ss={class:"flex justify-end gap-2"},Bs={class:"flex justify-between items-center mb-2"},$s={class:"flex items-center gap-2"},js={key:0,class:"space-y-2"},As={class:"flex justify-end gap-2"},Ps=$e({__name:"NotifyPanel",props:{config:{},immediate:{type:Boolean},subtleBg:{},text:{},mutedText:{},disabled:{type:Boolean}},emits:["save"],setup(i,{emit:H}){const A=H,x=i,c=Q({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:"",twitterEnabled:!1,twitterApiKey:"",twitterApiSecret:"",twitterAccessToken:"",twitterAccessTokenSecret:"",customHttpEnabled:!1,customHttpUrl:"",customHttpMethod:"POST",customHttpHeaders:"",customHttpBody:'{"content":"{{content}}"}'}),V=Q({webhook:!1,telegram:!1,wework:!1,feishu:!1,twitter:!1,customHttp:!1}),F=["webhook","telegram","wework","feishu","twitter","customHttp"],b=R=>({webhook:"Webhook",telegram:"Telegram",wework:"企业微信",feishu:"飞书",twitter:"Twitter",customHttp:"自定义HTTP"})[R]||R,$=R=>{const r=R.toLowerCase();Object.keys(c).forEach(O=>{O.toLowerCase().startsWith(r)&&(c[O]=x.config[O])}),V[R]=!1},P=R=>{var O,E,j,G,w,v,ae,re,he,ke;const r=c;switch(R){case"webhook":return r.webhookEnabled&&!!((O=r.webhookURL)!=null&&O.trim());case"telegram":return r.telegramEnabled&&!!((E=r.telegramToken)!=null&&E.trim())&&!!((j=r.telegramChatID)!=null&&j.trim());case"wework":return r.weworkEnabled&&!!((G=r.weworkKey)!=null&&G.trim());case"feishu":return r.feishuEnabled&&!!((w=r.feishuWebhook)!=null&&w.trim());case"twitter":return r.twitterEnabled&&!!((v=r.twitterApiKey)!=null&&v.trim())&&!!((ae=r.twitterApiSecret)!=null&&ae.trim())&&!!((re=r.twitterAccessToken)!=null&&re.trim())&&!!((he=r.twitterAccessTokenSecret)!=null&&he.trim());case"customHttp":return r.customHttpEnabled&&!!((ke=r.customHttpUrl)!=null&&ke.trim());default:return!1}},o=async R=>{try{switch(R){case"webhook":if(c.webhookEnabled&&!c.webhookURL)throw new Error("Webhook URL不能为空");break;case"telegram":if(c.telegramEnabled&&(!c.telegramToken||!c.telegramChatID))throw new Error("Telegram配置不完整");break;case"wework":if(c.weworkEnabled&&!c.weworkKey)throw new Error("企业微信Key不能为空");break;case"feishu":if(c.feishuEnabled&&!c.feishuWebhook)throw new Error("飞书Webhook不能为空");break;case"twitter":if(c.twitterEnabled&&(!c.twitterApiKey||!c.twitterApiSecret||!c.twitterAccessToken||!c.twitterAccessTokenSecret))throw new Error("Twitter配置不完整");break;case"customHttp":if(c.customHttpEnabled&&!c.customHttpUrl)throw new Error("自定义HTTP URL不能为空");break}const r={webhookEnabled:c.webhookEnabled,webhookURL:c.webhookURL,telegramEnabled:c.telegramEnabled,telegramToken:c.telegramToken,telegramChatID:c.telegramChatID,weworkEnabled:c.weworkEnabled,weworkKey:c.weworkKey,feishuEnabled:c.feishuEnabled,feishuWebhook:c.feishuWebhook,feishuSecret:c.feishuSecret,twitterEnabled:c.twitterEnabled,twitterApiKey:c.twitterApiKey,twitterApiSecret:c.twitterApiSecret,twitterAccessToken:c.twitterAccessToken,twitterAccessTokenSecret:c.twitterAccessTokenSecret,customHttpEnabled:c.customHttpEnabled,customHttpUrl:c.customHttpUrl,customHttpMethod:c.customHttpMethod,customHttpHeaders:c.customHttpHeaders,customHttpBody:c.customHttpBody},O=at().public.baseApi||"/api",j=await(await fetch(`${O}/notify/config`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)})).json();if(j.code===1)V[R]=!1,j.data&&Object.keys(j.data).forEach(G=>{G.endsWith("Enabled")?c[G]=!!j.data[G]&&j.data[G]!=="false":c[G]=j.data[G]||""}),A("save",{...c}),f().add({title:"成功",description:`${b(R)}配置已保存`,color:"green"});else throw new Error(j.msg||"保存失败")}catch(r){console.error("保存配置失败:",r),f().add({title:"错误",description:r.message||"保存失败",color:"red"})}},X=async R=>{try{if(!P(R))throw new Error(`请先完成并启用${b(R)}配置`);const O=await(await fetch("/api/notify/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:R})})).json();if(O.code===1)f().add({title:"成功",description:`${b(R)}测试消息已发送`,color:"green"});else throw new Error(O.msg||"测试失败")}catch(r){console.error("测试失败:",r),f().add({title:"错误",description:r.message||"测试失败",color:"red"})}};Ze(()=>x.config,R=>{R&&Object.keys(c).forEach(r=>{R[r]!==void 0&&(r.endsWith("Enabled")?c[r]=!!R[r]&&R[r]!=="false":c[r]=R[r])})},{deep:!0,immediate:!0}),ne(async()=>{try{const r=await(await fetch("/api/notify/config",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();if(r.code===1&&r.data){const O=r.data;Object.keys(O).forEach(E=>{E.endsWith("Enabled")?c[E]=!!O[E]&&O[E]!=="false":c[E]=O[E]||""}),console.log("加载的配置:",c)}}catch(R){console.error("获取配置失败:",R),f().add({title:"错误",description:"获取推送配置失败",color:"red"})}});const D=B(()=>x.subtleBg||"bg-gray-800"),ie=B(()=>x.text||"text-white"),S=B(()=>x.mutedText||"text-gray-300");return(R,r)=>{const O=Dt("USwitch"),E=it,j=rt,G=dt,w=At;return y(),k("div",is,[t("div",rs,[t("h2",{class:n(["text-xl font-semibold",ie.value])},"推送渠道配置",2)]),t("div",{class:n(["space-y-4",x.disabled?"opacity-60 pointer-events-none":""])},[t("div",{class:n(["rounded p-3",D.value])},[t("div",ds,[t("span",{class:n(S.value)},"Webhook推送",2),t("div",us,[s(O,{modelValue:c.webhookEnabled,"onUpdate:modelValue":r[0]||(r[0]=v=>c.webhookEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[1]||(r[1]=v=>V.webhook=!V.webhook),color:V.webhook?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.webhook?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.webhook?(y(),k("div",cs,[s(j,{modelValue:c.webhookURL,"onUpdate:modelValue":r[2]||(r[2]=v=>c.webhookURL=v),placeholder:"Webhook URL"},null,8,["modelValue"]),t("div",ms,[s(E,{onClick:r[3]||(r[3]=v=>$("webhook")),variant:"ghost",color:"gray"},{default:p(()=>r[38]||(r[38]=[g(" 重置 ")])),_:1}),s(E,{onClick:r[4]||(r[4]=v=>o("webhook")),color:"primary"},{default:p(()=>r[39]||(r[39]=[g(" 保存 ")])),_:1})])])):M("",!0)],2),t("div",{class:n(["rounded p-3",D.value])},[t("div",ps,[t("span",{class:n(S.value)},"Telegram推送",2),t("div",gs,[s(O,{modelValue:c.telegramEnabled,"onUpdate:modelValue":r[5]||(r[5]=v=>c.telegramEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[6]||(r[6]=v=>V.telegram=!V.telegram),color:V.telegram?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.telegram?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.telegram?(y(),k("div",vs,[s(j,{modelValue:c.telegramToken,"onUpdate:modelValue":r[7]||(r[7]=v=>c.telegramToken=v),placeholder:"Bot Token"},null,8,["modelValue"]),s(j,{modelValue:c.telegramChatID,"onUpdate:modelValue":r[8]||(r[8]=v=>c.telegramChatID=v),placeholder:"Chat ID"},null,8,["modelValue"]),t("div",fs,[s(E,{onClick:r[9]||(r[9]=v=>$("telegram")),variant:"ghost",color:"gray"},{default:p(()=>r[40]||(r[40]=[g(" 重置 ")])),_:1}),s(E,{onClick:r[10]||(r[10]=v=>o("telegram")),color:"primary"},{default:p(()=>r[41]||(r[41]=[g(" 保存 ")])),_:1})])])):M("",!0)],2),t("div",{class:n(["rounded p-3",D.value])},[t("div",bs,[t("span",{class:n(S.value)},"企业微信推送",2),t("div",ws,[s(O,{modelValue:c.weworkEnabled,"onUpdate:modelValue":r[11]||(r[11]=v=>c.weworkEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[12]||(r[12]=v=>V.wework=!V.wework),color:V.wework?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.wework?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.wework?(y(),k("div",ys,[s(j,{modelValue:c.weworkKey,"onUpdate:modelValue":r[13]||(r[13]=v=>c.weworkKey=v),placeholder:"WebHook Key"},null,8,["modelValue"]),t("div",xs,[s(E,{onClick:r[14]||(r[14]=v=>$("wework")),variant:"ghost",color:"gray"},{default:p(()=>r[42]||(r[42]=[g(" 重置 ")])),_:1}),s(E,{onClick:r[15]||(r[15]=v=>o("wework")),color:"primary"},{default:p(()=>r[43]||(r[43]=[g(" 保存 ")])),_:1})])])):M("",!0)],2),t("div",{class:n(["rounded p-3",D.value])},[t("div",hs,[t("span",{class:n(S.value)},"飞书推送",2),t("div",ks,[s(O,{modelValue:c.feishuEnabled,"onUpdate:modelValue":r[16]||(r[16]=v=>c.feishuEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[17]||(r[17]=v=>V.feishu=!V.feishu),color:V.feishu?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.feishu?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.feishu?(y(),k("div",Vs,[s(j,{modelValue:c.feishuWebhook,"onUpdate:modelValue":r[18]||(r[18]=v=>c.feishuWebhook=v),placeholder:"WebHook URL"},null,8,["modelValue"]),s(j,{modelValue:c.feishuSecret,"onUpdate:modelValue":r[19]||(r[19]=v=>c.feishuSecret=v),placeholder:"签名密钥",type:"password"},null,8,["modelValue"]),t("div",Cs,[s(E,{onClick:r[20]||(r[20]=v=>$("feishu")),variant:"ghost",color:"gray"},{default:p(()=>r[44]||(r[44]=[g(" 重置 ")])),_:1}),s(E,{onClick:r[21]||(r[21]=v=>o("feishu")),color:"primary"},{default:p(()=>r[45]||(r[45]=[g(" 保存 ")])),_:1})])])):M("",!0)],2),t("div",{class:n(["rounded p-3",D.value])},[t("div",Us,[t("span",{class:n(S.value)},"Twitter推送",2),t("div",Ts,[s(O,{modelValue:c.twitterEnabled,"onUpdate:modelValue":r[22]||(r[22]=v=>c.twitterEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[23]||(r[23]=v=>V.twitter=!V.twitter),color:V.twitter?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.twitter?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.twitter?(y(),k("div",Es,[s(j,{modelValue:c.twitterApiKey,"onUpdate:modelValue":r[24]||(r[24]=v=>c.twitterApiKey=v),placeholder:"API Key"},null,8,["modelValue"]),s(j,{modelValue:c.twitterApiSecret,"onUpdate:modelValue":r[25]||(r[25]=v=>c.twitterApiSecret=v),placeholder:"API Secret"},null,8,["modelValue"]),s(j,{modelValue:c.twitterAccessToken,"onUpdate:modelValue":r[26]||(r[26]=v=>c.twitterAccessToken=v),placeholder:"Access Token"},null,8,["modelValue"]),s(j,{modelValue:c.twitterAccessTokenSecret,"onUpdate:modelValue":r[27]||(r[27]=v=>c.twitterAccessTokenSecret=v),placeholder:"Access Token Secret"},null,8,["modelValue"]),t("div",Ss,[s(E,{onClick:r[28]||(r[28]=v=>$("twitter")),variant:"ghost",color:"gray"},{default:p(()=>r[46]||(r[46]=[g("重置")])),_:1}),s(E,{onClick:r[29]||(r[29]=v=>o("twitter")),color:"primary"},{default:p(()=>r[47]||(r[47]=[g("保存")])),_:1})])])):M("",!0)],2),t("div",{class:n(["rounded p-3",D.value])},[t("div",Bs,[t("span",{class:n(S.value)},"自定义HTTP推送",2),t("div",$s,[s(O,{modelValue:c.customHttpEnabled,"onUpdate:modelValue":r[30]||(r[30]=v=>c.customHttpEnabled=v)},null,8,["modelValue"]),s(E,{size:"sm",onClick:r[31]||(r[31]=v=>V.customHttp=!V.customHttp),color:V.customHttp?"gray":"primary",variant:"soft"},{default:p(()=>[g(U(V.customHttp?"取消":"编辑"),1)]),_:1},8,["color"])])]),V.customHttp?(y(),k("div",js,[s(j,{modelValue:c.customHttpUrl,"onUpdate:modelValue":r[32]||(r[32]=v=>c.customHttpUrl=v),placeholder:"请求URL"},null,8,["modelValue"]),s(G,{modelValue:c.customHttpMethod,"onUpdate:modelValue":r[33]||(r[33]=v=>c.customHttpMethod=v),options:["POST","PUT","PATCH"]},null,8,["modelValue"]),s(w,{modelValue:c.customHttpHeaders,"onUpdate:modelValue":r[34]||(r[34]=v=>c.customHttpHeaders=v),placeholder:"请求Headers（JSON格式）"},null,8,["modelValue"]),s(w,{modelValue:c.customHttpBody,"onUpdate:modelValue":r[35]||(r[35]=v=>c.customHttpBody=v),placeholder:'请求Body模板（如：{"content":"{{content}}"})'},null,8,["modelValue"]),t("div",As,[s(E,{onClick:r[36]||(r[36]=v=>$("customHttp")),variant:"ghost",color:"gray"},{default:p(()=>r[48]||(r[48]=[g("重置")])),_:1}),s(E,{onClick:r[37]||(r[37]=v=>o("customHttp")),color:"primary"},{default:p(()=>r[49]||(r[49]=[g("保存")])),_:1})])])):M("",!0)],2)],2),t("div",{class:n(["mt-4 flex flex-wrap gap-2",x.disabled?"opacity-60 pointer-events-none":""])},[(y(),k(ge,null,xe(F,v=>s(E,{key:v,onClick:ae=>X(v),class:"flex-grow sm:flex-grow-0",variant:"solid",disabled:x.disabled},{default:p(()=>[g(" 测试"+U(b(v)),1)]),_:2},1032,["onClick","disabled"])),64))],2)])}}}),Is={class:"flex flex-wrap items-center gap-3 w-full justify-end"},Ls=$e({__name:"CommentsSettings",props:{config:{},theme:{}},emits:["update:config"],setup(i,{emit:H}){const A=i,x=H,c=Q({commentEnabled:!1,commentSystem:"waline",commentEmailEnabled:!1,walineServerURL:""});Ze(()=>A.config,b=>{b&&(c.commentEnabled=!!b.commentEnabled,c.commentSystem=String(b.commentSystem||"waline"),c.commentEmailEnabled=!!b.commentEmailEnabled,c.walineServerURL=String(b.walineServerURL||""))},{immediate:!0,deep:!0});const V=B(()=>"bg-gray-800");B(()=>"text-slate-400"),B(()=>"text-white");const F=async()=>{var b,$;try{const P={frontendSettings:{commentEnabled:!!((b=A.config)!=null&&b.commentEnabled),commentSystem:String(c.commentSystem||"waline"),commentEmailEnabled:!!(($=A.config)!=null&&$.commentEmailEnabled),walineServerURL:String(c.walineServerURL||"")}},o=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(P)}),X=await o.json();if(o.ok&&X.code===1){const D={...A.config,...P.frontendSettings};x("update:config",D),window.dispatchEvent(new Event("frontend-config-updated")),f().add({title:"成功",description:"评论设置已更新",color:"green"})}else throw new Error(X.msg||"保存失败")}catch(P){f().add({title:"错误",description:(P==null?void 0:P.message)||"保存失败",color:"red"})}};return(b,$)=>{var D,ie;const P=dt,o=rt,X=it;return y(),k("div",{id:"site-comments-section",class:n(["flex flex-wrap items-center rounded-lg p-3 justify-between gap-3",((D=b.theme)==null?void 0:D.subtleBg)||V.value])},[t("div",Is,[s(P,{modelValue:c.commentSystem,"onUpdate:modelValue":$[0]||($[0]=S=>c.commentSystem=S),options:[{label:"内置",value:"builtin"},{label:"Waline",value:"waline"}]},null,8,["modelValue"]),c.commentSystem==="waline"?(y(),He(o,{key:0,modelValue:c.walineServerURL,"onUpdate:modelValue":$[1]||($[1]=S=>c.walineServerURL=S),ui:{base:(ie=b.theme)==null?void 0:ie.text},placeholder:"Waline 地址",class:"w-full md:w-[280px]"},null,8,["modelValue","ui"])):M("",!0),s(X,{color:"green",onClick:F,class:"shadow"},{default:p(()=>$[2]||($[2]=[g("保存")])),_:1})])],2)}}}),Rs={class:"min-h-screen w-full"},Hs={class:"px-4 py-4 border-b border-slate-700/40 flex flex-col items-center gap-2"},Os=["src"],zs={class:"w-full text-center"},Ds={class:"font-semibold truncate"},Ws={class:"flex-1 overflow-y-auto px-2 py-3 space-y-2"},Ms={key:0,class:"space-y-2"},Ns={class:"px-4 py-3 border-t border-slate-700/40"},Ks={class:"mt-2 flex items-center gap-2"},Fs={key:0,class:"mt-2 text-orange-400 flex items-center gap-2"},Gs={class:"flex items-center gap-2"},qs={class:"flex items-center gap-2"},_s={class:"flex-1 px-4 pb-24 flex flex-col w-full space-y-4"},Js={class:"col-span-12"},Zs={class:"col-span-12"},Qs={class:"px-4 py-3 flex items-center justify-between"},Xs={class:"flex items-center gap-4"},Ys={class:"flex items-center gap-3"},ea={class:"flex items-center"},ta={class:"flex items-center"},la={class:"flex items-center"},sa={class:"flex items-center"},aa={class:"flex items-center gap-2"},oa={id:"system-section",class:"col-span-12"},na={class:"px-4 py-3 flex flex-wrap items-center gap-6"},ia={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},ra={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},da={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},ua={key:0,id:"user-section",class:"col-span-12"},ca={class:"px-4 pb-4 grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-x-4"},ma={class:"flex justify-between items-center mb-2"},pa={key:0},ga={class:"flex justify-end gap-2"},va={key:1},fa={class:"flex justify-between items-center mb-2"},ba={class:"flex items-center gap-2"},wa={key:0,class:"mb-2"},ya={class:"flex items-center gap-2 w-full flex-nowrap"},xa={key:1},ha={class:"flex justify-between items-center mb-2"},ka={key:0},Va={class:"w-full mb-2 flex items-center gap-2"},Ca={class:"w-full mb-2 flex items-center gap-2"},Ua={class:"w-full mb-2 flex items-center gap-2"},Ta={class:"flex justify-end gap-2"},Ea={id:"site-section",class:"col-span-12"},Sa={class:"flex items-center justify-between px-4 py-3"},Ba={class:"px-4 pb-4 space-y-4"},$a={class:"flex items-center gap-4"},ja={class:"flex items-center"},Aa={class:"flex items-center"},Pa={class:"flex justify-between items-center mb-3"},Ia={class:"flex items-center gap-4"},La={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ra={class:"md:col-span-2"},Ha={class:"flex items-center gap-4"},Oa={class:"flex items-center"},za={class:"flex items-center"},Da={class:"flex items-center gap-4"},Wa={class:"flex justify-end"},Ma={id:"site-music-section",class:"col-span-12 mt-4"},Na={class:"flex items-center justify-between px-4 py-3"},Ka={class:"flex items-center gap-3"},Fa={class:"px-4 pb-4"},Ga={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},qa={class:"flex items-center gap-2"},_a={class:"flex items-center gap-2"},Ja={class:"flex items-center gap-2"},Za={class:"flex items-center gap-2 md:col-span-2"},Qa={class:"flex justify-end gap-2"},Xa={class:"flex items-center gap-4"},Ya={class:"flex items-center"},eo={class:"flex items-center"},to={id:"site-configs-section",class:"space-y-4"},lo={class:"flex justify-between items-center mb-2"},so={key:0},ao={key:0,class:"space-y-2"},oo={class:"flex gap-2"},no={class:"flex justify-end gap-2"},io={key:1},ro={key:0,class:"grid grid-cols-3 gap-2"},uo=["src","onClick"],co={key:0,class:"flex justify-end gap-2"},mo={id:"comments-section",class:"col-span-12"},po={class:"flex items-center justify-between px-4 py-3"},go={class:"flex items-center gap-3"},vo={class:"flex items-center gap-2"},fo={class:"px-4 pb-4"},bo={id:"email-section",class:"col-span-12"},wo={class:"flex items-center justify-between px-4 py-3"},yo={class:"flex items-center gap-3"},xo={class:"px-4 pb-4"},ho={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ko={class:"text-xs"},Vo={class:"flex justify-end gap-2 mt-3"},Co={id:"admin-users-section",class:"col-span-12"},Uo={class:"flex items-center justify-between px-4 py-3"},To={class:"px-4 pb-4"},Eo={class:"flex items-center gap-2"},So={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"},Bo={class:"flex items-center gap-2 min-w-0"},$o={class:"flex items-center gap-2"},jo={class:"space-y-3"},Ao={class:"flex items-center gap-2"},Po={class:"flex items-center gap-2"},Io={class:"flex justify-end gap-2"},Lo={id:"notify-section",class:"col-span-12"},Ro={class:"flex items-center justify-between px-4 py-3"},Ho={class:"flex items-center gap-3"},Oo={class:"flex items-center gap-2"},zo={class:"px-4 pb-4"},Do={id:"site-github-login-section",class:"col-span-12"},Wo={class:"flex items-center justify-between px-4 py-3"},Mo={class:"flex items-center gap-3"},No={class:"hidden md:flex items-center gap-2"},Ko={class:"px-4 pb-4 space-y-3"},Fo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Go={class:"md:col-span-2"},qo={class:"flex justify-end gap-2"},_o={id:"db-section",class:"col-span-12"},Jo={class:"flex items-center justify-between px-4 py-3"},Zo={class:"flex gap-2 flex-wrap justify-end items-center"},Qo={class:"px-4 pb-4 space-y-4"},Xo={class:"flex items-center gap-3"},Yo={class:"flex items-center gap-2"},en={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},tn={key:0,class:"flex items-center gap-2"},ln={class:"md:col-span-2"},sn={class:"flex justify-end gap-2 mt-2"},an={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3"},on={class:"md:col-span-2 flex flex-wrap items-center gap-4"},nn={class:"flex items-center gap-2"},rn={class:"flex items-center gap-2"},dn={key:0,class:"flex items-center gap-2"},un={class:"flex items-center gap-3 ml-auto"},cn={class:"flex gap-2"},mn={class:"flex gap-2"},pn={class:"flex justify-end gap-2 mt-2"},gn={key:0},vn={key:1,class:"flex gap-2"},fn={class:"bg-gray-800 p-6 rounded-lg"},bn={class:"flex justify-between items-center"},Re="rounded-2xl border shadow-2xl",wn=$e({__name:"StatusPanel",emits:["restore-success"],setup(i,{emit:H}){const A=I(!0),x=I(!0),c=I(typeof window<"u"&&localStorage.getItem("adminTheme")||"dark"),V=at().public.baseApi||"/api",F=B(()=>{var u,m;const l=(d.avatarURL||"").trim(),e=((u=S.user)==null?void 0:u.username)||((m=S.user)==null?void 0:m.Username)||d.username;return l?l.startsWith("http")?l:l.startsWith("/api")?`${V}${l}`:`${V}${l}`:e?`https://i.pravatar.cc/100?u=${encodeURIComponent(e)}`:"/favicon.ico"}),b=async(l,e)=>{await Dl();const u=document.getElementById(`${l}-section`);u&&(u.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.innerWidth<768&&(x.value=!1))};ne(()=>{typeof window<"u"&&window.innerWidth<768&&(x.value=!1),tt()});const $=I(!0),P=()=>{typeof window>"u"||($.value=window.innerWidth>=768)};ne(()=>{P(),typeof window<"u"&&window.addEventListener("resize",P)}),Rl(()=>{typeof window<"u"&&window.removeEventListener("resize",P)});const o=B(()=>c.value==="light"?{sidebarBg:"bg-white/90",headerBg:"bg-white",bottomBg:"bg-white",cardBg:"bg-white",subtleBg:"bg-white",border:"border-gray-300",text:"text-slate-900",sidebarText:"text-slate-900",mutedText:"text-slate-700",pageBg:"bg-gray-50",navBtnBg:"bg-gray-100",navBtnHoverBg:"hover:bg-gray-200"}:c.value==="dark"?{sidebarBg:"bg-gray-950/80",headerBg:"bg-gray-950/70",bottomBg:"bg-gray-950/70",cardBg:"bg-gray-900/70",subtleBg:"bg-gray-900/50",border:"border-gray-800/60",text:"text-white",sidebarText:"text-white",mutedText:"text-gray-300",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:c.value==="midnight"?{sidebarBg:"bg-indigo-950/60",headerBg:"bg-indigo-950/50",bottomBg:"bg-indigo-950/50",cardBg:"bg-indigo-900/40",subtleBg:"bg-indigo-950/30",border:"border-indigo-800/40",text:"text-white",sidebarText:"text-white",mutedText:"text-indigo-200",pageBg:"bg-gradient-to-br from-indigo-950 via-indigo-900 to-slate-900",navBtnBg:"bg-indigo-950/40",navBtnHoverBg:"hover:bg-indigo-900/40"}:c.value==="slate"?{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}),X=async()=>{localStorage.setItem("adminTheme",c.value);try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let u={};e.code===1?u={...e.data,adminTheme:c.value}:u={adminTheme:c.value};const m=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(u)});(await m.json()).code===1&&f().add({title:(m==null?void 0:m.msg)||"已保存",color:"green"})}catch{}},D=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();e.code===1&&typeof e.data.allowRegistration=="boolean"&&(A.value=e.data.allowRegistration)}catch{f().add({title:"获取注册配置失败",color:"red"})}};ne(D);const ie=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let u={};e.code===1?u={...e.data,allowRegistration:A.value}:u={allowRegistration:A.value};const T=await(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(u)})).json();if(T.code===1)f().add({title:"保存成功",color:"green"});else throw new Error(T.msg||"保存失败")}catch{f().add({title:"保存失败",color:"red"})}},S=Ot(),{login:R,register:r}=ns(),O=zt(),E=I(""),j=Q({checking:!1,hasUpdate:!1,latestVersion:""});let G=Q({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:""});const w=Q({enabled:!1,driver:"smtp",host:"",port:"",user:"",pass:"",from:"",tls:!1,encryption:"tls"}),v=I(!1),ae=async()=>{try{const l=await qe("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};w.enabled=!!e.smtpEnabled,w.driver=e.smtpDriver||"smtp",w.host=e.smtpHost||"",w.port=(e.smtpPort??"").toString(),w.user=e.smtpUser||"",w.pass=e.smtpPass||"",w.from=e.smtpFrom||"",w.tls=!!e.smtpTLS,w.encryption=e.smtpEncryption||(w.tls?"tls":"ssl")}}catch{}};ne(ae);const re=async()=>{try{const l=await qe("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.smtpEnabled=w.enabled,e.smtpDriver=w.driver,e.smtpHost=w.host,e.smtpPort=parseInt(w.port||"0")||0,e.smtpUser=w.user,e.smtpPass=w.pass,e.smtpFrom=w.from,e.smtpEncryption=w.encryption,e.smtpTLS=w.encryption==="tls";const u=await Le("settings",e,{credentials:"include"});if(u&&u.code===1)f().add({title:(u==null?void 0:u.msg)||"已保存",color:"green"});else throw new Error((u==null?void 0:u.msg)||"保存失败")}catch(l){f().add({title:"保存失败",description:l.message,color:"red"})}},he=I([]);I("");const ke=I(""),je=I(!1),Ve=I(!1),J=Q({newPass:"",confirmPass:""}),z=B(()=>{const l=J.newPass||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),fe=B(()=>z.value<=1?"弱":z.value===2?"中":"强"),Ce=B(()=>z.value<=1?"red":z.value===2?"orange":"green"),ut=B(()=>!J.newPass||!J.confirmPass||J.newPass!==J.confirmPass?!1:z.value>=2),ct=async()=>{try{const l=await qe("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};he.value=Array.isArray(e.adminUsers)?e.adminUsers:[],ke.value=e.adminPasswordMasked||""}}catch{}};ne(ct);const Mt=async()=>{try{if(!ut.value)throw new Error("请填写符合强度的新密码并确认一致");const l=await qe("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.adminPasswordReset=J.newPass;const u=await Le("settings",e,{credentials:"include"});if(u&&u.code===1)f().add({title:(u==null?void 0:u.msg)||"管理员密码已重置",color:"green"}),await ct(),je.value=!1,Ve.value=!1,J.newPass="",J.confirmPass="";else throw new Error((u==null?void 0:u.msg)||"重置失败")}catch(l){f().add({title:"重置失败",description:l.message,color:"red"})}},Qe=I(""),mt=B(()=>{const l=S.status||{},e=l.users||l.Users||[];return Array.isArray(e)?e:[]}),Nt=B(()=>{const l=(Qe.value||"").trim().toLowerCase();return l?mt.value.filter(e=>{const u=String(e.id??e.ID??e.user_id??""),m=String(e.username??e.Username??"").toLowerCase();return u.includes(l)||m.includes(l)}):mt.value}),pt=async()=>{await S.getStatus()},Ae=I(!1),Kt=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要切换用户“${e}”的管理员权限吗？`)||!window.confirm("该操作存在风险，是否继续？"))return;const u=l.id??l.ID??l.user_id,m=await Le(`user/admin?id=${u}`,{},{credentials:"include"});if(m&&m.code===1)f().add({title:(m==null?void 0:m.msg)||"已更新管理员状态",color:"green"}),await S.getStatus();else throw new Error((m==null?void 0:m.msg)||"更新失败")}catch(e){f().add({title:"更新失败",description:e.message,color:"red"})}},Ft=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要删除用户“${e}”吗？删除后不可恢复。`)||!window.confirm("该操作存在风险，是否继续？"))return;const u=l.id??l.ID??l.user_id,m=await Wl("user",{id:u},{credentials:"include"});if(m&&m.code===1)f().add({title:(m==null?void 0:m.msg)||"已删除用户",color:"green"}),await S.getStatus();else throw new Error((m==null?void 0:m.msg)||"删除失败")}catch(e){f().add({title:"删除失败",description:e.message,color:"red"})}},Xe=I(!1),Gt=async()=>{try{const l=(w.from||w.user||"").trim();if(!l||!w.host||!w.port||!w.user||!w.pass||!w.encryption)throw new Error("请完整填写地址、主机、端口、加密协议、用户名和密码");Xe.value=!0,w.enabled||(w.enabled=!0,await re());let e=await ye("notify/test",{type:"email",to:l},{credentials:"include"});if((!e||e.code!==1)&&(e=await ye("email/test",{to:l},{credentials:"include"})),e&&e.code===1)f().add({title:(e==null?void 0:e.msg)||"测试邮件已发送",color:"green"});else throw new Error((e==null?void 0:e.msg)||"发送失败或接口不存在")}catch(l){f().add({title:"失败",description:l.message,color:"red"})}finally{Xe.value=!1}},qt=()=>{try{if(!d.githubOAuthEnabled)throw new Error("请先开启 GitHub 登录");if(!d.githubClientId||!d.githubCallbackURL)throw new Error("请先填写 Client ID 与回调地址");const l=at().public.baseApi||"/api";window.open(`${l}/oauth/github/login`,"_blank")}catch(l){f().add({title:"无法测试",description:l.message,color:"red"})}},_t=async()=>{j.checking=!0;try{const e=await(await fetch("/api/version/check",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if(e.code===1){const{hasUpdate:u,lastUpdateTime:m}=e.data;j.hasUpdate=u,j.latestVersion=new Date(m).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),u?f().add({title:"发现版本",description:`最新版本发布于 ${j.latestVersion}`,color:"orange"}):f().add({title:"已是最新版本",description:"当前使用的是最新版本",color:"green"})}else throw new Error(e.msg||"检查更新失败")}catch(l){console.error("检查版本更新失败:",l),f().add({title:"检查更新失败",description:"请科学上网后重试",color:"red"})}finally{j.checking=!1}},Jt=async()=>{var l;if(!S.isLogin){f().add({title:"错误",description:"请先登录",color:"red"});return}try{if(typeof window<"u"&&!window.confirm("重新生成将使旧 Token 失效，确认继续？"))return;Ye.value=!0;const e=await fetch("/api/user/token/regenerate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),u=await e.json();if(!e.ok)throw new Error(u.msg||"Token生成请求失败");if(u.code===1&&((l=u.data)!=null&&l.token))E.value=u.data.token,Ue.value=!1,f().add({title:"成功",description:(u==null?void 0:u.msg)||"Token 已更新",color:"green"});else throw new Error(u.msg||"Token 生成失败")}catch(e){console.error("Token生成错误:",e),f().add({title:"错误",description:e.message||"Token 生成失败",color:"red"})}finally{Ye.value=!1}},Zt=async()=>{try{await navigator.clipboard.writeText(E.value),f().add({title:"成功",description:"Token 已复制到剪贴板",color:"green"})}catch{f().add({title:"错误",description:"复制失败",color:"red"})}},gt=async()=>{try{const l=await fetch("/api/user/logout",{method:"POST",credentials:"include"}),e=await l.json().catch(()=>({}));if(!l.ok||e.code!==1)throw new Error((e==null?void 0:e.msg)||"退出失败");S.clearUserStatus(),f().add({title:"成功",description:"已退出登录",color:"green"}),O.push("/")}catch{S.clearUserStatus(),f().add({title:"成功",description:"已退出登录",color:"green"}),O.push("/")}},Oe=B(()=>(S==null?void 0:S.isLogin)??!1),Qt=B(()=>{var l;return((l=S.user)==null?void 0:l.is_admin)??!1}),de=I(!0),ze=I(!1),vt=I(!1),De=I(null),L=Q({username:"",oldPassword:"",newPassword:"",confirmPassword:""}),Z=Q({username:!1,password:!1}),Ue=I(!1),Ye=I(!1),We=I(!1),Me=I(!1),Ne=I(!1),Te=B(()=>{const l=L.newPassword||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),Xt=B(()=>Te.value<=1?"弱":Te.value===2?"中":"强"),Yt=B(()=>Te.value<=1?"red":Te.value===2?"orange":"green"),el=B(()=>!L.oldPassword||!L.newPassword||!L.confirmPassword||L.newPassword===L.oldPassword||L.newPassword!==L.confirmPassword?!1:Te.value>=2),tl=async()=>{try{if(!L.username.trim())throw new Error("用户名不能为空");const l=await Le("user/update",{username:L.username,type:"username"},{credentials:"include"});if(l&&l.code===1)await S.getUser(),Z.username=!1,L.username="",f().add({title:"成功",description:(l==null?void 0:l.msg)||"用户名已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){f().add({title:"错误",description:l.message||"更新失败",color:"red"})}},ll=async()=>{try{if(!L.newPassword||!L.oldPassword||!L.confirmPassword)throw new Error("密码不能为空");if(L.newPassword===L.oldPassword)throw new Error("新密码不能与当前密码相同");if(L.newPassword!==L.confirmPassword)throw new Error("两次输入不一致");if(Te.value<2)throw new Error("密码强度不足");const l=await Le("user/change_password",{password:L.newPassword,oldPassword:L.oldPassword},{credentials:"include"});if(l&&l.code===1)Z.password=!1,L.oldPassword="",L.newPassword="",L.confirmPassword="",f().add({title:"成功",description:(l==null?void 0:l.msg)||"密码已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){f().add({title:"错误",description:l.message||"更新失败",color:"red"})}},et={siteTitle:"站点标题",subtitleText:"欢迎语",avatarURL:"头像链接",username:"用户名",description:"个人描述",backgrounds:"背景图片",cardFooterTitle:"卡片页脚标题",cardFooterLink:"卡片页脚链接",pageFooterHTML:"页面底部HTML",rssTitle:"RSS 标题",rssDescription:"RSS 描述",rssAuthorName:"RSS 作者",rssFaviconURL:"RSS 图标链接",walineServerURL:"Waline 评论服务器地址"},d=Q({siteTitle:"",subtitleText:"",avatarURL:"",username:"",description:"",backgrounds:[],cardFooterTitle:"",cardFooterLink:"",pageFooterHTML:"",rssTitle:"",rssDescription:"",rssAuthorName:"",rssFaviconURL:"",walineServerURL:"",commentEnabled:!1,commentSystem:"waline",commentEmailEnabled:!1,githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",notifyEnabled:!1,enableGithubCard:!1,pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"dark",announcementText:"",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1}),ue=B({get:()=>d.enableGithubCard===!0,set:l=>{const e=l===!0||l==="true"||l===1||l==="1";d.enableGithubCard=e}}),be=Q({username:"",password:""}),ce=Q({siteTitle:!1,subtitleText:!1,avatarURL:!1,username:!1,description:!1,backgrounds:!1,cardFooterTitle:!1,cardFooterLink:!1,pageFooterHTML:!1,rssTitle:!1,rssDescription:!1,rssAuthorName:!1,rssFaviconURL:!1,walineServerURL:!1}),Y={siteTitle:"Noise的说说笔记",subtitleText:"欢迎访问，点击头像可更换封面背景！",avatarURL:"https://s2.loli.net/2025/03/24/HnSXKvibAQlosIW.png",username:"Noise",description:"执迷不悟",backgrounds:["https://s2.loli.net/2025/03/27/KJ1trnU2ksbFEYM.jpg","https://s2.loli.net/2025/03/27/MZqaLczCvwjSmW7.jpg","https://s2.loli.net/2025/03/27/UMijKXwJ9yTqSeE.jpg","https://s2.loli.net/2025/03/27/WJQIlkXvBg2afcR.jpg","https://s2.loli.net/2025/03/27/oHNQtf4spkq2iln.jpg","https://s2.loli.net/2025/03/27/PMRuX5loc6Uaimw.jpg","https://s2.loli.net/2025/03/27/U2WIslbNyTLt4rD.jpg","https://s2.loli.net/2025/03/27/xu1jZL5Og4pqT9d.jpg","https://s2.loli.net/2025/03/27/OXqwzZ6v3PVIns9.jpg","https://s2.loli.net/2025/03/27/HGuqlE6apgNywbh.jpg","https://s2.loli.net/2025/03/26/d7iyuPYA8cRqD1K.jpg","https://s2.loli.net/2025/03/27/wYy12qDMH6bGJOI.jpg","https://s2.loli.net/2025/03/27/y67m2k5xcSdTsHN.jpg"],cardFooterTitle:"Noise·说说·笔记~",cardFooterLink:"note.noisework.cn",pageFooterHTML:'<div class="text-center text-xs text-gray-400 py-4">来自<a href="https://www.noisework.cn" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Noise</a> 使用<a href="https://github.com/rcy1314/echo-noise" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Ech0-Noise</a>发布</div>',rssTitle:"Noise的说说笔记",rssDescription:"一个说说笔记~",rssAuthorName:"Noise",rssFaviconURL:"/favicon.ico",walineServerURL:"请前往waline官网https://waline.js.org查看部署配置",githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"dark",announcementText:"欢迎访问我的说说笔记！",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"2141128031",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1},sl=l=>{d[l]=Y[l],ce[l]=!1},me=async()=>{var l;try{const u=await(await fetch("/api/frontend/config",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if((l=u==null?void 0:u.data)!=null&&l.frontendSettings){const m=u.data.frontendSettings,T=["enableGithubCard","pwaEnabled","announcementEnabled","musicEnabled","musicLyric","musicAutoplay","musicDefaultMinimized","musicEmbed","commentEnabled","commentEmailEnabled","githubOAuthEnabled","notifyEnabled"];if(Object.keys(d).forEach(N=>{if(N==="backgrounds"){const q=m[N];Array.isArray(q)&&(d[N]=[...q])}else if(T.includes(N)){const q=m[N]??Y[N];d[N]=q===!0||q==="true"}else{const q=m[N]??Y[N];d[N]=typeof q=="string"?q.trim():q}}),m.enableGithubCard!==void 0){const N=m.enableGithubCard;d.enableGithubCard=N===!0||N==="true"}const C=(d.pwaTitle||d.siteTitle||"说说笔记").trim(),_=(d.rssFaviconURL||"/favicon.ico").trim(),te=(d.pwaDescription||d.description||"").trim();Ml({title:C,meta:[{name:"description",content:te},{name:"theme-color",content:"#000000"}],link:[{rel:"manifest",href:"/manifest.webmanifest"},{rel:"icon",href:_}]})}}catch(e){console.error("获取配置失败:",e)}},ee=async l=>{try{if(l==="backgrounds"){const T=d.backgrounds.filter(C=>C&&C.trim()!=="");d.backgrounds=T}const u=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:d})});if(!u.ok){const T=await u.json();throw new Error(T.msg||"请求失败")}const m=await u.json();if(m.code===1){if(ce[l]=!1,await me(),l==="announcementEnabled"){const T=!!d.announcementEnabled;f().add({title:"成功",description:T?"已开启公告":"已关闭公告",color:T?"green":"gray"})}else{const T=l==="defaultContentTheme"?"默认主题色":et[l]||(l==="pwa"?"PWA 设置":l);f().add({title:"成功",description:`${T}已更新`,color:"green"})}if(l==="defaultContentTheme"){const T=(d.defaultContentTheme||"dark").trim()}}else throw new Error(m.msg||"保存失败")}catch(e){console.error("保存配置失败:",e);const u=l==="defaultContentTheme"?"默认主题色":et[l]||l;f().add({title:"失败",description:`${u}保存失败`,color:"red"})}},al=async()=>{try{const e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:d})}),u=await e.json();if(e.ok&&u.code===1){if(await me(),f().add({title:"成功",description:"PWA 设置已更新",color:"green"}),"serviceWorker"in navigator){const m=await navigator.serviceWorker.getRegistrations();if(d.pwaEnabled)await navigator.serviceWorker.register("/sw.js");else{for(const C of m)await C.unregister();const T=await caches.keys();await Promise.all(T.map(C=>caches.delete(C)))}}window.dispatchEvent(new Event("frontend-config-updated"))}else throw new Error(u.msg||"保存失败")}catch(l){f().add({title:"错误",description:l.message||"保存失败",color:"red"})}},ol=async()=>{try{const l={frontendSettings:{commentEnabled:!!d.commentEnabled,commentSystem:String(d.commentSystem||"waline"),commentEmailEnabled:!!d.commentEmailEnabled,walineServerURL:String(d.walineServerURL||"")}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),u=await e.json();if(e.ok&&u.code===1)await me(),window.dispatchEvent(new Event("frontend-config-updated")),f().add({title:"成功",description:"评论设置已更新",color:"green"});else throw new Error(u.msg||"保存失败")}catch(l){f().add({title:"错误",description:l.message||"保存失败",color:"red"})}},nl=async()=>{try{const l={frontendSettings:{enableGithubCard:!!ue.value}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),u=await e.json();if(e.ok&&u.code===1)d.enableGithubCard=!!ue.value,await me(),window.dispatchEvent(new Event("frontend-config-updated")),f().add({title:"成功",description:"GitHub 解析设置已保存",color:"green"});else throw new Error(u.msg||"保存失败")}catch(l){f().add({title:"错误",description:l.message||"保存失败",color:"red"})}},ft=async()=>{try{const l={frontendSettings:{musicEnabled:!!d.musicEnabled,musicPlaylistId:String(d.musicPlaylistId||""),musicSongId:String(d.musicSongId||""),musicPosition:String(d.musicPosition||"bottom-left"),musicTheme:String(d.musicTheme||"auto"),musicLyric:!!d.musicLyric,musicAutoplay:!!d.musicAutoplay,musicDefaultMinimized:!!d.musicDefaultMinimized,musicEmbed:!!d.musicEmbed}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),u=await e.json();if(e.ok&&u.code===1)await me(),window.dispatchEvent(new Event("frontend-config-updated")),f().add({title:"成功",description:"音乐配置已更新",color:"green"});else throw new Error(u.msg||"保存失败")}catch(l){f().add({title:"错误",description:l.message||"保存失败",color:"red"})}},il=()=>{d.musicEnabled=Y.musicEnabled,d.musicPlaylistId=Y.musicPlaylistId,d.musicSongId=Y.musicSongId,d.musicPosition=Y.musicPosition,d.musicTheme=Y.musicTheme,d.musicLyric=Y.musicLyric,d.musicAutoplay=Y.musicAutoplay,d.musicDefaultMinimized=Y.musicDefaultMinimized,d.musicEmbed=Y.musicEmbed},bt=B({get:()=>d.musicEmbed?"embed":"float",set:l=>{d.musicEmbed=l==="embed"}}),rl=async()=>{try{await ee("githubOAuthEnabled"),await ee("githubClientId"),await ee("githubClientSecret"),await ee("githubCallbackURL"),f().add({title:"成功",description:"GitHub 登录配置已保存",color:"green"})}catch(l){f().add({title:"错误",description:(l==null?void 0:l.message)||"保存失败",color:"red"})}},dl=async l=>{const e=l.target.files;if(!e)return;const u=["image/jpeg","image/png","image/webp"];for(const m of Array.from(e))try{if(!u.includes(m.type))throw new Error("仅支持 JPG/PNG/WEBP 格式");const T=new FormData;T.append("image",m);const C=await fetch("/api/images/upload",{method:"POST",credentials:"include",body:T}),_=await C.json();if(!C.ok||_.code!==1)throw new Error(_.msg||"上传失败");if(_.code===1&&_.data){const te=_.data.startsWith("http")?_.data:`/api${_.data}`,N=[...d.backgrounds,te];d.backgrounds=N,await ee("backgrounds"),f().add({title:"上传成功",description:`${m.name} 已添加到背景图片列表`,color:"green"})}}catch(T){f().add({title:"上传失败",description:T.message||"文件上传失败",color:"red"})}De.value&&(De.value.value="")};ne(()=>{window.addEventListener("frontend-config-updated",l=>{const{key:e,value:u}=l.detail;e&&u!==void 0&&(d[e]=u)})});const ul=()=>{me(),vt.value=!1},cl=async()=>{d.backgrounds.push("")},ml=async l=>{d.backgrounds.splice(l,1),await ee("backgrounds")},pl=()=>{var l;(l=De.value)==null||l.click()},gl=l=>{window.open(l,"_blank")};Ze(()=>S.isLogin,l=>{l||(S.getStatus(),S.getUser(),S.$reset())});const wt=I(!1);ne(async()=>{var l;try{if(wt.value=!0,await Promise.all([S.getStatus(),S.getUser(),me(),D()]),S.isLogin){const u=await(await fetch("/api/user/token",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();u.code===1&&((l=u.data)!=null&&l.token)&&(E.value=u.data.token)}}catch(e){console.error("初始化失败:",e),f().add({title:"系统提示",description:"当前未登录",color:"red",timeout:3e3})}finally{wt.value=!1}});const Pe=I(null),Ee=I("sqlite"),vl=B(()=>({sqlite:"SQLite",postgres:"Postgres",mysql:"MySQL",other:"其它"})[Ee.value]||Ee.value),fl=async()=>{try{const l=await fetch("/api/backup/download",{credentials:"include"});if(!l.ok)throw new Error("下载失败");const e=await l.blob(),u=window.URL.createObjectURL(e),m=document.createElement("a");m.href=u,m.download=`noise_backup_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(u),document.body.removeChild(m)}catch(l){f().add({title:"错误",description:l.message||"备份下载失败",color:"red"})}},bl=()=>{var l;(l=Pe.value)==null||l.click()},wl=H,yt=async l=>{const e=l.target.files;if(!(!e||!e[0])){try{const u=new FormData;u.append("database",e[0]);const T=await(await fetch("/api/backup/restore",{method:"POST",credentials:"include",body:u})).json();if(T.code===1)f().add({title:"成功",description:"数据库恢复成功",color:"green"}),wl("restore-success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(T.msg)}catch(u){f().add({title:"错误",description:u.message||"数据库恢复失败",color:"red"})}Pe.value&&(Pe.value.value="")}},W=I(!1),h=Q({provider:"",endpoint:"",region:"",bucket:"",accessKey:"",secretKey:"",usePathStyle:!0,publicBaseURL:""}),we=I(!1),Ie=I("instant"),Ke=I(15),xt=I(""),Fe=I(""),Ge=I(""),tt=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();if((e==null?void 0:e.code)===1){const u=(e.data.dbType||"sqlite").toLowerCase();Ee.value=u==="sqlite"||u==="postgres"||u==="mysql"?u:"other",W.value=!!e.data.storageEnabled;const m=e.data.storageConfig||{};h.provider=m.provider||"",h.endpoint=m.endpoint||"",h.region=m.region||"",h.bucket=m.bucket||"",h.accessKey=m.accessKey||"",h.secretKey=m.secretKey||"",h.usePathStyle=!!m.usePathStyle,h.publicBaseURL=m.publicBaseURL||"",we.value=!!m.autoSyncEnabled,Ie.value=m.syncMode||"instant",Ke.value=Number(m.syncIntervalMinute||15),xt.value=(m.lastSyncTime||"").replace("T"," ").replace("Z","")}}catch{}},yl=async()=>{try{const l={storageEnabled:W.value,storageConfig:{...h,autoSyncEnabled:we.value,syncMode:Ie.value,syncIntervalMinute:Ke.value}},u=await(await fetch("/api/settings",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json();if((u==null?void 0:u.code)===1)f().add({title:"已保存云存储配置",color:"green"});else throw new Error((u==null?void 0:u.msg)||"保存失败")}catch(l){f().add({title:"保存失败",description:l.message,color:"red"})}},xl=async()=>{try{const e=await(await fetch("/api/backup/storage/sync-now",{method:"POST",credentials:"include"})).json();if((e==null?void 0:e.code)===1)f().add({title:"已同步到云端",color:"green"}),await tt();else throw new Error((e==null?void 0:e.msg)||"同步失败")}catch(l){f().add({title:"同步失败",description:l.message,color:"red"})}};Ze(()=>h.provider,l=>{l==="r2"?(h.usePathStyle=!0,h.region||(h.region="auto")):l==="s3"&&h.usePathStyle===void 0&&(h.usePathStyle=!1)});const hl=async()=>{try{const l=Fe.value.trim();if(!l)throw new Error("请填写预签名上传URL");const e=await ye("backup/storage/upload",{uploadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)f().add({title:"云备份上传成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"上传失败")}catch(l){f().add({title:"上传失败",description:l.message,color:"red"})}},kl=async()=>{try{const l=Ge.value.trim();if(!l)throw new Error("请填写预签名下载URL");const e=await ye("backup/storage/restore",{downloadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)f().add({title:"云备份恢复成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"恢复失败")}catch(l){f().add({title:"恢复失败",description:l.message,color:"red"})}},Vl=async()=>{var l;try{const e=await ye("backup/storage/presign/upload",{objectKey:"backup.zip",contentType:"application/zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))Fe.value=e.data.url,f().add({title:"生成上传预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){f().add({title:"生成失败",description:e.message,color:"red"})}},Cl=async()=>{var l;try{const e=await ye("backup/storage/presign/download",{objectKey:"backup.zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))Ge.value=e.data.url,f().add({title:"生成下载预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){f().add({title:"生成失败",description:e.message,color:"red"})}},Ul=async()=>{try{const l=(h.publicBaseURL||"").trim();if(!l)throw new Error("请先在配置中填写公共访问前缀");const e=(l.endsWith("/")?l:l+"/")+"backup.zip",u=await ye("backup/storage/restore",{downloadURL:e},{credentials:"include"});if((u==null?void 0:u.code)===1)f().add({title:"云备份恢复成功",color:"green"});else throw new Error((u==null?void 0:u.msg)||"恢复失败")}catch(l){f().add({title:"恢复失败",description:l.message,color:"red"})}};return(l,e)=>{var Vt,Ct,Ut,Tt,Et,St,Bt,$t;const u=nt,m=it,T=Yl,C=rt,_=Nl,te=Sl,N=At,q=dt,pe=Dt("USwitch"),Tl=Hl,ht=Kl,kt=Gl,El=Fl;return y(),k("div",{class:n(["relative min-h-screen w-full overflow-x-hidden",o.value.pageBg])},[t("div",Rs,[t("aside",{class:n(["w-72 h-screen overflow-y-auto backdrop-blur-md flex flex-col fixed left-0 top-0 z-40 transition-transform duration-300 md:transition-none border-r",[{"translate-x-0":x.value,"-translate-x-full md:translate-x-0":!x.value},o.value.sidebarBg,o.value.border,o.value.sidebarText]])},[t("div",Hs,[t("img",{src:F.value,class:"w-14 h-14 rounded-full ring-2 ring-indigo-400/60 shadow-lg object-cover",alt:"avatar"},null,8,Os),t("div",zs,[t("div",Ds,U(((Vt=oe(S).user)==null?void 0:Vt.username)||d.username||"未登录"),1),t("div",{class:n(["text-xs",o.value.mutedText])},"总笔记 "+U(((Ut=(Ct=oe(S))==null?void 0:Ct.status)==null?void 0:Ut.total_messages)||0),3)])]),t("nav",Ws,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[0]||(e[0]=a=>b("system"))},[s(u,{name:"i-heroicons-cpu-chip",class:"w-5 h-5 text-indigo-300"}),e[139]||(e[139]=t("span",{class:"text-sm text-center"},"系统信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[1]||(e[1]=a=>b("user"))},[s(u,{name:"i-heroicons-user-circle",class:"w-5 h-5 text-indigo-300"}),e[140]||(e[140]=t("span",{class:"text-sm text-center"},"用户信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[2]||(e[2]=a=>b("site"))},[s(u,{name:"i-heroicons-wrench-screwdriver",class:"w-5 h-5 text-indigo-300"}),e[141]||(e[141]=t("span",{class:"text-sm text-center"},"网站配置",-1))],2),Qt.value?(y(),k("div",Ms,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[3]||(e[3]=a=>b("site-register"))},[s(u,{name:"i-heroicons-user-plus",class:"w-5 h-5 text-indigo-300"}),e[142]||(e[142]=t("span",{class:"text-sm text-center"},"注册开关",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[4]||(e[4]=a=>b("site-pwa"))},[s(u,{name:"i-heroicons-rocket-launch",class:"w-5 h-5 text-indigo-300"}),e[143]||(e[143]=t("span",{class:"text-sm text-center"},"PWA 模式",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[5]||(e[5]=a=>b("site-github-card"))},[s(u,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[144]||(e[144]=t("span",{class:"text-sm text-center"},"GitHub 卡片",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[6]||(e[6]=a=>b("site-github-login"))},[s(u,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[145]||(e[145]=t("span",{class:"text-sm text-center"},"GitHub 登录",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[7]||(e[7]=a=>b("site-announcement"))},[s(u,{name:"i-heroicons-megaphone",class:"w-5 h-5 text-indigo-300"}),e[146]||(e[146]=t("span",{class:"text-sm text-center"},"公告栏",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[8]||(e[8]=a=>b("site-music"))},[s(u,{name:"i-heroicons-musical-note",class:"w-5 h-5 text-indigo-300"}),e[147]||(e[147]=t("span",{class:"text-sm text-center"},"音乐配置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[9]||(e[9]=a=>b("site-default-theme"))},[s(u,{name:"i-heroicons-swatch",class:"w-5 h-5 text-indigo-300"}),e[148]||(e[148]=t("span",{class:"text-sm text-center"},"默认主题",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[10]||(e[10]=a=>b("site-configs"))},[s(u,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5 text-indigo-300"}),e[149]||(e[149]=t("span",{class:"text-sm text-center"},"站点文案",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[11]||(e[11]=a=>b("comments"))},[s(u,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5 text-indigo-300"}),e[150]||(e[150]=t("span",{class:"text-sm text-center"},"评论系统",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[12]||(e[12]=a=>b("email"))},[s(u,{name:"i-heroicons-envelope",class:"w-5 h-5 text-indigo-300"}),e[151]||(e[151]=t("span",{class:"text-sm text-center"},"邮件设置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[13]||(e[13]=a=>b("admin-users"))},[s(u,{name:"i-heroicons-shield-check",class:"w-5 h-5 text-indigo-300"}),e[152]||(e[152]=t("span",{class:"text-sm text-center"},"管理员用户",-1))],2)])):M("",!0),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[14]||(e[14]=a=>b("notify"))},[s(u,{name:"i-heroicons-bell-alert",class:"w-5 h-5 text-indigo-300"}),e[153]||(e[153]=t("span",{class:"text-sm text-center"},"推送配置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[15]||(e[15]=a=>b("db"))},[s(u,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[154]||(e[154]=t("span",{class:"text-sm text-center"},"数据库管理",-1))],2)]),t("div",Ns,[e[155]||(e[155]=t("div",{class:"text-xs text-slate-400"},"当前版本: latest",-1)),t("div",Ks,[s(m,{size:"xs",color:"gray",variant:"soft",loading:j.checking,class:"shadow-md",onClick:_t},{default:p(()=>[g(U(j.checking?"检测中...":"检查版本发布时间"),1)]),_:1},8,["loading"])]),j.hasUpdate?(y(),k("div",Fs,[s(u,{name:"i-heroicons-arrow-up-circle",class:"w-4 h-4"}),t("span",null,"最近更新于 "+U(j.latestVersion),1)])):M("",!0)])],2),t("main",{class:n(["w-full min-h-screen md:pl-72 overflow-y-auto",o.value.text])},[t("div",{class:n(["md:hidden flex items-center justify-between px-4 py-3 border-b rounded-b-2xl",[o.value.headerBg,o.value.border,o.value.text]])},[t("div",Gs,[t("button",{class:"p-2 rounded-lg bg-slate-800/70 shadow",onClick:e[16]||(e[16]=a=>x.value=!x.value)},[s(u,{name:"i-heroicons-bars-3",class:"w-5 h-5"})]),e[156]||(e[156]=t("span",{class:"font-semibold"},"系统管理面板",-1))]),t("div",qs,[s(m,{variant:"soft",color:c.value==="light"?"gray":"white",class:"shadow",onClick:e[17]||(e[17]=a=>l.$router.push("/"))},{default:p(()=>e[157]||(e[157]=[g("返回首页")])),_:1},8,["color"]),Oe.value?(y(),He(m,{key:0,icon:"i-heroicons-power",color:"red",variant:"solid",onClick:gt},{default:p(()=>e[158]||(e[158]=[g("退出登录")])),_:1})):M("",!0)])],2),x.value?(y(),k("div",{key:0,class:"fixed inset-0 bg-black/40 md:hidden",onClick:e[18]||(e[18]=a=>x.value=!1)})):M("",!0),t("div",_s,[t("div",Js,[t("h1",{class:n(["text-2xl md:text-3xl font-bold text-center",o.value.text])},"系统管理面板",2)]),t("div",Zs,[t("div",{class:n([o.value.cardBg,o.value.border,Re])},[t("div",Qs,[t("div",Xs,[t("span",{class:n(o.value.text)},"配色",2),t("div",Ys,[t("div",ea,[s(T,{modelValue:c.value,"onUpdate:modelValue":e[19]||(e[19]=a=>c.value=a),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(c.value==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",ta,[s(T,{modelValue:c.value,"onUpdate:modelValue":e[20]||(e[20]=a=>c.value=a),value:"midnight",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(c.value==="midnight"?o.value.text:"text-slate-400")},"深蓝",2)]),t("div",la,[s(T,{modelValue:c.value,"onUpdate:modelValue":e[21]||(e[21]=a=>c.value=a),value:"slate",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(c.value==="slate"?o.value.text:"text-slate-400")},"石板",2)]),t("div",sa,[s(T,{modelValue:c.value,"onUpdate:modelValue":e[22]||(e[22]=a=>c.value=a),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(c.value==="light"?o.value.text:"text-slate-400")},"明亮",2)])])]),t("div",aa,[s(m,{size:"sm",color:"green",class:"shadow",onClick:X},{default:p(()=>e[159]||(e[159]=[g("保存")])),_:1})])])],2)]),t("div",oa,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",na,[t("div",null,[t("span",{class:n(o.value.text)},"系统管理员",2),t("span",ia,U((Et=(Tt=oe(S))==null?void 0:Tt.status)==null?void 0:Et.username),1)]),t("div",null,[t("span",{class:n(o.value.text)},"当前用户",2),t("span",ra,U(Oe.value&&((St=oe(S).user)==null?void 0:St.username)||"未登录"),1)]),t("div",null,[t("span",{class:n(o.value.text)},"笔记总数",2),t("span",da,U(($t=(Bt=oe(S))==null?void 0:Bt.status)==null?void 0:$t.total_messages)+" 条",1)])])],2)]),Oe.value?(y(),k("div",ua,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",{class:n(["flex items-center justify-between px-4 py-3",o.value.text])},e[160]||(e[160]=[t("div",{class:"font-semibold"},"用户信息配置",-1)]),2),t("div",ca,[t("div",{class:n(["rounded-lg p-3 h-full",o.value.subtleBg])},[t("div",ma,[t("span",{class:n(o.value.mutedText)},"用户名",2),s(m,{size:"sm",onClick:e[23]||(e[23]=a=>Z.username=!Z.username),color:Z.username?"gray":"green",variant:Z.username?"soft":"solid",class:"shadow"},{default:p(()=>[g(U(Z.username?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),Z.username?(y(),k("div",pa,[s(C,{modelValue:L.username,"onUpdate:modelValue":e[24]||(e[24]=a=>L.username=a),placeholder:"新用户名",class:"w-full mb-2"},null,8,["modelValue"]),t("div",ga,[s(m,{onClick:tl,color:"primary",class:"shadow"},{default:p(()=>e[161]||(e[161]=[g("保存")])),_:1})])])):(y(),k("div",va,[s(_,{color:"primary",variant:"soft",class:"ml-0 text-xs px-2 py-1 rounded-md !text-slate-800 dark:!text-slate-200"},{default:p(()=>{var a;return[g(U((a=oe(S).user)==null?void 0:a.username),1)]}),_:1})]))],2),t("div",{class:n(["rounded-lg p-3 h-full md:col-span-2",o.value.subtleBg])},[t("div",fa,[t("div",ba,[t("span",{class:n(o.value.mutedText)},"API Token",2),s(_,{color:"primary",variant:"subtle",class:"text-xs px-2 py-1 rounded-md !text-primary-600 dark:!text-primary-300"},{default:p(()=>[g(U(E.value?"已生成":"未生成"),1)]),_:1}),s(m,{size:"xs",loading:Ye.value,onClick:Jt,color:"gray",variant:"soft",class:"shadow text-xs px-2 py-1 rounded-md text-slate-600 dark:text-slate-200",title:"重新生成将使旧 Token 失效"},{default:p(()=>e[162]||(e[162]=[g("重新生成")])),_:1},8,["loading"])])]),E.value?(y(),k("div",wa,[t("div",ya,[s(C,{modelValue:E.value,"onUpdate:modelValue":e[25]||(e[25]=a=>E.value=a),type:Ue.value?"text":"password",readonly:"",class:"font-mono text-sm flex-1 min-w-0"},null,8,["modelValue","type"]),s(m,{icon:Ue.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[26]||(e[26]=a=>Ue.value=!Ue.value),title:Ue.value?"隐藏":"显示"},null,8,["icon","title"]),s(m,{icon:"i-heroicons-clipboard",color:"gray",variant:"ghost",onClick:Zt,title:"复制 Token"})]),t("p",{class:n(["text-xs mt-1",o.value.mutedText])},"请妥善保管此 Token",2)])):(y(),k("div",xa,[t("p",{class:n(o.value.mutedText)},"暂无 Token",2)]))],2),t("div",{class:n(["rounded-lg p-3 md:col-span-3",o.value.subtleBg])},[t("div",ha,[t("span",{class:n(o.value.mutedText)},"修改密码",2),s(m,{size:"sm",onClick:e[27]||(e[27]=a=>Z.password=!Z.password),color:Z.password?"gray":"green",variant:Z.password?"soft":"solid",class:"shadow"},{default:p(()=>[g(U(Z.password?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),Z.password?(y(),k("div",ka,[t("div",Va,[s(C,{modelValue:L.oldPassword,"onUpdate:modelValue":e[28]||(e[28]=a=>L.oldPassword=a),type:We.value?"text":"password",placeholder:"当前密码",class:"flex-1"},null,8,["modelValue","type"]),s(m,{icon:We.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[29]||(e[29]=a=>We.value=!We.value)},null,8,["icon"])]),t("div",Ca,[s(C,{modelValue:L.newPassword,"onUpdate:modelValue":e[30]||(e[30]=a=>L.newPassword=a),type:Me.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),s(_,{color:Yt.value,variant:"soft"},{default:p(()=>[g(U(Xt.value),1)]),_:1},8,["color"]),s(m,{icon:Me.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[31]||(e[31]=a=>Me.value=!Me.value)},null,8,["icon"])]),t("div",Ua,[s(C,{modelValue:L.confirmPassword,"onUpdate:modelValue":e[32]||(e[32]=a=>L.confirmPassword=a),type:Ne.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"]),s(m,{icon:Ne.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[33]||(e[33]=a=>Ne.value=!Ne.value)},null,8,["icon"])]),t("div",Ta,[s(m,{onClick:ll,disabled:!el.value,color:"primary",class:"shadow"},{default:p(()=>e[163]||(e[163]=[g("保存")])),_:1},8,["disabled"])])])):M("",!0)],2)])],2)])):M("",!0),t("div",Ea,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Sa,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5"}),e[164]||(e[164]=t("span",null,"网站配置",-1))],2)]),t("div",Ba,[t("div",{id:"site-register-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-user-plus",class:"w-4 h-4"}),e[165]||(e[165]=g()),e[166]||(e[166]=t("span",null,"新用户注册",-1))],2),t("div",$a,[t("div",ja,[s(T,{modelValue:A.value,"onUpdate:modelValue":e[34]||(e[34]=a=>A.value=a),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(A.value?o.value.text:"text-slate-400")},"允许",2)]),t("div",Aa,[s(T,{modelValue:A.value,"onUpdate:modelValue":e[35]||(e[35]=a=>A.value=a),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(A.value?"text-slate-400":o.value.text)},"不允许",2)]),s(m,{color:"green",onClick:ie,class:"shadow"},{default:p(()=>e[167]||(e[167]=[g("保存")])),_:1})])],2),t("div",{id:"site-pwa-section",class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",Pa,[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-rocket-launch",class:"w-4 h-4"}),e[168]||(e[168]=g()),e[169]||(e[169]=t("span",null,"PWA 模式",-1))],2),t("div",Ia,[s(te,{modelValue:d.pwaEnabled,"onUpdate:modelValue":e[36]||(e[36]=a=>d.pwaEnabled=a)},null,8,["modelValue"]),s(m,{color:"green",onClick:al,class:"shadow"},{default:p(()=>e[170]||(e[170]=[g("保存")])),_:1})])]),t("div",La,[t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 标题",2),s(C,{modelValue:d.pwaTitle,"onUpdate:modelValue":e[37]||(e[37]=a=>d.pwaTitle=a),placeholder:d.siteTitle||"说说笔记"},null,8,["modelValue","placeholder"])]),t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 图标",2),s(C,{modelValue:d.pwaIconURL,"onUpdate:modelValue":e[38]||(e[38]=a=>d.pwaIconURL=a),placeholder:"/favicon.ico"},null,8,["modelValue"])]),t("div",Ra,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 描述",2),s(N,{modelValue:d.pwaDescription,"onUpdate:modelValue":e[39]||(e[39]=a=>d.pwaDescription=a),placeholder:d.description||""},null,8,["modelValue","placeholder"])])])],2),t("div",{id:"site-github-card-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(u,{name:"i-mdi-github",class:"w-4 h-4"}),e[171]||(e[171]=g()),e[172]||(e[172]=t("span",null,"GitHub 链接卡片解析",-1))],2),t("div",Ha,[t("div",Oa,[s(T,{modelValue:ue.value,"onUpdate:modelValue":e[40]||(e[40]=a=>ue.value=a),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(ue.value?o.value.text:"text-slate-400")},"开启",2)]),t("div",za,[s(T,{modelValue:ue.value,"onUpdate:modelValue":e[41]||(e[41]=a=>ue.value=a),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(ue.value?"text-slate-400":o.value.text)},"关闭",2)]),s(m,{color:"green",onClick:nl,class:"shadow"},{default:p(()=>e[173]||(e[173]=[g("保存")])),_:1})])],2),t("div",{id:"site-announcement-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-megaphone",class:"w-4 h-4"}),e[174]||(e[174]=g()),e[175]||(e[175]=t("span",null,"公告栏开关",-1))],2),t("div",Da,[s(te,{modelValue:d.announcementEnabled,"onUpdate:modelValue":e[42]||(e[42]=a=>d.announcementEnabled=a)},null,8,["modelValue"]),s(m,{color:"green",onClick:e[43]||(e[43]=a=>ee("announcementEnabled")),class:"shadow"},{default:p(()=>e[176]||(e[176]=[g("保存")])),_:1})])],2),t("div",{class:n(["rounded-lg p-3 mt-3",o.value.subtleBg])},[t("div",{class:n(["text-sm mb-2",o.value.mutedText])},"公告栏文本",2),s(N,{modelValue:d.announcementText,"onUpdate:modelValue":e[44]||(e[44]=a=>d.announcementText=a),placeholder:"请输入公告内容",class:"w-full mb-2"},null,8,["modelValue"]),t("div",Wa,[s(m,{color:"primary",class:"shadow",onClick:e[45]||(e[45]=a=>ee("announcementText"))},{default:p(()=>e[177]||(e[177]=[g("保存公告文本")])),_:1})])],2),t("div",Ma,[t("div",{class:n([o.value.cardBg,o.value.border,Re])},[t("div",Na,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-musical-note",class:"w-5 h-5"}),e[178]||(e[178]=t("span",null,"音乐配置",-1))],2),t("div",Ka,[s(te,{modelValue:d.musicEnabled,"onUpdate:modelValue":e[46]||(e[46]=a=>d.musicEnabled=a)},null,8,["modelValue"]),s(m,{color:"green",onClick:ft,class:"shadow"},{default:p(()=>e[179]||(e[179]=[g("保存")])),_:1})])]),t("div",Fa,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",Ga,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌单 ID",2),s(C,{modelValue:d.musicPlaylistId,"onUpdate:modelValue":e[47]||(e[47]=a=>d.musicPlaylistId=a),placeholder:"网易云歌单ID（可选）"},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌曲 ID",2),s(C,{modelValue:d.musicSongId,"onUpdate:modelValue":e[48]||(e[48]=a=>d.musicSongId=a),placeholder:"网易云歌曲ID（可选）"},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"位置",2),s(q,{modelValue:d.musicPosition,"onUpdate:modelValue":e[49]||(e[49]=a=>d.musicPosition=a),options:[{label:"左下",value:"bottom-left"},{label:"右下",value:"bottom-right"}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"主题",2),s(q,{modelValue:d.musicTheme,"onUpdate:modelValue":e[50]||(e[50]=a=>d.musicTheme=a),options:[{label:"自动",value:"auto"},{label:"深色",value:"dark"},{label:"浅色",value:"light"}]},null,8,["modelValue"])]),t("div",qa,[t("span",{class:n(["text-sm",o.value.mutedText])},"显示歌词",2),s(pe,{modelValue:d.musicLyric,"onUpdate:modelValue":e[51]||(e[51]=a=>d.musicLyric=a)},null,8,["modelValue"])]),t("div",_a,[t("span",{class:n(["text-sm",o.value.mutedText])},"自动播放",2),s(pe,{modelValue:d.musicAutoplay,"onUpdate:modelValue":e[52]||(e[52]=a=>d.musicAutoplay=a)},null,8,["modelValue"])]),t("div",Ja,[t("span",{class:n(["text-sm",o.value.mutedText])},"默认最小化",2),s(pe,{modelValue:d.musicDefaultMinimized,"onUpdate:modelValue":e[53]||(e[53]=a=>d.musicDefaultMinimized=a)},null,8,["modelValue"])]),t("div",Za,[t("span",{class:n(["text-sm",o.value.mutedText])},"展示模式",2),s(q,{modelValue:bt.value,"onUpdate:modelValue":e[54]||(e[54]=a=>bt.value=a),options:[{label:"嵌入",value:"embed"},{label:"浮动",value:"float"}]},null,8,["modelValue"])])]),t("div",Qa,[s(m,{variant:"soft",color:"gray",onClick:il},{default:p(()=>e[180]||(e[180]=[g("重置")])),_:1}),s(m,{color:"green",onClick:ft},{default:p(()=>e[181]||(e[181]=[g("保存")])),_:1})])],2)])],2)]),t("div",{id:"site-default-theme-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-swatch",class:"w-4 h-4"}),e[182]||(e[182]=g()),e[183]||(e[183]=t("span",null,"默认主题色",-1))],2),t("div",Xa,[t("div",Ya,[s(T,{modelValue:d.defaultContentTheme,"onUpdate:modelValue":e[55]||(e[55]=a=>d.defaultContentTheme=a),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(d.defaultContentTheme==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",eo,[s(T,{modelValue:d.defaultContentTheme,"onUpdate:modelValue":e[56]||(e[56]=a=>d.defaultContentTheme=a),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(d.defaultContentTheme==="light"?o.value.text:"text-slate-400")},"白天",2)]),s(m,{color:"green",onClick:e[57]||(e[57]=a=>ee("defaultContentTheme")),class:"shadow"},{default:p(()=>e[184]||(e[184]=[g("保存")])),_:1})])],2),t("div",to,[(y(),k(ge,null,xe(et,(a,K)=>t("div",{key:K,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",lo,[t("span",{class:n(o.value.mutedText)},U(a),3),s(m,{size:"sm",onClick:le=>ce[K]=!ce[K],color:ce[K]?"gray":"green",variant:ce[K]?"soft":"solid",class:"shadow"},{default:p(()=>[g(U(ce[K]?"取消":"编辑"),1)]),_:2},1032,["onClick","color","variant"])]),ce[K]?(y(),k("div",so,[K==="backgrounds"?(y(),k("div",ao,[(y(!0),k(ge,null,xe(d.backgrounds,(le,Se)=>(y(),k("div",{key:Se,class:"flex gap-2"},[s(C,{modelValue:d.backgrounds[Se],"onUpdate:modelValue":lt=>d.backgrounds[Se]=lt,placeholder:"输入图片URL",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),s(m,{onClick:lt=>ml(Se),icon:"i-heroicons-trash",color:"red",variant:"ghost"},null,8,["onClick"])]))),128)),t("div",oo,[s(m,{onClick:cl,icon:"i-heroicons-plus",variant:"ghost",class:"mr-2"},{default:p(()=>e[185]||(e[185]=[g("添加链接")])),_:1}),s(m,{onClick:pl,icon:"i-heroicons-cloud-arrow-up",variant:"ghost"},{default:p(()=>e[186]||(e[186]=[g("上传图片")])),_:1})])])):K==="subtitleText"?(y(),He(N,{key:1,modelValue:d[K],"onUpdate:modelValue":le=>d[K]=le,placeholder:`输入${a}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(y(),He(C,{key:2,modelValue:d[K],"onUpdate:modelValue":le=>d[K]=le,placeholder:`输入${a}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),t("div",no,[s(m,{onClick:le=>sl(K),variant:"ghost",color:"gray"},{default:p(()=>e[187]||(e[187]=[g("重置")])),_:2},1032,["onClick"]),s(m,{onClick:le=>ee(K),color:"primary",class:"shadow"},{default:p(()=>e[188]||(e[188]=[g("保存")])),_:2},1032,["onClick"])])])):(y(),k("div",io,[K==="backgrounds"?(y(),k("div",ro,[(y(!0),k(ge,null,xe(d.backgrounds,(le,Se)=>(y(),k("img",{key:Se,src:le,class:"w-full h-20 object-cover rounded cursor-pointer",onClick:lt=>gl(le)},null,8,uo))),128))])):(y(),k("div",{key:1,class:n([o.value.subtleBg,o.value.border,"rounded-md p-3 border"])},[t("p",{class:n([o.value.text,"break-words"])},U(d[K]),3)],2))]))],2)),64))]),vt.value?(y(),k("div",co,[s(m,{onClick:ul,variant:"ghost",color:"gray"},{default:p(()=>e[189]||(e[189]=[g("重置")])),_:1}),s(m,{onClick:l.saveConfig,color:"primary",class:"shadow"},{default:p(()=>e[190]||(e[190]=[g("保存所有更改")])),_:1},8,["onClick"])])):M("",!0)])],2)]),t("div",mo,[t("div",{class:n([o.value.cardBg,o.value.border,Re])},[t("div",po,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5"}),e[191]||(e[191]=t("span",{class:"whitespace-nowrap"},"评论系统",-1))],2),t("div",go,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([d.commentEnabled?"text-green-400":"text-red-400","text-sm"])},U(d.commentEnabled?"已启用":"未启用"),3),s(te,{modelValue:d.commentEnabled,"onUpdate:modelValue":e[58]||(e[58]=a=>d.commentEnabled=a)},null,8,["modelValue"]),t("div",vo,[t("span",{class:n(["text-sm",o.value.mutedText])},"邮件通知",2),s(te,{modelValue:d.commentEmailEnabled,"onUpdate:modelValue":e[59]||(e[59]=a=>d.commentEmailEnabled=a),disabled:!d.commentEnabled},null,8,["modelValue","disabled"])]),s(m,{color:"green",onClick:ol,class:"shadow"},{default:p(()=>e[192]||(e[192]=[g("保存")])),_:1})])]),t("div",fo,[s(Ls,{config:d,"onUpdate:config":e[60]||(e[60]=a=>d=a),theme:o.value},null,8,["config","theme"])])],2)]),t("div",{class:n(["mx-4 my-2 border-t",o.value.border])},null,2),t("div",bo,[t("div",{class:n([o.value.cardBg,o.value.border,Re])},[t("div",wo,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-envelope",class:"w-5 h-5"}),e[193]||(e[193]=t("span",null,"邮件设置（SMTP）",-1))],2),t("div",yo,[s(te,{modelValue:w.enabled,"onUpdate:modelValue":e[61]||(e[61]=a=>w.enabled=a)},null,8,["modelValue"]),s(m,{color:"green",onClick:re,class:"shadow"},{default:p(()=>e[194]||(e[194]=[g("保存")])),_:1})])]),t("div",xo,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"地址",2),s(C,{modelValue:w.from,"onUpdate:modelValue":e[62]||(e[62]=a=>w.from=a),placeholder:"发件地址，如 name@example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"驱动",2),s(q,{modelValue:w.driver,"onUpdate:modelValue":e[63]||(e[63]=a=>w.driver=a),options:["smtp"]},null,8,["modelValue"])]),t("div",{class:n(["text-sm font-semibold mt-1 mb-2",o.value.text])},"SMTP 设置",2),t("div",ho,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"主机",2),s(C,{modelValue:w.host,"onUpdate:modelValue":e[64]||(e[64]=a=>w.host=a),placeholder:"smtp.example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"端口",2),s(C,{modelValue:w.port,"onUpdate:modelValue":e[65]||(e[65]=a=>w.port=a),placeholder:"465 或 587"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"加密协议（小写 ssl 或 tls）",2),s(q,{modelValue:w.encryption,"onUpdate:modelValue":e[66]||(e[66]=a=>w.encryption=a),options:["ssl","tls"]},null,8,["modelValue"])]),e[195]||(e[195]=t("div",{class:"md:col-span-1"},null,-1)),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"用户名",2),s(C,{modelValue:w.user,"onUpdate:modelValue":e[67]||(e[67]=a=>w.user=a),placeholder:"通常与发件地址一致"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"密码",2),s(C,{modelValue:w.pass,"onUpdate:modelValue":e[68]||(e[68]=a=>w.pass=a),type:v.value?"text":"password",placeholder:"邮箱或应用专用密码"},null,8,["modelValue","type"])])]),t("div",{class:n(["flex items-center justify-between mt-2",o.value.mutedText])},[t("span",ko,"使用上述设置发送测试邮件到："+U(w.from||w.user||"请先填写地址"),1),s(m,{disabled:!(w.from||w.user),loading:Xe.value,color:"primary",onClick:Gt},{default:p(()=>e[196]||(e[196]=[g("发送测试邮件")])),_:1},8,["disabled","loading"])],2),t("div",Vo,[s(m,{variant:"soft",color:"gray",onClick:ae},{default:p(()=>e[197]||(e[197]=[g("刷新")])),_:1}),s(m,{color:"green",onClick:re},{default:p(()=>e[198]||(e[198]=[g("保存")])),_:1})])],2)])],2)]),t("div",Co,[t("div",{class:n([o.value.cardBg,o.value.border,Re])},[t("div",Uo,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-shield-check",class:"w-5 h-5"}),e[199]||(e[199]=t("span",null,"用户管理",-1))],2)]),t("div",To,[t("div",{class:n(["rounded-lg p-3 mb-3",o.value.subtleBg])},[t("div",Eo,[s(C,{modelValue:Qe.value,"onUpdate:modelValue":e[69]||(e[69]=a=>Qe.value=a),placeholder:"搜索用户名或ID",class:"flex-1"},null,8,["modelValue"]),s(m,{color:"primary",variant:"soft",onClick:pt},{default:p(()=>e[200]||(e[200]=[g("搜索")])),_:1}),s(m,{variant:"soft",color:"gray",onClick:pt},{default:p(()=>e[201]||(e[201]=[g("刷新")])),_:1}),s(m,{variant:"soft",color:Ae.value?"gray":"indigo",onClick:e[70]||(e[70]=a=>Ae.value=!Ae.value)},{default:p(()=>[g(U(Ae.value?"折叠":"展开"),1)]),_:1},8,["color"])])],2),Ae.value?(y(),k("div",{key:0,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",So,[(y(!0),k(ge,null,xe(Nt.value,a=>(y(),k("div",{key:a.id??a.ID,class:n(["flex items-center justify-between rounded border px-3 py-2",o.value.border])},[t("div",Bo,[s(_,{color:"gray",variant:"soft"},{default:p(()=>[g("#"+U(a.id??a.ID),1)]),_:2},1024),t("span",{class:n(["truncate",o.value.text])},U(a.username??a.Username),3),s(_,{color:a.is_admin??a.IsAdmin?"primary":"gray",variant:"subtle"},{default:p(()=>[g(U(a.is_admin??a.IsAdmin?"管理员":"普通"),1)]),_:2},1032,["color"])]),t("div",$o,[s(m,{color:a.is_admin??a.IsAdmin?"orange":"green",variant:a.is_admin??a.IsAdmin?"soft":"solid",class:"shadow",onClick:K=>Kt(a)},{default:p(()=>[g(U(a.is_admin??a.IsAdmin?"取消管理员":"设为管理员"),1)]),_:2},1032,["color","variant","onClick"]),s(m,{color:"red",variant:"soft",class:"shadow",onClick:K=>Ft(a)},{default:p(()=>e[202]||(e[202]=[g("删除")])),_:2},1032,["onClick"])])],2))),128))])],2)):M("",!0)])],2)]),s(ht,{modelValue:Ve.value,"onUpdate:modelValue":e[74]||(e[74]=a=>Ve.value=a)},{default:p(()=>[s(Tl,null,{default:p(()=>[e[205]||(e[205]=t("div",{class:"font-semibold mb-2"},"重置管理员密码",-1)),t("div",jo,[t("div",Ao,[s(C,{modelValue:J.newPass,"onUpdate:modelValue":e[71]||(e[71]=a=>J.newPass=a),type:je.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),s(_,{color:Ce.value,variant:"soft"},{default:p(()=>[g(U(fe.value),1)]),_:1},8,["color"])]),t("div",Po,[s(C,{modelValue:J.confirmPass,"onUpdate:modelValue":e[72]||(e[72]=a=>J.confirmPass=a),type:je.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"])]),t("div",Io,[s(m,{variant:"ghost",color:"gray",onClick:e[73]||(e[73]=a=>Ve.value=!1)},{default:p(()=>e[203]||(e[203]=[g("取消")])),_:1}),s(m,{disabled:!ut.value,color:"primary",onClick:Mt},{default:p(()=>e[204]||(e[204]=[g("保存")])),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["modelValue"]),t("div",Lo,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Ro,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-bell-alert",class:"w-5 h-5"}),e[206]||(e[206]=t("span",null,"推送配置",-1))],2),t("div",Ho,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([d.notifyEnabled?"text-green-400":"text-red-400","text-sm"])},U(d.notifyEnabled?"已启用":"未启用"),3),s(pe,{modelValue:d.notifyEnabled,"onUpdate:modelValue":e[75]||(e[75]=a=>d.notifyEnabled=a),color:"primary",size:"lg"},null,8,["modelValue"]),t("div",Oo,[s(T,{modelValue:d.notifyEnabled,"onUpdate:modelValue":e[76]||(e[76]=a=>d.notifyEnabled=a),value:!0},null,8,["modelValue"]),t("span",{class:n(d.notifyEnabled?o.value.text:"text-gray-400")},"开启",2),s(T,{modelValue:d.notifyEnabled,"onUpdate:modelValue":e[77]||(e[77]=a=>d.notifyEnabled=a),value:!1},null,8,["modelValue"]),t("span",{class:n(d.notifyEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",zo,[s(Ps,{config:oe(G),"onUpdate:config":e[78]||(e[78]=a=>Ol(G)?G.value=a:G=a),immediate:!0,subtleBg:o.value.subtleBg,text:o.value.text,mutedText:o.value.mutedText,disabled:!d.notifyEnabled},null,8,["config","subtleBg","text","mutedText","disabled"])])],2)]),t("div",Do,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Wo,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-mdi-github",class:"w-5 h-5"}),e[207]||(e[207]=t("span",null,"GitHub 登录",-1))],2),t("div",Mo,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([d.githubOAuthEnabled?"text-green-400":"text-red-400","text-sm"])},U(d.githubOAuthEnabled?"已启用":"未启用"),3),s(pe,{modelValue:d.githubOAuthEnabled,"onUpdate:modelValue":e[79]||(e[79]=a=>d.githubOAuthEnabled=a),color:"primary",size:"lg"},null,8,["modelValue"]),t("div",No,[s(T,{modelValue:d.githubOAuthEnabled,"onUpdate:modelValue":e[80]||(e[80]=a=>d.githubOAuthEnabled=a),value:!0},null,8,["modelValue"]),t("span",{class:n(d.githubOAuthEnabled?o.value.text:"text-gray-400")},"开启",2),s(T,{modelValue:d.githubOAuthEnabled,"onUpdate:modelValue":e[81]||(e[81]=a=>d.githubOAuthEnabled=a),value:!1},null,8,["modelValue"]),t("span",{class:n(d.githubOAuthEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",Ko,[t("div",Fo,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client ID",2),s(C,{modelValue:d.githubClientId,"onUpdate:modelValue":e[82]||(e[82]=a=>d.githubClientId=a),placeholder:"GitHub OAuth App Client ID",disabled:!d.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client Secret",2),s(C,{modelValue:d.githubClientSecret,"onUpdate:modelValue":e[83]||(e[83]=a=>d.githubClientSecret=a),type:"password",placeholder:"GitHub OAuth App Client Secret",disabled:!d.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",Go,[t("div",{class:n(["text-sm mb-2",o.value.text])},"回调地址",2),s(C,{modelValue:d.githubCallbackURL,"onUpdate:modelValue":e[84]||(e[84]=a=>d.githubCallbackURL=a),placeholder:"例如 https://your.domain.com/oauth/github/callback",disabled:!d.githubOAuthEnabled},null,8,["modelValue","disabled"])])]),t("div",qo,[s(m,{variant:"soft",color:"gray",onClick:me},{default:p(()=>e[208]||(e[208]=[g("刷新")])),_:1}),s(m,{color:"green",onClick:rl},{default:p(()=>e[209]||(e[209]=[g("保存")])),_:1}),s(m,{color:"primary",onClick:qt},{default:p(()=>e[210]||(e[210]=[g("测试")])),_:1})]),t("div",{class:n(["text-xs",o.value.mutedText])},"默认不开启，开启后登录页显示“GitHub 一键登录”按钮",2)])],2)]),t("div",_o,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Jo,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(u,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[211]||(e[211]=t("span",null,"本地数据库管理配置",-1)),t("span",{class:n(["ml-2 text-xs px-2 py-1 rounded",o.value.subtleBg])},"当前 DB："+U(vl.value),3)],2),t("div",Zo,[s(m,{color:"primary",icon:"i-heroicons-arrow-down-tray",disabled:Ee.value!=="sqlite",onClick:fl},{default:p(()=>e[212]||(e[212]=[g("下载本地备份")])),_:1},8,["disabled"]),s(m,{color:"warning",variant:"soft",icon:"i-heroicons-arrow-up-tray",disabled:Ee.value!=="sqlite",onClick:bl},{default:p(()=>e[213]||(e[213]=[g("恢复本地数据库")])),_:1},8,["disabled"]),t("input",{type:"file",ref_key:"databaseFileInput",ref:Pe,accept:".zip",class:"hidden",onChange:yt},null,544)])]),t("div",Qo,[t("div",{class:n(["text-yellow-400 text-sm rounded p-2",o.value.subtleBg])},"🔔：仅针对 SQLite 本地数据库；"+U(Ee.value!=="sqlite"?"当前为云/外部数据库，请在服务端操作":"可在此下载与恢复本地备份"),3),t("input",{type:"file",ref_key:"databaseFileInput",ref:Pe,accept:".zip",class:"hidden",onChange:yt},null,544),t("div",{class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",{class:n(["font-semibold mb-2 flex items-center justify-between",o.value.text])},[e[214]||(e[214]=t("span",null,"云存储接入（R2/S3）",-1)),t("div",Xo,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([W.value?"text-green-400":"text-red-400","text-sm"])},U(W.value?"已启用":"未启用"),3),s(pe,{modelValue:W.value,"onUpdate:modelValue":e[85]||(e[85]=a=>W.value=a)},null,8,["modelValue"]),t("div",Yo,[s(T,{modelValue:W.value,"onUpdate:modelValue":e[86]||(e[86]=a=>W.value=a),value:!0},null,8,["modelValue"]),t("span",{class:n(W.value?o.value.text:"text-gray-400")},"开启",2),s(T,{modelValue:W.value,"onUpdate:modelValue":e[87]||(e[87]=a=>W.value=a),value:!1},null,8,["modelValue"]),t("span",{class:n(W.value?"text-gray-400":o.value.text)},"关闭",2)])])],2),t("div",en,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"提供方",2),s(q,{modelValue:h.provider,"onUpdate:modelValue":e[88]||(e[88]=a=>h.provider=a),options:[{label:"S3",value:"s3"},{label:"R2",value:"r2"}],disabled:!W.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Endpoint",2),s(C,{modelValue:h.endpoint,"onUpdate:modelValue":e[89]||(e[89]=a=>h.endpoint=a),placeholder:"https://...",disabled:!W.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Region",2),s(C,{modelValue:h.region,"onUpdate:modelValue":e[90]||(e[90]=a=>h.region=a),placeholder:"auto 或区域名",disabled:!W.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Bucket",2),s(C,{modelValue:h.bucket,"onUpdate:modelValue":e[91]||(e[91]=a=>h.bucket=a),placeholder:"bucket 名称",disabled:!W.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Access Key",2),s(C,{modelValue:h.accessKey,"onUpdate:modelValue":e[92]||(e[92]=a=>h.accessKey=a),disabled:!W.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Secret Key",2),s(C,{modelValue:h.secretKey,"onUpdate:modelValue":e[93]||(e[93]=a=>h.secretKey=a),type:"password",disabled:!W.value},null,8,["modelValue","disabled"])]),h.provider==="s3"?(y(),k("div",tn,[t("span",{class:n(["text-sm",o.value.mutedText])},"使用路径风格地址",2),s(pe,{modelValue:h.usePathStyle,"onUpdate:modelValue":e[94]||(e[94]=a=>h.usePathStyle=a),disabled:!W.value},null,8,["modelValue","disabled"])])):M("",!0),t("div",ln,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"公共访问前缀",2),s(C,{modelValue:h.publicBaseURL,"onUpdate:modelValue":e[95]||(e[95]=a=>h.publicBaseURL=a),placeholder:"https://bucket.example.com/",disabled:!W.value},null,8,["modelValue","disabled"])])]),t("div",sn,[s(m,{variant:"soft",color:"gray",onClick:tt},{default:p(()=>e[215]||(e[215]=[g("刷新")])),_:1}),s(m,{color:"green",onClick:yl},{default:p(()=>e[216]||(e[216]=[g("保存")])),_:1})]),t("div",an,[t("div",on,[t("div",nn,[t("span",{class:n(["text-sm",o.value.mutedText])},"自动同步至云端",2),s(pe,{modelValue:we.value,"onUpdate:modelValue":e[96]||(e[96]=a=>we.value=a),disabled:!(W.value&&h.provider&&h.endpoint&&h.bucket&&h.accessKey&&h.secretKey)},null,8,["modelValue","disabled"])]),t("div",rn,[t("span",{class:n(["text-sm",o.value.mutedText])},"模式",2),s(q,{modelValue:Ie.value,"onUpdate:modelValue":e[97]||(e[97]=a=>Ie.value=a),options:[{label:"即时",value:"instant"},{label:"定时",value:"scheduled"}],disabled:!we.value||!(W.value&&h.provider&&h.endpoint&&h.bucket&&h.accessKey&&h.secretKey)},null,8,["modelValue","disabled"])]),Ie.value==="scheduled"?(y(),k("div",dn,[t("span",{class:n(["text-sm",o.value.mutedText])},"间隔(分钟)",2),s(C,{modelValue:Ke.value,"onUpdate:modelValue":e[98]||(e[98]=a=>Ke.value=a),modelModifiers:{number:!0},type:"number",min:"1",class:"w-24",disabled:!we.value||!(W.value&&h.provider&&h.endpoint&&h.bucket&&h.accessKey&&h.secretKey)},null,8,["modelValue","disabled"])])):M("",!0),t("div",un,[t("span",{class:n(["text-sm",o.value.mutedText])},"上次同步",2),t("span",{class:n(["text-sm",o.value.text])},U(xt.value||"—"),3),s(m,{color:"primary",disabled:!we.value||!(W.value&&h.provider&&h.endpoint&&h.bucket&&h.accessKey&&h.secretKey),onClick:xl},{default:p(()=>e[217]||(e[217]=[g("立即同步")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"上传URL（预签名）",2),t("div",cn,[s(C,{modelValue:Fe.value,"onUpdate:modelValue":e[99]||(e[99]=a=>Fe.value=a),placeholder:"粘贴R2/S3预签名上传URL",class:"flex-1"},null,8,["modelValue"]),s(m,{disabled:!W.value,onClick:Vl},{default:p(()=>e[218]||(e[218]=[g("生成")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"下载URL（预签名）",2),t("div",mn,[s(C,{modelValue:Ge.value,"onUpdate:modelValue":e[100]||(e[100]=a=>Ge.value=a),placeholder:"粘贴R2/S3预签名下载URL",class:"flex-1"},null,8,["modelValue"]),s(m,{disabled:!W.value,onClick:Cl},{default:p(()=>e[219]||(e[219]=[g("生成")])),_:1},8,["disabled"])])])]),t("div",pn,[s(m,{color:"primary",onClick:hl},{default:p(()=>e[220]||(e[220]=[g("上传备份到云")])),_:1}),s(m,{color:"warning",onClick:kl},{default:p(()=>e[221]||(e[221]=[g("从云恢复备份")])),_:1}),s(m,{color:"blue",variant:"solid",disabled:!W.value||!h.publicBaseURL,onClick:Ul},{default:p(()=>e[222]||(e[222]=[g("按配置恢复")])),_:1},8,["disabled"])])],2)])],2)])])],2),Rt(t("div",{class:n(["flex fixed bottom-0 left-0 right-0 md:left-72 z-50 border-t px-3 py-3 justify-between items-center backdrop-blur-md shadow-xl",[o.value.bottomBg,o.value.border]])},[s(m,{icon:"i-heroicons-arrow-left",color:c.value==="light"?"gray":c.value==="midnight"?"blue":c.value==="slate"?"slate":"gray",variant:c.value==="light"?"soft":"solid",onClick:e[101]||(e[101]=a=>l.$router.push("/")),class:"shadow ring-1 ring-inset ring-slate-400/30 transition hover:opacity-90"},{default:p(()=>e[223]||(e[223]=[g(" 返回首页 ")])),_:1},8,["color","variant"]),Oe.value?(y(),k("div",gn,[s(m,{icon:"i-heroicons-power",color:"red",variant:"solid",onClick:gt,class:"shadow transition hover:opacity-90"},{default:p(()=>e[224]||(e[224]=[g(" 退出登录 ")])),_:1})])):(y(),k("div",vn,[s(m,{color:"primary",onClick:e[102]||(e[102]=a=>{ze.value=!0,de.value=!0})},{default:p(()=>e[225]||(e[225]=[g("登录")])),_:1}),s(m,{color:"secondary",onClick:e[103]||(e[103]=a=>{ze.value=!0,de.value=!1})},{default:p(()=>e[226]||(e[226]=[g("注册")])),_:1})]))],2),[[zl,$.value]]),M("",!0)]),s(ht,{modelValue:ze.value,"onUpdate:modelValue":e[138]||(e[138]=a=>ze.value=a)},{default:p(()=>[t("div",fn,[t("h3",{class:n(["text-xl font-semibold mb-4",o.value.text])},U(de.value?"用户登录":"用户注册"),3),s(El,{state:be,class:"space-y-4"},{default:p(()=>[s(kt,null,{default:p(()=>[s(C,{modelValue:be.username,"onUpdate:modelValue":e[134]||(e[134]=a=>be.username=a),placeholder:"用户名",class:"w-full"},null,8,["modelValue"])]),_:1}),s(kt,null,{default:p(()=>[s(C,{modelValue:be.password,"onUpdate:modelValue":e[135]||(e[135]=a=>be.password=a),type:"password",placeholder:"密码",class:"w-full"},null,8,["modelValue"])]),_:1}),t("div",bn,[s(m,{variant:"ghost",onClick:e[136]||(e[136]=a=>de.value=!de.value)},{default:p(()=>[g(U(de.value?"去注册":"去登录"),1)]),_:1}),s(m,{color:"primary",onClick:e[137]||(e[137]=a=>de.value?oe(R)(be):oe(r)(be))},{default:p(()=>[g(U(de.value?"登录":"注册"),1)]),_:1})])]),_:1},8,["state"])])]),_:1},8,["modelValue"]),t("input",{type:"file",ref_key:"fileInput",ref:De,accept:"image/*",multiple:"",class:"hidden",onChange:dl},null,544)],2)}}}),yn=ot(wn,[["__scopeId","data-v-9df8ce24"]]),Tn=$e({__name:"status",setup(i){const H=()=>{f().add({title:"恢复成功",description:"数据已恢复，页面即将刷新",color:"green",timeout:2e3}),setTimeout(()=>{window.location.reload()},2e3)};return(A,x)=>{const c=Bl;return y(),He(c,null,{default:p(()=>[s(yn,{onRestoreSuccess:H}),s($l)]),_:1})}}});export{Tn as default};
