import{m as Ol,n as Je,_ as vl,p as at,B as Wl,t as Kt,ai as na,a7 as ia,i as I,C as Fl,D as pt,q as b,v as f,K as t,G as $,a9 as qt,aj as da,A as ql,H as n,x as Gt,y as v,z as y,ak as ra,a2 as Jt,al as ua,L as ue,M as ce,I as s,am as _l,a8 as Kl,U as w,af as Gl,E as Ue,k as fe,w as Be,an as Jl,a4 as gl,J as m,$ as Vt,r as V,a1 as Xl,c as ca,h as he,N as ml,a5 as ma,aa as pa,a6 as Ml,ab as va,ad as ga,ae as fa,W as ba,V as mt,X as _e,Y as ke,Z as zl,ag as Nl,a0 as wa}from"./DAyM6u0O.js";import{b as Yl,_ as fl,a as ya}from"./BSuUlSAy.js";import{b as bl,_ as xa,a as ha,N as ka}from"./BnR-elf0.js";import{_ as Ca}from"./BzFrqvk_.js";import{_ as Zl}from"./BkEOo76i.js";import{_ as Va}from"./DLWNtYUj.js";const Ua={wrapper:"relative flex items-start",container:"flex items-center h-5",base:"h-4 w-4 dark:checked:bg-current dark:checked:border-transparent disabled:opacity-50 disabled:cursor-not-allowed focus:ring-0 focus:ring-transparent focus:ring-offset-transparent",form:"form-radio",color:"text-{color}-500 dark:text-{color}-400",background:"bg-white dark:bg-gray-900",border:"border border-gray-300 dark:border-gray-700",ring:"focus-visible:ring-2 focus-visible:ring-{color}-500 dark:focus-visible:ring-{color}-400 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-gray-900",inner:"ms-3 flex flex-col",label:"text-sm font-medium text-gray-700 dark:text-gray-200",required:"text-sm text-red-500 dark:text-red-400",help:"text-sm text-gray-500 dark:text-gray-400",default:{color:"primary"}},pl=Ol(Je.ui.strategy,Je.ui.radio,Ua),Ea=at({inheritAttrs:!1,props:{id:{type:String,default:null},value:{type:[String,Number,Boolean],default:null},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:null},disabled:{type:Boolean,default:!1},help:{type:String,default:null},label:{type:String,default:null},required:{type:Boolean,default:!1},color:{type:String,default:()=>pl.default.color,validator(p){return Je.ui.colors.includes(p)}},inputClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(p,{emit:J}){const{ui:M,attrs:U}=Wl("radio",Kt(p,"ui"),pl,Kt(p,"class")),u=p.id??na(),B=ia("radio-group",null),{emitFormChange:X,color:z,name:j}=B??Yl(p,pl),T=I({get(){return p.modelValue},set(W){J("update:modelValue",W),B||X()}});function P(W){J("change",W.target.value)}const o=I(()=>Fl(pt(M.value.base,M.value.form,M.value.background,M.value.border,z.value&&M.value.ring.replaceAll("{color}",z.value),z.value&&M.value.color.replaceAll("{color}",z.value)),p.inputClass));return{inputId:u,ui:M,attrs:U,pick:T,name:j,inputClass:o,onChange:P}}}),Ta=["data-n-ids"],La=["id","name","required","value","disabled"],Sa=["for"];function Aa(p,J,M,U,u,B){return f(),b("div",{class:n(p.ui.wrapper),"data-n-ids":p.attrs["data-n-ids"]},[t("div",{class:n(p.ui.container)},[qt(t("input",ql({id:p.inputId,"onUpdate:modelValue":J[0]||(J[0]=X=>p.pick=X),name:p.name,required:p.required,value:p.value,disabled:p.disabled,type:"radio",class:p.inputClass},p.attrs,{onChange:J[1]||(J[1]=(...X)=>p.onChange&&p.onChange(...X))}),null,16,La),[[da,p.pick]])],2),p.label||p.$slots.label?(f(),b("div",{key:0,class:n(p.ui.inner)},[t("label",{for:p.inputId,class:n(p.ui.label)},[Gt(p.$slots,"label",{label:p.label},()=>[v(y(p.label),1)]),p.required?(f(),b("span",{key:0,class:n(p.ui.required)},"*",2)):$("",!0)],10,Sa),p.help||p.$slots.help?(f(),b("p",{key:0,class:n(p.ui.help)},[Gt(p.$slots,"help",{help:p.help},()=>[v(y(p.help),1)])],2)):$("",!0)],2)):$("",!0)],10,Ta)}const Ba=vl(Ea,[["render",Aa]]),je=Ol(Je.ui.strategy,Je.ui.select,ra),$a=at({components:{UIcon:Jt},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>je.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>je.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(p){return Object.keys(je.size).includes(p)}},color:{type:String,default:()=>je.default.color,validator(p){return[...Je.ui.colors,...Object.keys(je.color)].includes(p)}},variant:{type:String,default:()=>je.default.variant,validator(p){return[...Object.keys(je.variant),...Object.values(je.color).flatMap(J=>Object.keys(J))].includes(p)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(p,{emit:J,slots:M}){const{ui:U,attrs:u}=Wl("select",Kt(p,"ui"),je,Kt(p,"class")),{size:B,rounded:X}=ua({ui:U,props:p}),{emitFormChange:z,inputId:j,color:T,size:P,name:o}=Yl(p,je),W=I(()=>B.value??P.value),ne=S=>{J("update:modelValue",S.target.value)},se=S=>{J("change",S.target.value),z()},k=S=>_l(S,p.valueAttribute,""),c=S=>_l(S,p.optionAttribute,""),N=S=>["string","number","boolean"].includes(typeof S)?{[p.valueAttribute]:S,[p.optionAttribute]:S}:{...S,[p.valueAttribute]:k(S),[p.optionAttribute]:c(S)},D=I(()=>p.options.map(S=>N(S))),O=I(()=>p.placeholder?[{[p.valueAttribute]:"",[p.optionAttribute]:p.placeholder,disabled:!0},...D.value]:D.value),Y=I(()=>{const S=N(p.modelValue),F=O.value.find(_=>_[p.valueAttribute]===S[p.valueAttribute]);return F?F[p.valueAttribute]:""}),ae=I(()=>{var F,_;const S=((_=(F=U.value.color)==null?void 0:F[T.value])==null?void 0:_[p.variant])||U.value.variant[p.variant];return Fl(pt(U.value.base,U.value.form,X.value,U.value.size[W.value],p.padded?U.value.padding[W.value]:"p-0",S==null?void 0:S.replaceAll("{color}",T.value),(g.value||M.leading)&&U.value.leading.padding[W.value],(be.value||M.trailing)&&U.value.trailing.padding[W.value]),p.placeholder&&!p.modelValue&&U.value.placeholder,p.selectClass)}),g=I(()=>p.icon&&p.leading||p.icon&&!p.trailing||p.loading&&!p.trailing||p.leadingIcon),be=I(()=>p.icon&&p.trailing||p.loading&&p.trailing||p.trailingIcon),we=I(()=>p.loading?p.loadingIcon:p.leadingIcon||p.icon),me=I(()=>p.loading&&!g.value?p.loadingIcon:p.trailingIcon||p.icon),Ee=I(()=>pt(U.value.icon.leading.wrapper,U.value.icon.leading.pointer,U.value.icon.leading.padding[W.value])),ze=I(()=>pt(U.value.icon.base,T.value&&Je.ui.colors.includes(T.value)&&U.value.icon.color.replaceAll("{color}",T.value),U.value.icon.size[W.value],p.loading&&U.value.icon.loading)),$e=I(()=>pt(U.value.icon.trailing.wrapper,U.value.icon.trailing.pointer,U.value.icon.trailing.padding[W.value])),Te=I(()=>pt(U.value.icon.base,T.value&&Je.ui.colors.includes(T.value)&&U.value.icon.color.replaceAll("{color}",T.value),U.value.icon.size[W.value],p.loading&&!g.value&&U.value.icon.loading));return{ui:U,attrs:u,name:o,inputId:j,normalizedOptionsWithPlaceholder:O,normalizedValue:Y,isLeading:g,isTrailing:be,selectClass:ae,leadingIconName:we,leadingIconClass:ze,leadingWrapperIconClass:Ee,trailingIconName:me,trailingIconClass:Te,trailingWrapperIconClass:$e,onInput:ne,onChange:se}}}),Ra=["id","name","value","required","disabled"],ja=["value","label"],Pa=["value","selected","disabled","textContent"],Ia=["value","selected","disabled","textContent"];function Da(p,J,M,U,u,B){const X=Jt;return f(),b("div",{class:n(p.ui.wrapper)},[t("select",ql({id:p.inputId,name:p.name,value:p.modelValue,required:p.required,disabled:p.disabled,class:p.selectClass},p.attrs,{onInput:J[0]||(J[0]=(...z)=>p.onInput&&p.onInput(...z)),onChange:J[1]||(J[1]=(...z)=>p.onChange&&p.onChange(...z))}),[(f(!0),b(ue,null,ce(p.normalizedOptionsWithPlaceholder,(z,j)=>(f(),b(ue,null,[z.children?(f(),b("optgroup",{key:`${z[p.valueAttribute]}-optgroup-${j}`,value:z[p.valueAttribute],label:z[p.optionAttribute]},[(f(!0),b(ue,null,ce(z.children,(T,P)=>(f(),b("option",{key:`${T[p.valueAttribute]}-${j}-${P}`,value:T[p.valueAttribute],selected:T[p.valueAttribute]===p.normalizedValue,disabled:T.disabled,textContent:y(T[p.optionAttribute])},null,8,Pa))),128))],8,ja)):(f(),b("option",{key:`${z[p.valueAttribute]}-${j}`,value:z[p.valueAttribute],selected:z[p.valueAttribute]===p.normalizedValue,disabled:z.disabled,textContent:y(z[p.optionAttribute])},null,8,Ia))],64))),256))],16,Ra),p.isLeading&&p.leadingIconName||p.$slots.leading?(f(),b("span",{key:0,class:n(p.leadingWrapperIconClass)},[Gt(p.$slots,"leading",{disabled:p.disabled,loading:p.loading},()=>[s(X,{name:p.leadingIconName,class:n(p.leadingIconClass)},null,8,["name","class"])],!0)],2)):$("",!0),p.isTrailing&&p.trailingIconName||p.$slots.trailing?(f(),b("span",{key:1,class:n(p.trailingWrapperIconClass)},[Gt(p.$slots,"trailing",{disabled:p.disabled,loading:p.loading},()=>[s(X,{name:p.trailingIconName,class:n(p.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):$("",!0)],2)}const Ql=vl($a,[["render",Da],["__scopeId","data-v-db8f1118"]]),Ha=()=>{const p=Kl(),J=w(),M=Gl(),U=async()=>{const j=await p.getStatus();return j&&p.setUserStatus(j),j},u=async j=>{await p.register(j)&&J.add({title:"注册成功",description:"欢迎使用！请登录",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3})},B=async j=>{await p.login(j)&&(await U(),J.add({title:"登录成功",description:"欢迎回来！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}))},X=async()=>{await p.logout(),p.clearUserStatus(),J.add({title:"注销成功",description:"欢迎再次使用！",icon:"i-fluent-checkmark-starburst-16-filled",color:"green",timeout:1e3}),M.push("/")},z=async()=>await U();return Ue(async()=>{await U()}),{register:u,login:B,logout:X,getStatus:z}},_a={class:"rounded-lg p-4 mb-6"},Ma={class:"flex justify-between items-center mb-4"},za={class:"flex justify-between items-center mb-2"},Na={class:"flex items-center gap-2"},Oa={key:0,class:"space-y-2"},Wa={class:"flex justify-end gap-2"},Fa={class:"flex justify-between items-center mb-2"},qa={class:"flex items-center gap-2"},Ka={key:0,class:"space-y-2"},Ga={class:"flex justify-end gap-2"},Ja={class:"flex justify-between items-center mb-2"},Xa={class:"flex items-center gap-2"},Ya={key:0,class:"space-y-2"},Za={class:"flex justify-end gap-2"},Qa={class:"flex justify-between items-center mb-2"},eo={class:"flex items-center gap-2"},to={key:0,class:"space-y-2"},lo={class:"flex justify-end gap-2"},so={class:"flex justify-between items-center mb-2"},ao={class:"flex items-center gap-2"},oo={key:0,class:"space-y-2"},no={class:"flex justify-end gap-2"},io={class:"flex justify-between items-center mb-2"},ro={class:"flex items-center gap-2"},uo={key:0,class:"space-y-2"},co={class:"flex justify-end gap-2"},mo=at({__name:"NotifyPanel",props:{config:{},immediate:{type:Boolean},subtleBg:{},text:{},mutedText:{},disabled:{type:Boolean}},emits:["save"],setup(p,{emit:J}){const M=J,U=p,u=fe({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:"",twitterEnabled:!1,twitterApiKey:"",twitterApiSecret:"",twitterAccessToken:"",twitterAccessTokenSecret:"",customHttpEnabled:!1,customHttpUrl:"",customHttpMethod:"POST",customHttpHeaders:"",customHttpBody:'{"content":"{{content}}"}'}),B=fe({webhook:!1,telegram:!1,wework:!1,feishu:!1,twitter:!1,customHttp:!1}),X=["webhook","telegram","wework","feishu","twitter","customHttp"],z=k=>({webhook:"Webhook",telegram:"Telegram",wework:"企业微信",feishu:"飞书",twitter:"Twitter",customHttp:"自定义HTTP"})[k]||k,j=k=>{const c=k.toLowerCase();Object.keys(u).forEach(N=>{N.toLowerCase().startsWith(c)&&(u[N]=U.config[N])}),B[k]=!1},T=k=>{var N,D,O,Y,ae,g,be,we,me,Ee;const c=u;switch(k){case"webhook":return c.webhookEnabled&&!!((N=c.webhookURL)!=null&&N.trim());case"telegram":return c.telegramEnabled&&!!((D=c.telegramToken)!=null&&D.trim())&&!!((O=c.telegramChatID)!=null&&O.trim());case"wework":return c.weworkEnabled&&!!((Y=c.weworkKey)!=null&&Y.trim());case"feishu":return c.feishuEnabled&&!!((ae=c.feishuWebhook)!=null&&ae.trim());case"twitter":return c.twitterEnabled&&!!((g=c.twitterApiKey)!=null&&g.trim())&&!!((be=c.twitterApiSecret)!=null&&be.trim())&&!!((we=c.twitterAccessToken)!=null&&we.trim())&&!!((me=c.twitterAccessTokenSecret)!=null&&me.trim());case"customHttp":return c.customHttpEnabled&&!!((Ee=c.customHttpUrl)!=null&&Ee.trim());default:return!1}},P=async k=>{try{switch(k){case"webhook":if(u.webhookEnabled&&!u.webhookURL)throw new Error("Webhook URL不能为空");break;case"telegram":if(u.telegramEnabled&&(!u.telegramToken||!u.telegramChatID))throw new Error("Telegram配置不完整");break;case"wework":if(u.weworkEnabled&&!u.weworkKey)throw new Error("企业微信Key不能为空");break;case"feishu":if(u.feishuEnabled&&!u.feishuWebhook)throw new Error("飞书Webhook不能为空");break;case"twitter":if(u.twitterEnabled&&(!u.twitterApiKey||!u.twitterApiSecret||!u.twitterAccessToken||!u.twitterAccessTokenSecret))throw new Error("Twitter配置不完整");break;case"customHttp":if(u.customHttpEnabled&&!u.customHttpUrl)throw new Error("自定义HTTP URL不能为空");break}const c={webhookEnabled:u.webhookEnabled,webhookURL:u.webhookURL,telegramEnabled:u.telegramEnabled,telegramToken:u.telegramToken,telegramChatID:u.telegramChatID,weworkEnabled:u.weworkEnabled,weworkKey:u.weworkKey,feishuEnabled:u.feishuEnabled,feishuWebhook:u.feishuWebhook,feishuSecret:u.feishuSecret,twitterEnabled:u.twitterEnabled,twitterApiKey:u.twitterApiKey,twitterApiSecret:u.twitterApiSecret,twitterAccessToken:u.twitterAccessToken,twitterAccessTokenSecret:u.twitterAccessTokenSecret,customHttpEnabled:u.customHttpEnabled,customHttpUrl:u.customHttpUrl,customHttpMethod:u.customHttpMethod,customHttpHeaders:u.customHttpHeaders,customHttpBody:u.customHttpBody},N=Vt().public.baseApi||"/api",O=await(await fetch(`${N}/notify/config`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)})).json();if(O.code===1)B[k]=!1,O.data&&Object.keys(O.data).forEach(Y=>{Y.endsWith("Enabled")?u[Y]=!!O.data[Y]&&O.data[Y]!=="false":u[Y]=O.data[Y]||""}),M("save",{...u}),w().add({title:"成功",description:`${z(k)}配置已保存`,color:"green"});else throw new Error(O.msg||"保存失败")}catch(c){console.error("保存配置失败:",c),w().add({title:"错误",description:c.message||"保存失败",color:"red"})}},o=async k=>{try{if(!T(k))throw new Error(`请先完成并启用${z(k)}配置`);const N=await(await fetch("/api/notify/test",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({type:k})})).json();if(N.code===1)w().add({title:"成功",description:`${z(k)}测试消息已发送`,color:"green"});else throw new Error(N.msg||"测试失败")}catch(c){console.error("测试失败:",c),w().add({title:"错误",description:c.message||"测试失败",color:"red"})}};Be(()=>U.config,k=>{k&&Object.keys(u).forEach(c=>{k[c]!==void 0&&(c.endsWith("Enabled")?u[c]=!!k[c]&&k[c]!=="false":u[c]=k[c])})},{deep:!0,immediate:!0}),Ue(async()=>{try{const c=await(await fetch("/api/notify/config",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();if(c.code===1&&c.data){const N=c.data;Object.keys(N).forEach(D=>{D.endsWith("Enabled")?u[D]=!!N[D]&&N[D]!=="false":u[D]=N[D]||""}),console.log("加载的配置:",u)}}catch(k){console.error("获取配置失败:",k),w().add({title:"错误",description:"获取推送配置失败",color:"red"})}});const W=I(()=>U.subtleBg||"bg-gray-800"),ne=I(()=>U.text||"text-white"),se=I(()=>U.mutedText||"text-gray-300");return(k,c)=>{const N=Jl("USwitch"),D=gl,O=fl,Y=Ql,ae=bl;return f(),b("div",_a,[t("div",Ma,[t("h2",{class:n(["text-xl font-semibold",ne.value])},"推送渠道配置",2)]),t("div",{class:n(["space-y-4",U.disabled?"opacity-60 pointer-events-none":""])},[t("div",{class:n(["rounded p-3",W.value])},[t("div",za,[t("span",{class:n(se.value)},"Webhook推送",2),t("div",Na,[s(N,{modelValue:u.webhookEnabled,"onUpdate:modelValue":c[0]||(c[0]=g=>u.webhookEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[1]||(c[1]=g=>B.webhook=!B.webhook),color:B.webhook?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.webhook?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.webhook?(f(),b("div",Oa,[s(O,{modelValue:u.webhookURL,"onUpdate:modelValue":c[2]||(c[2]=g=>u.webhookURL=g),placeholder:"Webhook URL"},null,8,["modelValue"]),t("div",Wa,[s(D,{onClick:c[3]||(c[3]=g=>j("webhook")),variant:"ghost",color:"gray"},{default:m(()=>c[38]||(c[38]=[v(" 重置 ")])),_:1}),s(D,{onClick:c[4]||(c[4]=g=>P("webhook")),color:"primary"},{default:m(()=>c[39]||(c[39]=[v(" 保存 ")])),_:1})])])):$("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",Fa,[t("span",{class:n(se.value)},"Telegram推送",2),t("div",qa,[s(N,{modelValue:u.telegramEnabled,"onUpdate:modelValue":c[5]||(c[5]=g=>u.telegramEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[6]||(c[6]=g=>B.telegram=!B.telegram),color:B.telegram?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.telegram?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.telegram?(f(),b("div",Ka,[s(O,{modelValue:u.telegramToken,"onUpdate:modelValue":c[7]||(c[7]=g=>u.telegramToken=g),placeholder:"Bot Token"},null,8,["modelValue"]),s(O,{modelValue:u.telegramChatID,"onUpdate:modelValue":c[8]||(c[8]=g=>u.telegramChatID=g),placeholder:"Chat ID"},null,8,["modelValue"]),t("div",Ga,[s(D,{onClick:c[9]||(c[9]=g=>j("telegram")),variant:"ghost",color:"gray"},{default:m(()=>c[40]||(c[40]=[v(" 重置 ")])),_:1}),s(D,{onClick:c[10]||(c[10]=g=>P("telegram")),color:"primary"},{default:m(()=>c[41]||(c[41]=[v(" 保存 ")])),_:1})])])):$("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",Ja,[t("span",{class:n(se.value)},"企业微信推送",2),t("div",Xa,[s(N,{modelValue:u.weworkEnabled,"onUpdate:modelValue":c[11]||(c[11]=g=>u.weworkEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[12]||(c[12]=g=>B.wework=!B.wework),color:B.wework?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.wework?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.wework?(f(),b("div",Ya,[s(O,{modelValue:u.weworkKey,"onUpdate:modelValue":c[13]||(c[13]=g=>u.weworkKey=g),placeholder:"WebHook Key"},null,8,["modelValue"]),t("div",Za,[s(D,{onClick:c[14]||(c[14]=g=>j("wework")),variant:"ghost",color:"gray"},{default:m(()=>c[42]||(c[42]=[v(" 重置 ")])),_:1}),s(D,{onClick:c[15]||(c[15]=g=>P("wework")),color:"primary"},{default:m(()=>c[43]||(c[43]=[v(" 保存 ")])),_:1})])])):$("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",Qa,[t("span",{class:n(se.value)},"飞书推送",2),t("div",eo,[s(N,{modelValue:u.feishuEnabled,"onUpdate:modelValue":c[16]||(c[16]=g=>u.feishuEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[17]||(c[17]=g=>B.feishu=!B.feishu),color:B.feishu?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.feishu?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.feishu?(f(),b("div",to,[s(O,{modelValue:u.feishuWebhook,"onUpdate:modelValue":c[18]||(c[18]=g=>u.feishuWebhook=g),placeholder:"WebHook URL"},null,8,["modelValue"]),s(O,{modelValue:u.feishuSecret,"onUpdate:modelValue":c[19]||(c[19]=g=>u.feishuSecret=g),placeholder:"签名密钥",type:"password"},null,8,["modelValue"]),t("div",lo,[s(D,{onClick:c[20]||(c[20]=g=>j("feishu")),variant:"ghost",color:"gray"},{default:m(()=>c[44]||(c[44]=[v(" 重置 ")])),_:1}),s(D,{onClick:c[21]||(c[21]=g=>P("feishu")),color:"primary"},{default:m(()=>c[45]||(c[45]=[v(" 保存 ")])),_:1})])])):$("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",so,[t("span",{class:n(se.value)},"Twitter推送",2),t("div",ao,[s(N,{modelValue:u.twitterEnabled,"onUpdate:modelValue":c[22]||(c[22]=g=>u.twitterEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[23]||(c[23]=g=>B.twitter=!B.twitter),color:B.twitter?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.twitter?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.twitter?(f(),b("div",oo,[s(O,{modelValue:u.twitterApiKey,"onUpdate:modelValue":c[24]||(c[24]=g=>u.twitterApiKey=g),placeholder:"API Key"},null,8,["modelValue"]),s(O,{modelValue:u.twitterApiSecret,"onUpdate:modelValue":c[25]||(c[25]=g=>u.twitterApiSecret=g),placeholder:"API Secret"},null,8,["modelValue"]),s(O,{modelValue:u.twitterAccessToken,"onUpdate:modelValue":c[26]||(c[26]=g=>u.twitterAccessToken=g),placeholder:"Access Token"},null,8,["modelValue"]),s(O,{modelValue:u.twitterAccessTokenSecret,"onUpdate:modelValue":c[27]||(c[27]=g=>u.twitterAccessTokenSecret=g),placeholder:"Access Token Secret"},null,8,["modelValue"]),t("div",no,[s(D,{onClick:c[28]||(c[28]=g=>j("twitter")),variant:"ghost",color:"gray"},{default:m(()=>c[46]||(c[46]=[v("重置")])),_:1}),s(D,{onClick:c[29]||(c[29]=g=>P("twitter")),color:"primary"},{default:m(()=>c[47]||(c[47]=[v("保存")])),_:1})])])):$("",!0)],2),t("div",{class:n(["rounded p-3",W.value])},[t("div",io,[t("span",{class:n(se.value)},"自定义HTTP推送",2),t("div",ro,[s(N,{modelValue:u.customHttpEnabled,"onUpdate:modelValue":c[30]||(c[30]=g=>u.customHttpEnabled=g)},null,8,["modelValue"]),s(D,{size:"sm",onClick:c[31]||(c[31]=g=>B.customHttp=!B.customHttp),color:B.customHttp?"gray":"primary",variant:"soft"},{default:m(()=>[v(y(B.customHttp?"取消":"编辑"),1)]),_:1},8,["color"])])]),B.customHttp?(f(),b("div",uo,[s(O,{modelValue:u.customHttpUrl,"onUpdate:modelValue":c[32]||(c[32]=g=>u.customHttpUrl=g),placeholder:"请求URL"},null,8,["modelValue"]),s(Y,{modelValue:u.customHttpMethod,"onUpdate:modelValue":c[33]||(c[33]=g=>u.customHttpMethod=g),options:["POST","PUT","PATCH"]},null,8,["modelValue"]),s(ae,{modelValue:u.customHttpHeaders,"onUpdate:modelValue":c[34]||(c[34]=g=>u.customHttpHeaders=g),placeholder:"请求Headers（JSON格式）"},null,8,["modelValue"]),s(ae,{modelValue:u.customHttpBody,"onUpdate:modelValue":c[35]||(c[35]=g=>u.customHttpBody=g),placeholder:'请求Body模板（如：{"content":"{{content}}"})'},null,8,["modelValue"]),t("div",co,[s(D,{onClick:c[36]||(c[36]=g=>j("customHttp")),variant:"ghost",color:"gray"},{default:m(()=>c[48]||(c[48]=[v("重置")])),_:1}),s(D,{onClick:c[37]||(c[37]=g=>P("customHttp")),color:"primary"},{default:m(()=>c[49]||(c[49]=[v("保存")])),_:1})])])):$("",!0)],2)],2),t("div",{class:n(["mt-4 flex flex-wrap gap-2",U.disabled?"opacity-60 pointer-events-none":""])},[(f(),b(ue,null,ce(X,g=>s(D,{key:g,onClick:be=>o(g),class:"flex-grow sm:flex-grow-0",variant:"solid",disabled:U.disabled},{default:m(()=>[v(" 测试"+y(z(g)),1)]),_:2},1032,["onClick","disabled"])),64))],2)])}}}),po={class:"flex flex-col gap-3 w-full"},vo={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-3"},go=["innerHTML"],fo=["innerHTML"],bo=at({__name:"CommentsSettings",props:{config:{},theme:{}},emits:["update:config","comment-system-changed"],setup(p,{emit:J}){const M=p,U=J,u=fe({commentEnabled:!1,commentSystem:"builtin",commentEmailEnabled:!1,commentEmailReplyName:"",commentEmailAdminPrefix:"",commentEmailReplyPrefix:"",commentEmailReplyTemplate:"",commentEmailAdminTemplate:"",commentEmailReplyTemplateHTML:"",commentEmailAdminTemplateHTML:""});Be(()=>M.config,T=>{T&&(u.commentEnabled=!!T.commentEnabled,u.commentSystem="builtin",u.commentEmailEnabled=!!T.commentEmailEnabled,u.commentEmailReplyName=String(T.commentEmailReplyName||""),u.commentEmailAdminPrefix=String(T.commentEmailAdminPrefix||""),u.commentEmailReplyPrefix=String(T.commentEmailReplyPrefix||""),u.commentEmailReplyTemplate=String(T.commentEmailReplyTemplate||""),u.commentEmailAdminTemplate=String(T.commentEmailAdminTemplate||""),u.commentEmailSiteURL=String(T.commentEmailSiteURL||""),u.commentEmailReplyTemplateHTML=String(T.commentEmailReplyTemplateHTML||""),u.commentEmailAdminTemplateHTML=String(T.commentEmailAdminTemplateHTML||""))},{immediate:!0,deep:!0}),Be(()=>u.commentSystem,T=>{const P=String(T||"").toLowerCase();P==="builtin"&&(u.walineServerURL=""),U("comment-system-changed",P)});const B=I(()=>"bg-gray-800");I(()=>"text-slate-400");const X=I(()=>"text-white"),z=I(()=>{var k;const T=String(((k=M.config)==null?void 0:k.siteTitle)||"站点"),P="Mike",o="这里是示例内容",W=String(u.commentEmailSiteURL||""),ne=(W?W.replace(/\/$/,""):"")+"/m/123";return(u.commentEmailReplyTemplateHTML||`
<div>
  <p>您在<strong>{site}</strong>主页上的内容有了新的评论</p>
  <p><strong>{nick}</strong> 回复说：</p>
  <p>{content}</p>
  <p>您可以点击查看回复的完整内容：<a href="{url}" target="_blank">{url}</a></p>
</div>`).replaceAll("{site}",T).replaceAll("{nick}",P).replaceAll("{content}",o).replaceAll("{url}",ne)}),j=I(()=>{var N;const T=String(((N=M.config)==null?void 0:N.siteTitle)||"站点"),P="Mike",o="mike@example.com",W="https://example.com",ne="这里是示例内容",se=String(u.commentEmailSiteURL||""),k=(se?se.replace(/\/$/,""):"")+"/m/123";return(u.commentEmailAdminTemplateHTML||`
<div>
  <p>站点：<strong>{site}</strong></p>
  <p>用户：{nick}（{mail}）</p>
  <p>网址：<a href="{link}" target="_blank">{link}</a></p>
  <p>内容：</p>
  <div>{content}</div>
  <p>查看：<a href="{url}" target="_blank">{url}</a></p>
</div>`).replaceAll("{site}",T).replaceAll("{nick}",P).replaceAll("{mail}",o).replaceAll("{link}",W).replaceAll("{content}",ne).replaceAll("{url}",k)});return(T,P)=>{var ne,se,k,c,N,D,O,Y,ae,g,be,we,me,Ee,ze,$e,Te;const o=fl,W=bl;return f(),b("div",{id:"site-comments-section",class:n(["flex flex-wrap items-center rounded-lg p-3 justify-between gap-3",((ne=T.theme)==null?void 0:ne.subtleBg)||B.value])},[t("div",po,[u.commentSystem==="builtin"&&!((se=M.config)!=null&&se.commentEmailEnabled)?(f(),b("div",{key:0,class:n(["rounded border p-3",(k=T.theme)==null?void 0:k.border])},[t("div",{class:n(((c=T.theme)==null?void 0:c.text)||X.value)},"开启“邮件通知”后，可配置站点链接地址、主题前缀、发件显示名、文本/HTML 模板，并实时预览。",2)],2)):$("",!0),u.commentSystem==="builtin"&&((N=M.config)!=null&&N.commentEmailEnabled)?(f(),b("div",vo,[s(o,{modelValue:u.commentEmailSiteURL,"onUpdate:modelValue":P[0]||(P[0]=S=>u.commentEmailSiteURL=S),ui:{base:(D=T.theme)==null?void 0:D.text},placeholder:"站点链接地址（用于邮件中的 {url} 基础） 如 https://note.noisework.cn"},null,8,["modelValue","ui"]),s(o,{modelValue:u.commentEmailReplyName,"onUpdate:modelValue":P[1]||(P[1]=S=>u.commentEmailReplyName=S),ui:{base:(O=T.theme)==null?void 0:O.text},placeholder:"邮件发件显示名（回复通知）"},null,8,["modelValue","ui"]),s(o,{modelValue:u.commentEmailAdminPrefix,"onUpdate:modelValue":P[2]||(P[2]=S=>u.commentEmailAdminPrefix=S),ui:{base:(Y=T.theme)==null?void 0:Y.text},placeholder:"管理员通知主题前缀（可选）"},null,8,["modelValue","ui"]),s(o,{modelValue:u.commentEmailReplyPrefix,"onUpdate:modelValue":P[3]||(P[3]=S=>u.commentEmailReplyPrefix=S),ui:{base:(ae=T.theme)==null?void 0:ae.text},placeholder:"回复通知主题前缀（可选）"},null,8,["modelValue","ui"]),s(W,{modelValue:u.commentEmailReplyTemplate,"onUpdate:modelValue":P[4]||(P[4]=S=>u.commentEmailReplyTemplate=S),ui:{base:(g=T.theme)==null?void 0:g.text},placeholder:"回复通知正文模板（默认示例）支持 {site} {nick} {content} {url}"},null,8,["modelValue","ui"]),s(W,{modelValue:u.commentEmailAdminTemplate,"onUpdate:modelValue":P[5]||(P[5]=S=>u.commentEmailAdminTemplate=S),ui:{base:(be=T.theme)==null?void 0:be.text},placeholder:"管理员通知正文模板（可选）支持 {site} {nick} {mail} {link} {content} {url}"},null,8,["modelValue","ui"]),s(W,{modelValue:u.commentEmailReplyTemplateHTML,"onUpdate:modelValue":P[6]||(P[6]=S=>u.commentEmailReplyTemplateHTML=S),ui:{base:(we=T.theme)==null?void 0:we.text},placeholder:"回复通知 HTML 模板（可选）支持 {site} {nick} {content} {url}"},null,8,["modelValue","ui"]),s(W,{modelValue:u.commentEmailAdminTemplateHTML,"onUpdate:modelValue":P[7]||(P[7]=S=>u.commentEmailAdminTemplateHTML=S),ui:{base:(me=T.theme)==null?void 0:me.text},placeholder:"管理员通知 HTML 模板（可选）支持 {site} {nick} {mail} {link} {content} {url}"},null,8,["modelValue","ui"]),t("div",{class:n(["md:col-span-3 rounded border p-3",(Ee=T.theme)==null?void 0:Ee.border])},[t("div",{class:n((ze=T.theme)==null?void 0:ze.text)},"回复通知富文本预览",2),t("div",{class:"mt-2 rounded p-2 bg-white text-black",innerHTML:z.value},null,8,go)],2),t("div",{class:n(["md:col-span-3 rounded border p-3",($e=T.theme)==null?void 0:$e.border])},[t("div",{class:n((Te=T.theme)==null?void 0:Te.text)},"管理员通知富文本预览",2),t("div",{class:"mt-2 rounded p-2 bg-white text-black",innerHTML:j.value},null,8,fo)],2)])):$("",!0)])],2)}}}),wo={class:"px-4 py-3 flex items-center justify-between"},yo={class:"flex items-center gap-2"},xo={class:"px-4"},ho={class:"flex gap-2 mb-3"},ko={key:0},Co={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Vo={class:"flex items-center justify-between"},Uo={class:"flex items-center gap-2"},Eo=["src"],To={class:"mt-2"},Lo={key:1,class:"space-y-2"},So={class:"flex items-center gap-2"},Ao={key:0,class:"md:col-span-2 flex justify-center mt-2"},Bo={key:1,class:"md:col-span-2 flex justify-center mt-2"},$o={key:1},Ro={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},jo={class:"flex items-center justify-between"},Po={class:"flex items-center gap-2"},Io=["src"],Do={class:"mt-2"},Ho={key:1,class:"space-y-2"},_o={class:"flex items-center gap-2"},Mo={key:0,class:"md:col-span-2 flex justify-center mt-2"},zo={key:1,class:"md:col-span-2 flex justify-center mt-2"},No={class:"flex justify-end gap-2 mt-3"},Oo=at({__name:"AttachmentManager",props:{theme:{}},setup(p){const J=p,M=V("images"),U=V([]),u=V([]),B=V(!1),X=V({}),z=V(!1),j=V(!1),T=V("image"),P=V(null),o=V(4),W=V(4),ne=Vt().public.baseApi||"/api",se=_=>{const E=typeof window<"u"?window.location.origin:"";return _.startsWith("http")?_:(_.startsWith("/api"),E+_)},k=_=>_<1024?`${_} B`:_<1024*1024?`${(_/1024).toFixed(1)} KB`:_<1024*1024*1024?`${(_/1024/1024).toFixed(1)} MB`:`${(_/1024/1024/1024).toFixed(1)} GB`,c=_=>new Date(_).toLocaleString(),N=_=>!!X.value[_.name],D=_=>{X.value[_.name]=!X.value[_.name]},O=async()=>{const E=await(await fetch(`${ne}/attachments/images`,{credentials:"include"})).json().catch(()=>null),pe=E&&E.code===1&&Array.isArray(E.data)?E.data:[];U.value=pe.filter(le=>/\.(png|jpe?g|gif|webp)$/i.test(String(le.name||""))),o.value=4},Y=async()=>{const E=await(await fetch(`${ne}/attachments/video`,{credentials:"include"})).json().catch(()=>null),pe=E&&E.code===1&&Array.isArray(E.data)?E.data:[];u.value=pe.filter(le=>/\.(mp4|webm|mov|avi)$/i.test(String(le.name||""))),W.value=4},ae=async()=>{try{B.value=!0,await Promise.all([O(),Y()])}finally{B.value=!1}};Ue(ae);const g=(_,E)=>{T.value=_,P.value=E,z.value=!0},be=async()=>{if(P.value)try{j.value=!0;const _=`${ne}/attachments/${T.value==="image"?"images":"video"}/${encodeURIComponent(P.value.name)}`,E=await fetch(_,{method:"DELETE",credentials:"include"}),pe=await E.json().catch(()=>null);if(!E.ok||!pe||pe.code!==1)throw new Error((pe==null?void 0:pe.msg)||"删除失败");w().add({title:"已删除",color:"green"}),z.value=!1,P.value=null,await ae()}catch(_){w().add({title:"删除失败",description:_==null?void 0:_.message,color:"red"})}finally{j.value=!1}},we=I(()=>U.value.slice(0,o.value)),me=I(()=>u.value.slice(0,W.value)),Ee=()=>{o.value+=4},ze=()=>{W.value+=4},$e=()=>{o.value=4},Te=()=>{W.value=4},S=_=>{const E=document.createElement("a");E.href=se(_.url),E.download=_.name||"",document.body.appendChild(E),E.click(),document.body.removeChild(E)},F=I(()=>J.theme||{});return(_,E)=>{var gt,Ut,ft,Ne;const pe=Jt,le=gl,Xt=Xl,vt=Zl;return f(),b("div",{class:n(["rounded-xl",(gt=F.value)==null?void 0:gt.cardBg])},[t("div",wo,[t("div",{class:n(["font-semibold flex items-center gap-2",(Ut=F.value)==null?void 0:Ut.text])},[s(pe,{name:"i-heroicons-paper-clip",class:"w-5 h-5 text-indigo-300"}),E[4]||(E[4]=t("span",null,"附件管理",-1))],2),t("div",yo,[s(le,{loading:B.value,color:"gray",variant:"soft",class:"shadow",onClick:ae},{default:m(()=>E[5]||(E[5]=[v("刷新")])),_:1},8,["loading"])])]),t("div",xo,[t("div",ho,[s(le,{color:M.value==="images"?"primary":"gray",variant:"soft",onClick:E[0]||(E[0]=q=>M.value="images")},{default:m(()=>E[6]||(E[6]=[v("图片")])),_:1},8,["color"]),s(le,{color:M.value==="videos"?"primary":"gray",variant:"soft",onClick:E[1]||(E[1]=q=>M.value="videos")},{default:m(()=>E[7]||(E[7]=[v("视频")])),_:1},8,["color"])]),M.value==="images"?(f(),b("div",ko,[U.value.length===0?(f(),b("div",{key:0,class:n(["text-sm",(ft=F.value)==null?void 0:ft.mutedText])},"暂无图片附件",2)):(f(),b("div",Co,[(f(!0),b(ue,null,ce(we.value,q=>{var Ce,Oe,Le,Re,Xe,Ye;return f(),b("div",{key:q.name,class:n(["rounded-lg border p-3",(Ce=F.value)==null?void 0:Ce.border])},[t("div",Vo,[t("div",null,[t("div",{class:n(["text-sm",(Oe=F.value)==null?void 0:Oe.text])},y(q.name),3),t("div",{class:n(["text-xs",(Le=F.value)==null?void 0:Le.mutedText])},y(k(q.size))+" · "+y(c(q.modified_at)),3)]),t("div",Uo,[s(le,{size:"xs",icon:"i-heroicons-arrow-down-tray",color:"gray",variant:"soft",onClick:ie=>S(q)},{default:m(()=>E[8]||(E[8]=[v("下载")])),_:2},1032,["onClick"]),s(le,{size:"xs",icon:"i-heroicons-trash",color:"red",variant:"soft",onClick:ie=>g("image",q)},{default:m(()=>E[9]||(E[9]=[v("删除")])),_:2},1032,["onClick"])])]),t("img",{src:se(q.url),class:"mt-2 rounded w-full max-h-40 object-contain bg-black/20",loading:"lazy"},null,8,Eo),t("div",To,[s(le,{size:"xs",color:"gray",variant:"ghost",onClick:ie=>D(q)},{default:m(()=>[v(y(N(q)?"收起关联内容":"查看关联内容"),1)]),_:2},1032,["onClick"]),N(q)?(f(),b("div",{key:0,class:n(["mt-2 rounded p-2",(Re=F.value)==null?void 0:Re.subtleBg])},[(Xe=q.belongs)!=null&&Xe.length?(f(),b("div",Lo,[(f(!0),b(ue,null,ce(q.belongs,ie=>{var Ze,Pe,Qe,et;return f(),b("div",{key:ie.id,class:n(["text-xs",(Ze=F.value)==null?void 0:Ze.text])},[t("div",So,[t("span",{class:n(["px-2 py-1 rounded text-[10px]",(Pe=F.value)==null?void 0:Pe.subtleBg])},"#"+y(ie.id),3),t("span",{class:n((Qe=F.value)==null?void 0:Qe.mutedText)},y(c(ie.created_at)),3)]),t("div",{class:n(["mt-1 line-clamp-2",(et=F.value)==null?void 0:et.mutedText])},y(ie.snippet),3)],2)}),128))])):(f(),b("div",{key:0,class:n(["text-xs",(Ye=F.value)==null?void 0:Ye.mutedText])},"无关联内容",2))],2)):$("",!0)])],2)}),128)),U.value.length>we.value.length?(f(),b("div",Ao,[s(le,{color:"gray",variant:"soft",onClick:Ee},{default:m(()=>E[10]||(E[10]=[v("加载更多")])),_:1})])):U.value.length>4?(f(),b("div",Bo,[s(le,{color:"gray",variant:"soft",onClick:$e},{default:m(()=>E[11]||(E[11]=[v("收起")])),_:1})])):$("",!0)]))])):(f(),b("div",$o,[u.value.length===0?(f(),b("div",{key:0,class:n(["text-sm",(Ne=F.value)==null?void 0:Ne.mutedText])},"暂无视频附件",2)):(f(),b("div",Ro,[(f(!0),b(ue,null,ce(me.value,q=>{var Ce,Oe,Le,Re,Xe,Ye;return f(),b("div",{key:q.name,class:n(["rounded-lg border p-3",(Ce=F.value)==null?void 0:Ce.border])},[t("div",jo,[t("div",null,[t("div",{class:n(["text-sm",(Oe=F.value)==null?void 0:Oe.text])},y(q.name),3),t("div",{class:n(["text-xs",(Le=F.value)==null?void 0:Le.mutedText])},y(k(q.size))+" · "+y(c(q.modified_at)),3)]),t("div",Po,[s(le,{size:"xs",icon:"i-heroicons-arrow-down-tray",color:"gray",variant:"soft",onClick:ie=>S(q)},{default:m(()=>E[12]||(E[12]=[v("下载")])),_:2},1032,["onClick"]),s(le,{size:"xs",icon:"i-heroicons-trash",color:"red",variant:"soft",onClick:ie=>g("video",q)},{default:m(()=>E[13]||(E[13]=[v("删除")])),_:2},1032,["onClick"])])]),t("video",{src:se(q.url),class:"mt-2 rounded w-full max-h-64 bg-black/20",controls:"",preload:"metadata"},null,8,Io),t("div",Do,[s(le,{size:"xs",color:"gray",variant:"ghost",onClick:ie=>D(q)},{default:m(()=>[v(y(N(q)?"收起关联内容":"查看关联内容"),1)]),_:2},1032,["onClick"]),N(q)?(f(),b("div",{key:0,class:n(["mt-2 rounded p-2",(Re=F.value)==null?void 0:Re.subtleBg])},[(Xe=q.belongs)!=null&&Xe.length?(f(),b("div",Ho,[(f(!0),b(ue,null,ce(q.belongs,ie=>{var Ze,Pe,Qe,et;return f(),b("div",{key:ie.id,class:n(["text-xs",(Ze=F.value)==null?void 0:Ze.text])},[t("div",_o,[t("span",{class:n(["px-2 py-1 rounded text-[10px]",(Pe=F.value)==null?void 0:Pe.subtleBg])},"#"+y(ie.id),3),t("span",{class:n((Qe=F.value)==null?void 0:Qe.mutedText)},y(c(ie.created_at)),3)]),t("div",{class:n(["mt-1 line-clamp-2",(et=F.value)==null?void 0:et.mutedText])},y(ie.snippet),3)],2)}),128))])):(f(),b("div",{key:0,class:n(["text-xs",(Ye=F.value)==null?void 0:Ye.mutedText])},"无关联内容",2))],2)):$("",!0)])],2)}),128)),u.value.length>me.value.length?(f(),b("div",Mo,[s(le,{color:"gray",variant:"soft",onClick:ze},{default:m(()=>E[14]||(E[14]=[v("加载更多")])),_:1})])):u.value.length>4?(f(),b("div",zo,[s(le,{color:"gray",variant:"soft",onClick:Te},{default:m(()=>E[15]||(E[15]=[v("收起")])),_:1})])):$("",!0)]))]))]),s(vt,{modelValue:z.value,"onUpdate:modelValue":E[3]||(E[3]=q=>z.value=q)},{default:m(()=>{var q;return[s(Xt,{class:n((q=F.value)==null?void 0:q.cardBg)},{default:m(()=>{var Ce;return[t("div",{class:n(["text-sm",(Ce=F.value)==null?void 0:Ce.text])},"确定删除该"+y(T.value==="image"?"图片":"视频")+"附件吗？此操作不可恢复。",3),t("div",No,[s(le,{color:"gray",variant:"soft",onClick:E[2]||(E[2]=Oe=>z.value=!1)},{default:m(()=>E[16]||(E[16]=[v("取消")])),_:1}),s(le,{color:"red",loading:j.value,onClick:be},{default:m(()=>E[17]||(E[17]=[v("确认删除")])),_:1},8,["loading"])])]}),_:1},8,["class"])]}),_:1},8,["modelValue"])],2)}}}),Wo={class:"min-h-screen w-full"},Fo={class:"px-4 py-4 border-b border-slate-700/40 flex flex-col items-center gap-2"},qo=["src"],Ko={class:"w-full text-center"},Go={class:"font-semibold truncate"},Jo={class:"flex-1 overflow-y-auto px-2 py-3 space-y-2"},Xo={key:0,class:"space-y-2"},Yo={class:"px-4 py-3 border-t border-slate-700/40"},Zo={class:"text-xs text-slate-400"},Qo={class:"mt-2 flex items-center gap-2"},en={key:0,class:"mt-2 text-orange-400 flex items-center gap-2"},tn={class:"flex items-center gap-2"},ln={class:"flex items-center gap-2"},sn={class:"flex-1 px-4 pb-24 flex flex-col w-full space-y-4"},an={class:"col-span-12"},on={class:"col-span-12"},nn={class:"px-4 py-3 flex items-center justify-between"},dn={class:"flex items-center gap-4"},rn={class:"flex items-center gap-3"},un={class:"flex items-center"},cn={class:"flex items-center"},mn={class:"flex items-center"},pn={class:"flex items-center"},vn={class:"flex items-center gap-2"},gn={id:"system-section",class:"col-span-12"},fn={class:"px-4 py-3 flex flex-wrap items-center gap-6"},bn={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},wn={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},yn={class:"inline-flex items-center font-medium rounded-md px-2 py-1 gap-1 ml-2 text-sm bg-primary-50 dark:bg-primary-400 dark:bg-opacity-10 text-slate-800 dark:text-slate-200"},xn={key:2,id:"user-section",class:"col-span-12"},hn={class:"px-4 pb-4 grid grid-cols-1 md:grid-cols-3 gap-y-2 md:gap-x-4"},kn={class:"flex justify-between items-center mb-2"},Cn={key:0},Vn={class:"flex justify-end gap-2"},Un={key:1},En={class:"mt-3"},Tn={class:"flex justify-between items-center mb-2"},Ln={class:"flex items-center gap-2"},Sn={class:"flex items-center gap-3"},An=["src"],Bn={class:"flex items-center gap-2 w-full mt-2"},$n={class:"p-4"},Rn={class:"mx-auto",style:{width:"240px",height:"240px","border-radius":"9999px",overflow:"hidden",position:"relative",background:"#111"}},jn=["src"],Pn={class:"mt-3 flex items-center gap-3"},In={class:"mt-3"},Dn={class:"flex justify-between items-center mb-2"},Hn={key:0},_n={class:"flex justify-end gap-2"},Mn={key:1},zn={class:"flex justify-between items-center mb-2"},Nn={class:"flex items-center gap-2"},On={key:0,class:"mb-2"},Wn={class:"flex items-center gap-2 w-full flex-nowrap"},Fn={key:1},qn={class:"mt-3 flex items-center justify-between"},Kn={class:"flex justify-between items-center mb-2"},Gn={key:0},Jn={class:"w-full mb-2 flex items-center gap-2"},Xn={class:"w-full mb-2 flex items-center gap-2"},Yn={class:"w-full mb-2 flex items-center gap-2"},Zn={class:"flex justify-end gap-2"},Qn={class:"flex justify-between items-center mb-2"},ei={key:0},ti={class:"w-full mb-2 flex items-center gap-2"},li={class:"w-full mb-2 flex items-center gap-2"},si={class:"flex justify-between items-center mb-2"},ai={key:0},oi={class:"w-full mb-2 flex items-center gap-2"},ni={class:"w-full mb-2 flex items-center gap-2"},ii={key:0,class:"w-full mb-2 flex items-center gap-2"},di={id:"site-section",class:"col-span-12"},ri={class:"flex items-center justify-between px-4 py-3"},ui={class:"px-4 pb-4 space-y-4"},ci={class:"flex justify-between items-center mb-3"},mi={class:"flex items-center gap-2"},pi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},vi={class:"md:col-span-2"},gi={class:"flex items-center gap-4"},fi={class:"flex items-center"},bi={class:"flex items-center"},wi={class:"flex justify-between items-center mb-3"},yi={class:"flex items-center gap-4"},xi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},hi={class:"md:col-span-2"},ki={class:"flex items-center gap-4"},Ci={class:"flex items-center"},Vi={class:"flex items-center"},Ui={class:"flex items-center gap-4"},Ei={class:"flex justify-end"},Ti={id:"site-music-section",class:"col-span-12 mt-4"},Li={class:"flex items-center justify-between px-4 py-3"},Si={class:"flex items-center gap-3"},Ai={class:"px-4 pb-4"},Bi={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},$i={key:0},Ri={key:1},ji={class:"flex items-center gap-2 md:col-span-2"},Pi={class:"flex justify-end gap-2"},Ii={class:"flex items-center gap-4"},Di={class:"flex items-center"},Hi={class:"flex items-center"},_i={id:"site-configs-section",class:"space-y-4"},Mi={class:"flex justify-between items-center mb-2"},zi={key:0},Ni={key:0,class:"space-y-3"},Oi=["src","onClick"],Wi={class:"flex items-center gap-2"},Fi={class:"flex items-center justify-center gap-3"},qi={key:0,class:"mt-3"},Ki={key:1,class:"space-y-2"},Gi={class:"flex items-center gap-3"},Ji=["src"],Xi={class:"flex justify-end gap-2"},Yi={key:1},Zi={key:0,class:"grid grid-cols-3 gap-2"},Qi=["src","onClick"],ed={key:1,class:"flex items-center gap-3"},td=["src"],ld={key:0,class:"flex justify-end gap-2"},sd={id:"site-ads-section",class:"col-span-12"},ad={class:"flex items-center justify-between px-4 py-3"},od={class:"flex items-center gap-3"},nd={class:"px-4 pb-4"},id={class:"mt-2"},dd={class:"space-y-2"},rd={class:"flex items-center justify-between mb-2"},ud={class:"flex items-center gap-2"},cd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},md={class:"flex items-center justify-between"},pd={class:"flex items-center gap-2"},vd={class:"flex items-center gap-2"},gd={class:"flex justify-end mt-3"},fd={id:"hitokoto-section",class:"col-span-12"},bd={class:"flex items-center justify-between px-4 py-3"},wd={class:"flex items-center gap-3"},yd={class:"px-4 pb-4"},xd={id:"site-social-links-section",class:"col-span-12"},hd={class:"flex items-center justify-between px-4 py-3"},kd={class:"flex items-center gap-3"},Cd={class:"px-4 pb-4"},Vd={key:0,class:"space-y-2"},Ud={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Ed={class:"flex justify-end mt-2"},Td={class:"flex items-center justify-between"},Ld={id:"friend-links-section",class:"col-span-12 mt-4"},Sd={class:"flex items-center justify-between px-4 py-3"},Ad={class:"flex items-center gap-3"},Bd={class:"px-4 pb-4"},$d={class:"flex items-center justify-between"},Rd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},jd={id:"comments-section",class:"col-span-12"},Pd={class:"flex items-center justify-between px-4 py-3"},Id={class:"flex items-center gap-3"},Dd={class:"flex items-center gap-2"},Hd={class:"flex items-center gap-2"},_d={class:"px-4 pb-4"},Md={class:"flex items-center gap-2 mb-2"},zd={key:0,class:"space-y-2"},Nd={class:"flex items-center justify-between gap-2"},Od={key:0,class:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm"},Wd={class:"md:col-span-3"},Fd=["href"],qd={class:"md:col-span-3 flex gap-2"},Kd={key:0,class:"flex justify-center"},Gd={class:"flex justify-between items-center"},Jd={class:"space-y-3"},Xd={class:"text-sm"},Yd={class:"text-sm"},Zd={class:"text-sm"},Qd={class:"text-sm break-words"},er={class:"flex items-center gap-2 text-sm"},tr={class:"flex justify-end gap-2"},lr={key:3,id:"email-section",class:"col-span-12"},sr={class:"flex items-center justify-between px-4 py-3"},ar={class:"flex items-center gap-3"},or={class:"px-4 pb-4"},nr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ir={class:"text-xs"},dr={class:"flex justify-end gap-2 mt-3"},rr={key:4,id:"admin-users-section",class:"col-span-12"},ur={class:"flex items-center justify-between px-4 py-3"},cr={class:"px-4 pb-4"},mr={class:"flex items-center gap-2"},pr={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"},vr={class:"flex items-center justify-between gap-2 min-w-0"},gr={class:"mt-2 flex items-center gap-2"},fr={class:"grid grid-cols-1 md:grid-cols-3 gap-2"},br={class:"mt-3"},wr={class:"flex items-center gap-2"},yr={class:"space-y-3"},xr={class:"flex items-center gap-2"},hr={class:"flex items-center gap-2"},kr={class:"flex justify-end gap-2"},Cr={key:5,id:"notify-section",class:"col-span-12"},Vr={class:"flex items-center justify-between px-4 py-3"},Ur={class:"flex items-center gap-3"},Er={class:"flex items-center gap-2"},Tr={class:"px-4 pb-4"},Lr={key:6,id:"site-github-login-section",class:"col-span-12"},Sr={class:"flex items-center justify-between px-4 py-3"},Ar={class:"flex items-center gap-3"},Br={class:"flex items-center gap-2"},$r={class:"px-4 pb-4 space-y-3"},Rr={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},jr={class:"md:col-span-2"},Pr={class:"flex justify-end gap-2"},Ir={key:7,id:"attachments-section",class:"col-span-12"},Dr={key:8,id:"db-section",class:"col-span-12"},Hr={class:"flex items-center justify-between px-4 py-3"},_r={class:"flex gap-2 flex-wrap justify-end items-center"},Mr={class:"px-4 pb-4 space-y-4"},zr={class:"flex items-center gap-3"},Nr={class:"flex items-center gap-2"},Or={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Wr={key:0,class:"flex items-center gap-2"},Fr={class:"md:col-span-2"},qr={class:"flex justify-end gap-2 mt-2"},Kr={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3"},Gr={class:"md:col-span-2 flex flex-wrap items-center gap-4"},Jr={class:"flex items-center gap-2"},Xr={class:"flex items-center gap-2"},Yr={key:0,class:"flex items-center gap-2"},Zr={class:"flex items-center gap-3 ml-auto"},Qr={class:"flex gap-2"},eu={class:"flex gap-2"},tu={class:"flex justify-end gap-2 mt-2"},lu={key:0},su={key:1,class:"flex gap-2"},au={class:"flex justify-between items-center"},ou={class:"p-2"},nu=["src"],Me="rounded-2xl border shadow-2xl",iu=at({__name:"StatusPanel",emits:["restore-success"],setup(p,{emit:J}){const M=V(!0),U=V(!1),u=V(typeof window<"u"&&localStorage.getItem("adminTheme")||"dark"),B=Vt().public.baseApi||"/api",X=V(""),z=I(()=>{var h,x,C,Z;if(X.value)return X.value;const l=String(((h=k.user)==null?void 0:h.avatar_url)||((x=k.user)==null?void 0:x.AvatarURL)||"").trim(),e=((C=k.user)==null?void 0:C.username)||((Z=k.user)==null?void 0:Z.Username)||"",d=te=>te?/^https?:\/\//i.test(te)?te:`${B}${te}`:"",i=(te,ge=100)=>te?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(te)}&backgroundType=gradient&radius=50&scale=100&size=${ge}`:"";return d(l)||(e?i(String(e)):"")||"/favicon-32x32.png"}),j=async(l,e)=>{await ba();const d=document.getElementById(`${l}-section`);d&&(d.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),window.innerWidth<768&&(U.value=!1))};Ue(()=>{cl(),U.value=window.innerWidth>=768;try{const l=document.documentElement,e=u.value!=="light",d=l.classList.contains("dark");e&&!d?l.classList.add("dark"):!e&&d&&l.classList.remove("dark")}catch{}}),Be(()=>u.value,l=>{try{const e=document.documentElement,d=l!=="light",i=e.classList.contains("dark");d&&!i?e.classList.add("dark"):!d&&i&&e.classList.remove("dark")}catch{}});const T=V(typeof window<"u"?window.innerWidth>=768:!0),P=()=>{typeof window>"u"||(T.value=window.innerWidth>=768)};Ue(()=>{P(),typeof window<"u"&&window.addEventListener("resize",P)}),ca(()=>{typeof window<"u"&&window.removeEventListener("resize",P)});const o=I(()=>u.value==="light"?{sidebarBg:"bg-white/90",headerBg:"bg-white",bottomBg:"bg-white",cardBg:"bg-white",subtleBg:"bg-white",border:"border-gray-300",text:"text-slate-900",sidebarText:"text-slate-900",mutedText:"text-slate-700",pageBg:"bg-gray-50",navBtnBg:"bg-gray-100",navBtnHoverBg:"hover:bg-gray-200"}:u.value==="dark"?{sidebarBg:"bg-gray-950/80",headerBg:"bg-gray-950/70",bottomBg:"bg-gray-950/70",cardBg:"bg-gray-900/70",subtleBg:"bg-gray-900/50",border:"border-gray-800/60",text:"text-white",sidebarText:"text-white",mutedText:"text-gray-300",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:u.value==="midnight"?{sidebarBg:"bg-indigo-950/60",headerBg:"bg-indigo-950/50",bottomBg:"bg-indigo-950/50",cardBg:"bg-indigo-900/40",subtleBg:"bg-indigo-950/30",border:"border-indigo-800/40",text:"text-white",sidebarText:"text-white",mutedText:"text-indigo-200",pageBg:"bg-gradient-to-br from-indigo-950 via-indigo-900 to-slate-900",navBtnBg:"bg-indigo-950/40",navBtnHoverBg:"hover:bg-indigo-900/40"}:u.value==="slate"?{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}:{sidebarBg:"bg-slate-900/70",headerBg:"bg-slate-900/60",bottomBg:"bg-slate-900/60",cardBg:"bg-slate-800/70",subtleBg:"bg-slate-900/40",border:"border-slate-700/40",text:"text-white",sidebarText:"text-white",mutedText:"text-slate-200",pageBg:"bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800",navBtnBg:"bg-slate-800/70",navBtnHoverBg:"hover:bg-slate-700/70"}),W=async()=>{localStorage.setItem("adminTheme",u.value);try{const l=document.documentElement,e=u.value!=="light",d=l.classList.contains("dark");e&&!d?l.classList.add("dark"):!e&&d&&l.classList.remove("dark")}catch{}try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let d={};e.code===1?d={...e.data,adminTheme:u.value}:d={adminTheme:u.value};const i=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});(await i.json()).code===1&&w().add({title:(i==null?void 0:i.msg)||"已保存",color:"green"})}catch{}},ne=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();e.code===1&&typeof e.data.allowRegistration=="boolean"&&(M.value=e.data.allowRegistration)}catch{w().add({title:"获取注册配置失败",color:"red"})}};Ue(ne);const se=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();let d={};e.code===1?d={...e.data,allowRegistration:M.value}:d={allowRegistration:M.value};const h=await(await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).json();if(h.code===1)w().add({title:"保存成功",color:"green"});else throw new Error(h.msg||"保存失败")}catch{w().add({title:"保存失败",color:"red"})}},k=Kl(),{login:c,register:N}=Ha(),D=Gl(),O=V(""),Y=fe({checking:!1,hasUpdate:!1,latestVersion:"",currentVersion:""});let ae=fe({webhookEnabled:!1,webhookURL:"",telegramEnabled:!1,telegramToken:"",telegramChatID:"",weworkEnabled:!1,weworkKey:"",feishuEnabled:!1,feishuWebhook:"",feishuSecret:""});const g=fe({enabled:!1,driver:"smtp",host:"",port:"",user:"",pass:"",from:"",tls:!1,encryption:"tls"}),be=V(!1),we=async()=>{try{const l=await mt("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};g.enabled=!!e.smtpEnabled,g.driver=e.smtpDriver||"smtp",g.host=e.smtpHost||"",g.port=(e.smtpPort??"").toString(),g.user=e.smtpUser||"",g.pass=e.smtpPass||"",g.from=e.smtpFrom||"",g.tls=!!e.smtpTLS,g.encryption=e.smtpEncryption||(g.tls?"tls":"ssl")}}catch{}};Ue(we);const me=async()=>{try{const l=await mt("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.smtpEnabled=g.enabled,e.smtpDriver=g.driver,e.smtpHost=g.host,e.smtpPort=parseInt(g.port||"0")||0,e.smtpUser=g.user,e.smtpPass=g.pass,e.smtpFrom=g.from,e.smtpEncryption=g.encryption,e.smtpTLS=g.encryption==="tls";const d=await _e("settings",e,{credentials:"include"});if(d&&d.code===1)w().add({title:(d==null?void 0:d.msg)||"已保存",color:"green"});else throw new Error((d==null?void 0:d.msg)||"保存失败")}catch(l){w().add({title:"保存失败",description:l.message,color:"red"})}},Ee=V([]);V("");const ze=V(""),$e=V(!1),Te=V(!1),S=fe({newPass:"",confirmPass:""}),F=I(()=>{const l=S.newPass||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),_=I(()=>F.value<=1?"弱":F.value===2?"中":"强"),E=I(()=>F.value<=1?"red":F.value===2?"orange":"green"),pe=I(()=>!S.newPass||!S.confirmPass||S.newPass!==S.confirmPass?!1:F.value>=2),le=async()=>{try{const l=await mt("frontend/config",void 0,{credentials:"include"});if(l&&l.code===1){const e=l.data||{};Ee.value=Array.isArray(e.adminUsers)?e.adminUsers:[],ze.value=e.adminPasswordMasked||""}}catch{}};Ue(le);const Xt=async()=>{try{if(!pe.value)throw new Error("请填写符合强度的新密码并确认一致");const l=await mt("frontend/config",void 0,{credentials:"include"}),e=(l==null?void 0:l.code)===1?{...l.data}:{};e.adminPasswordReset=S.newPass;const d=await _e("settings",e,{credentials:"include"});if(d&&d.code===1)w().add({title:(d==null?void 0:d.msg)||"管理员密码已重置",color:"green"}),await le(),$e.value=!1,Te.value=!1,S.newPass="",S.confirmPass="";else throw new Error((d==null?void 0:d.msg)||"重置失败")}catch(l){w().add({title:"重置失败",description:l.message,color:"red"})}},vt=V(""),gt=I(()=>{const l=k.status||{},e=l.users||l.Users||[];return Array.isArray(e)?e:[]}),Ut=I(()=>{const l=(vt.value||"").trim().toLowerCase();return l?gt.value.filter(e=>{const d=String(e.id??e.ID??e.user_id??""),i=String(e.username??e.Username??"").toLowerCase();return d.includes(l)||i.includes(l)}):gt.value}),ft=async()=>{await k.getStatus()},Ne=V(!1),q=V({}),Ce=l=>!!q.value[String(l.id??l.ID)],Oe=l=>{const e=String(l.id??l.ID);q.value[e]=!q.value[e]},Le=fe({password:{}}),Re=V(!1),Xe=l=>(Le.password[String(l.id??l.ID)]||"").trim().length>=6,Ye=async l=>{try{const e=l.id??l.ID??l.user_id,d=(Le.password[String(e)]||"").trim();if(d.length<6)throw new Error("密码至少6位");const i=await ke("user/reset_password",{id:e,password:d},{credentials:"include"});if(i&&i.code===1)w().add({title:(i==null?void 0:i.msg)||"已重置密码",color:"green"}),Le.password[String(e)]="";else throw new Error((i==null?void 0:i.msg)||"重置失败")}catch(e){w().add({title:"重置失败",description:e.message,color:"red"})}},ie=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要切换用户“${e}”的管理员权限吗？`)||!window.confirm("该操作存在风险，是否继续？"))return;const d=l.id??l.ID??l.user_id,i=await _e(`user/admin?id=${d}`,{},{credentials:"include"});if(i&&i.code===1)w().add({title:(i==null?void 0:i.msg)||"已更新管理员状态",color:"green"}),await k.getStatus();else throw new Error((i==null?void 0:i.msg)||"更新失败")}catch(e){w().add({title:"更新失败",description:e.message,color:"red"})}},Ze=async l=>{try{const e=l.username??l.Username;if(!window.confirm(`确定要删除用户“${e}”吗？删除后不可恢复。`)||!window.confirm("该操作存在风险，是否继续？"))return;const d=l.id??l.ID??l.user_id,i=await zl("user",{id:d},{credentials:"include"});if(i&&i.code===1)w().add({title:(i==null?void 0:i.msg)||"已删除用户",color:"green"}),await k.getStatus();else throw new Error((i==null?void 0:i.msg)||"删除失败")}catch(e){w().add({title:"删除失败",description:e.message,color:"red"})}},Pe=V(!1),Qe=async()=>{try{const l=(g.from||g.user||"").trim();if(!l||!g.host||!g.port||!g.user||!g.pass||!g.encryption)throw new Error("请完整填写地址、主机、端口、加密协议、用户名和密码");Pe.value=!0,g.enabled||(g.enabled=!0,await me());let e=await ke("notify/test",{type:"email",to:l},{credentials:"include"});if((!e||e.code!==1)&&(e=await ke("email/test",{to:l},{credentials:"include"})),e&&e.code===1)w().add({title:(e==null?void 0:e.msg)||"测试邮件已发送",color:"green"});else throw new Error((e==null?void 0:e.msg)||"发送失败或接口不存在")}catch(l){w().add({title:"失败",description:l.message,color:"red"})}finally{Pe.value=!1}},et=()=>{try{if(!r.githubOAuthEnabled)throw new Error("请先开启 GitHub 登录");if(!r.githubClientId||!r.githubCallbackURL)throw new Error("请先填写 Client ID 与回调地址");const l=Vt().public.baseApi||"/api";window.open(`${l}/oauth/github/login`,"_blank")}catch(l){w().add({title:"无法测试",description:l.message,color:"red"})}},es=async()=>{Y.checking=!0;try{const e=await(await fetch("/api/version/check",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if(e.code===1){const{hasUpdate:d,lastUpdateTime:i}=e.data;Y.hasUpdate=d,Y.latestVersion=new Date(i).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d?w().add({title:"发现版本",description:`最新版本发布于 ${Y.latestVersion}`,color:"orange"}):w().add({title:"已是最新版本",description:"当前使用的是最新版本",color:"green"})}else throw new Error(e.msg||"检查更新失败")}catch(l){console.error("检查版本更新失败:",l),w().add({title:"检查更新失败",description:"请科学上网后重试",color:"red"})}finally{Y.checking=!1}};Ue(async()=>{var l;try{const d=await(await fetch("/api/version",{credentials:"include"})).json();d&&d.code===1&&(Y.currentVersion=String(((l=d.data)==null?void 0:l.version)||""))}catch{}});const ts=async()=>{var l;if(!k.isLogin){w().add({title:"错误",description:"请先登录",color:"red"});return}try{if(typeof window<"u"&&!window.confirm("重新生成将使旧 Token 失效，确认继续？"))return;Qt.value=!0;const e=await fetch("/api/user/token/regenerate",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}),d=await e.json();if(!e.ok)throw new Error(d.msg||"Token生成请求失败");if(d.code===1&&((l=d.data)!=null&&l.token))O.value=d.data.token,ot.value=!1,w().add({title:"成功",description:(d==null?void 0:d.msg)||"Token 已更新",color:"green"});else throw new Error(d.msg||"Token 生成失败")}catch(e){console.error("Token生成错误:",e),w().add({title:"错误",description:e.message||"Token 生成失败",color:"red"})}finally{Qt.value=!1}},ls=async()=>{try{await navigator.clipboard.writeText(O.value),w().add({title:"成功",description:"Token 已复制到剪贴板",color:"green"})}catch{w().add({title:"错误",description:"复制失败",color:"red"})}},wl=async()=>{try{const l=await fetch("/api/user/logout",{method:"POST",credentials:"include"}),e=await l.json().catch(()=>({}));if(!l.ok||e.code!==1)throw new Error((e==null?void 0:e.msg)||"退出失败");k.clearUserStatus(),w().add({title:"成功",description:"已退出登录",color:"green"}),D.push("/")}catch{k.clearUserStatus(),w().add({title:"成功",description:"已退出登录",color:"green"}),D.push("/")}},Et=I(()=>(k==null?void 0:k.isLogin)??!1),Se=I(()=>{var l;return((l=k.user)==null?void 0:l.is_admin)??!1}),We=V(!0),Tt=V(!1),yl=V(!1),bt=V(null),wt=V(null),Lt=V(null),xl=V(null),Ae=V(!1),St=V(""),yt=V(!1),Ie=V(""),xt=V(1),At=V(0),Bt=V(0);let Yt=!1,$t={x:0,y:0};const L=fe({username:"",description:"",oldPassword:"",newPassword:"",confirmPassword:"",email:"",emailCode:"",newEmail:"",changeCode:""}),G=fe({username:!1,description:!1,password:!1,emailBind:!1,emailChange:!1}),Zt=V(!1),ot=V(!1),Qt=V(!1),Rt=V(!1),jt=V(!1),Pt=V(!1),nt=I(()=>{const l=L.newPassword||"";let e=0;return l.length>=8&&e++,/[A-Z]/.test(l)&&/[a-z]/.test(l)&&e++,/\d/.test(l)&&/[^A-Za-z0-9]/.test(l)&&e++,Math.min(e,3)}),ss=I(()=>nt.value<=1?"弱":nt.value===2?"中":"强"),as=I(()=>nt.value<=1?"red":nt.value===2?"orange":"green"),os=I(()=>!L.oldPassword||!L.newPassword||!L.confirmPassword||L.newPassword===L.oldPassword||L.newPassword!==L.confirmPassword?!1:nt.value>=2),ns=async()=>{try{if(!L.username.trim())throw new Error("用户名不能为空");const l=await _e("user/update",{username:L.username,type:"username"},{credentials:"include"});if(l&&l.code===1)await k.getUser(),G.username=!1,L.username="",w().add({title:"成功",description:(l==null?void 0:l.msg)||"用户名已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){w().add({title:"错误",description:l.message||"更新失败",color:"red"})}},is=async()=>{try{const l=(L.description||"").trim(),e=await _e("user/update",{description:l},{credentials:"include"});if(e&&e.code===1)await k.getUser(),G.description=!1,L.description="",w().add({title:"成功",description:"个性签名已更新",color:"green"});else throw new Error((e==null?void 0:e.msg)||"保存失败")}catch(l){w().add({title:"错误",description:(l==null?void 0:l.message)||"更新失败",color:"red"})}},ds=async()=>{try{if(!L.newPassword||!L.oldPassword||!L.confirmPassword)throw new Error("密码不能为空");if(L.newPassword===L.oldPassword)throw new Error("新密码不能与当前密码相同");if(L.newPassword!==L.confirmPassword)throw new Error("两次输入不一致");if(nt.value<2)throw new Error("密码强度不足");const l=await _e("user/change_password",{password:L.newPassword,oldPassword:L.oldPassword},{credentials:"include"});if(l&&l.code===1)G.password=!1,L.oldPassword="",L.newPassword="",L.confirmPassword="",w().add({title:"成功",description:(l==null?void 0:l.msg)||"密码已更新",color:"green"});else throw new Error(l==null?void 0:l.msg)}catch(l){w().add({title:"错误",description:l.message||"更新失败",color:"red"})}},rs=async()=>{try{const l=String(L.email||"").trim();if(!l)throw new Error("邮箱不能为空");const e=await ke("user/email/bind",{email:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"发送失败");w().add({title:"成功",description:"验证码已发送",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"发送失败",color:"red"})}},us=async()=>{try{const l=String(L.emailCode||"").trim();if(!l)throw new Error("请输入验证码");const e=await ke("user/email/verify",{code:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"绑定失败");await k.getUser(),G.emailBind=!1,L.email="",L.emailCode="",w().add({title:"成功",description:"邮箱已绑定",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"绑定失败",color:"red"})}},cs=async()=>{try{const l=await ke("user/email/change/send_code",{},{credentials:"include"});if(!l||l.code!==1)throw new Error((l==null?void 0:l.msg)||"发送失败");w().add({title:"成功",description:"验证码已发送到当前邮箱",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"发送失败",color:"red"})}},ms=async()=>{try{const l=String(L.changeCode||"").trim(),e=String(L.newEmail||"").trim();if(!l||!e)throw new Error("请输入验证码与新邮箱");const d=await ke("user/email/change",{code:l,newEmail:e},{credentials:"include"});if(!d||d.code!==1)throw new Error((d==null?void 0:d.msg)||"更换失败");Zt.value=!0,L.email=e,L.emailCode="",w().add({title:"成功",description:"已向新邮箱发送验证码，请在下方输入验证码完成更换",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"更换失败",color:"red"})}},ps=async()=>{try{const l=String(L.emailCode||"").trim();if(!l)throw new Error("请输入新邮箱验证码");const e=await ke("user/email/verify",{code:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"确认失败");Zt.value=!1,G.emailChange=!1,L.changeCode="",L.newEmail="",L.email="",L.emailCode="",await k.getUser(),w().add({title:"成功",description:"邮箱已更换",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"确认失败",color:"red"})}},vs=()=>{var l;(l=bt.value)==null||l.click()},gs=()=>{var e,d;const l=((d=(e=bt.value)==null?void 0:e.files)==null?void 0:d[0])||null;xl.value=l||null,l&&(Ie.value=URL.createObjectURL(l),X.value=Ie.value,xt.value=1,At.value=0,Bt.value=0,yt.value=!0)},fs=async l=>{try{if(!l){w().add({title:"错误",description:"请先选择头像图片",color:"red"});return}Ae.value=!0;const e=new FormData;e.append("image",l);const d=await fetch("/api/images/upload",{method:"POST",body:e,credentials:"include"}),i=await d.json().catch(()=>({}));if(!d.ok||i.code!==1||!i.data)throw new Error((i==null?void 0:i.msg)||"上传失败");const h=String(i.data||"").trim(),x=await _e("user/update",{avatar_url:h},{credentials:"include"});if(!x||x.code!==1)throw new Error((x==null?void 0:x.msg)||"保存失败");await k.getUser(),w().add({title:"成功",description:"头像已更新",color:"green"}),xl.value=null,bt.value&&(bt.value.value=""),X.value=""}catch(e){w().add({title:"错误",description:e.message||"操作失败",color:"red"})}finally{Ae.value=!1}},bs=async()=>{try{const l=String(St.value||"").trim();if(!l)throw new Error("请填写头像链接");if(!/^https?:\/\//i.test(l)&&!l.startsWith("/api"))throw new Error("链接需以 http 或 /api 开头");Ae.value=!0,X.value=l.startsWith("http")?l:`${B}${l}`;const e=await _e("user/update",{avatar_url:l},{credentials:"include"});if(!e||e.code!==1)throw new Error((e==null?void 0:e.msg)||"保存失败");await k.getUser(),w().add({title:"成功",description:"头像链接已保存",color:"green"})}catch(l){w().add({title:"错误",description:l.message||"操作失败",color:"red"})}finally{Ae.value=!1}};Be(St,l=>{const e=String(l||"").trim();if(!e){X.value="";return}/^https?:\/\//i.test(e)?X.value=e:e.startsWith("/api")&&(X.value=`${B}${e}`)});const hl=l=>{Yt=!0;const e=l.touches?l.touches[0]:l;$t={x:e.clientX,y:e.clientY},window.addEventListener("mousemove",It),window.addEventListener("mouseup",Dt),window.addEventListener("touchmove",It),window.addEventListener("touchend",Dt)},It=l=>{if(!Yt)return;const e=l.touches?l.touches[0]:l,d=e.clientX-$t.x,i=e.clientY-$t.y;At.value+=d,Bt.value+=i,$t={x:e.clientX,y:e.clientY}},Dt=()=>{Yt=!1,window.removeEventListener("mousemove",It),window.removeEventListener("mouseup",Dt),window.removeEventListener("touchmove",It),window.removeEventListener("touchend",Dt)},ws=async()=>{try{if(!Ie.value)return;Ae.value=!0;const l=await new Promise((ye,K)=>{const Q=new Image;Q.crossOrigin="anonymous",Q.onload=()=>ye(Q),Q.onerror=K,Q.src=Ie.value}),e=400,d=document.createElement("canvas");d.width=e,d.height=e;const i=d.getContext("2d"),h=xt.value,x=l.naturalWidth,C=l.naturalHeight,Z=x*h,te=C*h,ge=e/2+At.value-Z/2,re=e/2+Bt.value-te/2;i.clearRect(0,0,e,e),i.drawImage(l,ge,re,Z,te);const Ge=await new Promise(ye=>d.toBlob(K=>ye(K),"image/png")),Ve=new File([Ge],"avatar.png",{type:"image/png"});await fs(Ve),yt.value=!1,Ie.value&&URL.revokeObjectURL(Ie.value),Ie.value="",X.value=""}catch(l){w().add({title:"错误",description:l.message||"裁剪失败",color:"red"})}finally{Ae.value=!1}},ys=()=>{yt.value=!1},xs=async()=>{var l,e;try{const d=String(((l=k.user)==null?void 0:l.username)||((e=k.user)==null?void 0:e.Username)||"").trim();if(!d)throw new Error("请先设置用户名");const i=`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(d)}&backgroundType=gradient&radius=50&scale=100&size=100`;Ae.value=!0;const h=await _e("user/update",{avatar_url:i},{credentials:"include"});if(!h||h.code!==1)throw new Error((h==null?void 0:h.msg)||"保存失败");await k.getUser(),X.value="",w().add({title:"成功",description:"已切换为首字母头像",color:"green"})}catch(d){w().add({title:"错误",description:(d==null?void 0:d.message)||"操作失败",color:"red"})}finally{Ae.value=!1}},el={siteTitle:"站点标题",subtitleText:"欢迎语",backgrounds:"背景图片",cardFooterTitle:"卡片页脚标题",cardFooterLink:"卡片页脚链接",pageFooterHTML:"页面底部HTML",rssTitle:"RSS 标题",rssDescription:"RSS 描述",rssAuthorName:"RSS 作者",rssFaviconURL:"RSS 图标链接",linksTitle:"友链页面标题",linksDescription:"友链页面说明",commentPageTitle:"留言页面标题",commentPageDescription:"留言页面说明",aboutPageTitle:"关于页面标题",aboutPageDescription:"关于页面说明",aboutMarkdown:"关于页面 Markdown 内容"},r=fe({siteTitle:"",subtitleText:"",welcomeName:"",welcomeAvatarURL:"",welcomeDescription:"",welcomeUseAdmin:!1,backgrounds:[],cardFooterTitle:"",cardFooterLink:"",pageFooterHTML:"",rssTitle:"",rssDescription:"",rssAuthorName:"",rssFaviconURL:"",hitokotoEnabled:!0,friendLinks:[],linksTitle:"",linksDescription:"",commentPageTitle:"",commentPageDescription:"",aboutPageTitle:"",aboutPageDescription:"",aboutMarkdown:"",walineServerURL:"",commentEnabled:!0,commentSystem:"builtin",commentEmailEnabled:!1,commentLoginRequired:!0,githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",notifyEnabled:!1,enableGithubCard:!1,pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"light",announcementText:"",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1,musicCssCdnURL:"",musicJsCdnURL:"",socialLinks:[],calendarEnabled:!0,timeEnabled:!0,leftAdEnabled:!0,leftAdImageURL:"https://picsum.photos/seed/single-ad/640/640",leftAdLinkURL:"https://note.noisework.cn",leftAdDescription:"示例广告（单条配置）",leftAds:[{imageURL:"https://picsum.photos/seed/ad-1/640/640",linkURL:"https://note.noisework.cn",description:"写作与记录，开启灵感之旅"},{imageURL:"https://picsum.photos/seed/ad-2/640/640",linkURL:"https://noisework.cn",description:"探索新主题与小工具"},{imageURL:"https://picsum.photos/seed/ad-3/640/640",linkURL:"https://github.com",description:"开源项目，欢迎 Star"}],leftAdsIntervalMs:4e3}),Fe=I({get:()=>r.enableGithubCard===!0,set:l=>{const e=l===!0||l==="true"||l===1||l==="1";r.enableGithubCard=e}}),tt=fe({username:"",password:""}),ve=fe({siteTitle:!1,subtitleText:!1,backgrounds:!1,cardFooterTitle:!1,cardFooterLink:!1,pageFooterHTML:!1,rssTitle:!1,rssDescription:!1,rssAuthorName:!1,rssFaviconURL:!1,walineServerURL:!1,socialLinks:!1,linksTitle:!1,linksDescription:!1,commentPageTitle:!1,commentPageDescription:!1,aboutPageTitle:!1,aboutPageDescription:!1}),oe={siteTitle:"说说笔记",subtitleText:"欢迎访问，点击头像可更换封面背景！",avatarURL:"",welcomeName:"",welcomeAvatarURL:"",welcomeDescription:"",welcomeUseAdmin:!1,backgrounds:["https://s2.loli.net/2025/03/27/KJ1trnU2ksbFEYM.jpg","https://s2.loli.net/2025/03/27/MZqaLczCvwjSmW7.jpg","https://s2.loli.net/2025/03/27/UMijKXwJ9yTqSeE.jpg","https://s2.loli.net/2025/03/27/WJQIlkXvBg2afcR.jpg","https://s2.loli.net/2025/03/27/oHNQtf4spkq2iln.jpg","https://s2.loli.net/2025/03/27/PMRuX5loc6Uaimw.jpg","https://s2.loli.net/2025/03/27/U2WIslbNyTLt4rD.jpg","https://s2.loli.net/2025/03/27/xu1jZL5Og4pqT9d.jpg","https://s2.loli.net/2025/03/27/OXqwzZ6v3PVIns9.jpg","https://s2.loli.net/2025/03/27/HGuqlE6apgNywbh.jpg","https://s2.loli.net/2025/03/26/d7iyuPYA8cRqD1K.jpg","https://s2.loli.net/2025/03/27/wYy12qDMH6bGJOI.jpg","https://s2.loli.net/2025/03/27/y67m2k5xcSdTsHN.jpg"],cardFooterTitle:"Noise·说说·笔记~",cardFooterLink:"note.noisework.cn",pageFooterHTML:'<div class="text-center text-xs text-gray-400 py-4">来自<a href="https://www.noisework.cn" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Noise</a> 使用<a href="https://github.com/rcy1314/echo-noise" target="_blank" rel="noopener noreferrer" class="text-orange-400 hover:text-orange-500">Ech0-Noise</a>发布</div>',rssTitle:"Noise的说说笔记",rssDescription:"一个说说笔记~",rssAuthorName:"Noise",rssFaviconURL:"/favicon.ico",hitokotoEnabled:!0,linksTitle:"友情链接",linksDescription:"推荐站点和朋友们的主页",commentPageTitle:"留言",commentPageDescription:"欢迎留下你的看法",aboutPageTitle:"关于本站",aboutPageDescription:"这里是站点的介绍与说明",aboutMarkdown:`# 关于我

这里是一个默认的个人简介示例：

- 喜欢记录与分享
- 热爱开源与学习
- 持续打磨产品体验

欢迎通过友链或留言与我交流！`,walineServerURL:"请前往waline官网https://waline.js.org查看部署配置",githubOAuthEnabled:!1,githubClientId:"",githubClientSecret:"",githubCallbackURL:"",pwaEnabled:!0,pwaTitle:"",pwaDescription:"",pwaIconURL:"",defaultContentTheme:"light",announcementText:"欢迎访问我的说说笔记！",announcementEnabled:!0,musicEnabled:!1,musicPlaylistId:"2141128031",musicSongId:"",musicPosition:"bottom-left",musicTheme:"auto",musicLyric:!0,musicAutoplay:!1,musicDefaultMinimized:!0,musicEmbed:!1,musicCssCdnURL:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css",musicJsCdnURL:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js",socialLinks:[{name:"GitHub",url:"https://github.com/rcy1314",icon:"i-mdi-github"},{name:"X",url:"https://x.com/liangwenhao3",icon:"i-mdi-twitter"},{name:"主页",url:"https://www.noisework.cn/",icon:"i-mdi-home"},{name:"博客",url:"https://www.noiseblogs.top/",icon:"i-mdi-notebook"}],friendLinks:[{title:"NoiseWork",link:"https://www.noisework.cn/",icon:"i-mdi-home",description:"个人主页与作品集合"},{title:"NoiseBlogs",link:"https://www.noiseblogs.top/",icon:"i-mdi-notebook",description:"技术随笔与学习记录"}],calendarEnabled:!0,timeEnabled:!0,leftAdEnabled:!0,leftAds:[{imageURL:"https://picsum.photos/seed/ad-1/640/640",linkURL:"https://note.noisework.cn",description:"写作与记录，开启灵感之旅"},{imageURL:"https://picsum.photos/seed/ad-2/640/640",linkURL:"https://noisework.cn",description:"探索新主题与小工具"},{imageURL:"https://picsum.photos/seed/ad-3/640/640",linkURL:"https://github.com",description:"开源项目，欢迎 Star"}],leftAdsIntervalMs:4e3},hs=l=>{r[l]=oe[l],ve[l]=!1},qe=async()=>{var l,e;try{const i=await(await fetch("/api/frontend/config",{credentials:"include",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}})).json();if((l=i==null?void 0:i.data)!=null&&l.frontendSettings){const h=i.data.frontendSettings,x=["enableGithubCard","pwaEnabled","announcementEnabled","hitokotoEnabled","musicEnabled","musicLyric","musicAutoplay","musicDefaultMinimized","musicEmbed","commentEnabled","commentEmailEnabled","commentLoginRequired","githubOAuthEnabled","notifyEnabled","calendarEnabled","timeEnabled","leftAdEnabled","welcomeUseAdmin"];if(Object.keys(r).forEach(K=>{if(K==="backgrounds"){const Q=h[K];Array.isArray(Q)&&(r[K]=[...Q])}else if(K==="socialLinks"){const Q=h[K];Array.isArray(Q)?r[K]=[...Q]:r[K]=[...oe.socialLinks||[]]}else if(K==="leftAds"){const Q=h[K];Array.isArray(Q)?r[K]=[...Q]:r[K]=[...oe.leftAds||[]]}else if(K==="friendLinks"){const Q=h[K];Array.isArray(Q)?r[K]=[...Q]:r[K]=[...oe.friendLinks||[]]}else if(x.includes(K)){const Q=h[K]??oe[K];r[K]=Q===!0||Q==="true"}else{const Q=h[K]??oe[K];r[K]=typeof Q=="string"?Q.trim():Q}}),h.enableGithubCard!==void 0){const K=h.enableGithubCard;r.enableGithubCard=K===!0||K==="true"}const C=(r.pwaTitle||r.siteTitle||"说说笔记").trim(),Z=(r.rssFaviconURL||"/favicon.ico").trim(),te=(r.pwaDescription||"").trim();if(!!r.pwaEnabled)Nl({title:C,meta:[{name:"description",content:te},{name:"theme-color",content:"#000000"}],link:[{rel:"manifest",href:"/manifest.webmanifest"},{rel:"icon",href:Z},{rel:"apple-touch-icon",href:Z}]});else try{const K=document.querySelector('link[rel="manifest"]');K&&((e=K.parentElement)==null||e.removeChild(K)),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(async Q=>{for(const ct of Q)await ct.unregister();const Ft=await caches.keys();await Promise.all(Ft.map(ct=>caches.delete(ct)))})}catch{}const re=String(r.musicCssCdnURL||"").trim(),Ge=String(r.musicJsCdnURL||"").trim();(re||Ge)&&ol();const Ve=String(r.musicCssCdnURL||"").trim().toLowerCase(),ye=String(r.musicJsCdnURL||"").trim().toLowerCase();Ve.includes("api.hypcvgm.top")&&ye.includes("api.hypcvgm.top")?He.value="hypcvgm":Ve.includes("jsdelivr")&&ye.includes("jsdelivr")?He.value="jsdelivr":Ve.includes("unpkg")&&ye.includes("unpkg")?He.value="unpkg":He.value="custom"}}catch(d){console.error("获取配置失败:",d)}},de=async l=>{try{if(l==="backgrounds"){const h=r.backgrounds.filter(x=>x&&x.trim()!=="");r.backgrounds=h}if(l==="leftAds"){const h=(r.leftAds||[]).map(x=>({imageURL:String((x==null?void 0:x.imageURL)||"").trim(),linkURL:String((x==null?void 0:x.linkURL)||"").trim(),description:String((x==null?void 0:x.description)||"").trim()})).filter(x=>x.imageURL!=="");r.leftAds=h}const d=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:r})});if(!d.ok){const h=await d.json();throw new Error(h.msg||"请求失败")}const i=await d.json();if(i.code===1){if(ve[l]=!1,await qe(),l==="leftAds"||l==="leftAdEnabled")w().add({title:"成功",description:"广告模块更新成功",color:"green"});else if(l==="announcementEnabled"){const h=!!r.announcementEnabled;w().add({title:"成功",description:h?"已开启公告":"已关闭公告",color:h?"green":"gray"})}else{const h=l==="defaultContentTheme"?"默认主题色":el[l]||(l==="pwa"?"PWA 设置":l);w().add({title:"成功",description:`${h}已更新`,color:"green"})}if(l==="defaultContentTheme"){const h=(r.defaultContentTheme||"dark").trim()}}else throw new Error(i.msg||"保存失败")}catch(e){console.error("保存配置失败:",e);const d=l==="defaultContentTheme"?"默认主题色":el[l]||l;w().add({title:"失败",description:`${d}保存失败`,color:"red"})}},ks=async()=>{try{const e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({frontendSettings:r})}),d=await e.json();if(e.ok&&d.code===1){if(await qe(),w().add({title:"成功",description:"PWA 设置已更新",color:"green"}),"serviceWorker"in navigator){const i=await navigator.serviceWorker.getRegistrations();if(r.pwaEnabled)await navigator.serviceWorker.register("/sw.js");else{for(const x of i)await x.unregister();const h=await caches.keys();await Promise.all(h.map(x=>caches.delete(x)))}}window.dispatchEvent(new Event("frontend-config-updated"))}else throw new Error(d.msg||"保存失败")}catch(l){w().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Cs=async()=>{var l,e;try{const i=await(await fetch("/api/status",{credentials:"include"})).json().catch(()=>({})),h=((l=i==null?void 0:i.data)==null?void 0:l.users)||((e=i==null?void 0:i.data)==null?void 0:e.Users)||[],x=Array.isArray(h)?h.find(Z=>!!((Z==null?void 0:Z.is_admin)??(Z==null?void 0:Z.IsAdmin))):null,C=Vt().public.baseApi||"/api";if(x){const Z=String((x==null?void 0:x.username)||(x==null?void 0:x.Username)||"").trim(),te=String((x==null?void 0:x.avatar_url)||(x==null?void 0:x.AvatarURL)||"").trim(),ge=String((x==null?void 0:x.description)||"").trim();r.welcomeName=Z||r.welcomeName||"",r.welcomeAvatarURL=te?te.startsWith("http")?te:`${C}${te}`:r.welcomeAvatarURL||"",r.welcomeDescription=ge||r.welcomeDescription||"",r.welcomeUseAdmin=!0,w().add({title:"已填充管理员信息",color:"green"})}else w().add({title:"未找到管理员",color:"orange"})}catch(d){w().add({title:"失败",description:(d==null?void 0:d.message)||"获取失败",color:"red"})}},Vs=()=>{r.welcomeName="",r.welcomeAvatarURL="",r.welcomeDescription="",r.welcomeUseAdmin=!1,w().add({title:"已重置欢迎组件",color:"gray"})},Us=async l=>{const e=l.target.files;if(!(!e||!e[0]))try{const d=e[0],i=new FormData;i.append("image",d);const h=await fetch("/api/images/upload",{method:"POST",credentials:"include",body:i}),x=await h.json().catch(()=>({}));if(!h.ok||x.code!==1||!x.data)throw new Error((x==null?void 0:x.msg)||"上传失败");const C=String(x.data||"").startsWith("http")?x.data:`/api${x.data}`;r.avatarURL=C,await de("avatarURL"),w().add({title:"成功",description:"站点头像已更新",color:"green"})}catch(d){w().add({title:"失败",description:(d==null?void 0:d.message)||"上传失败",color:"red"})}finally{Lt.value&&(Lt.value.value="")}},kl=async()=>{try{const l={frontendSettings:{commentEnabled:!!r.commentEnabled,commentSystem:"builtin",commentEmailEnabled:!!r.commentEmailEnabled,commentLoginRequired:!!r.commentLoginRequired}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)await qe(),window.dispatchEvent(new Event("frontend-config-updated")),w().add({title:"成功",description:"评论设置已更新",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){w().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Cl=V(!1);Be(()=>r.commentLoginRequired,async()=>{if(!Cl.value||ul.value){Cl.value=!0;return}try{await kl()}catch{}});const Es=()=>{r.socialLinks.push({name:"",url:"",icon:""})},Ts=l=>{r.socialLinks.splice(l,1)},Ls=async()=>{try{await de("socialLinks"),window.dispatchEvent(new Event("frontend-config-updated")),w().add({title:"成功",description:"社交链接已更新",color:"green"})}catch(l){w().add({title:"错误",description:(l==null?void 0:l.message)||"保存失败",color:"red"})}},Ht=V(""),De=V(!1),it=V([]),dt=V(1),_t=V(!1),ht=V({}),tl=V("builtin"),Ss=l=>{try{const e=new Date(l);if(isNaN(e.getTime()))return String(l);const d=i=>i.toString().padStart(2,"0");return`${e.getFullYear()}-${d(e.getMonth()+1)}-${d(e.getDate())} ${d(e.getHours())}:${d(e.getMinutes())}`}catch{return String(l)}},As=()=>{De.value=!De.value,De.value&&Vl()},ll=l=>!!ht.value[l.id],Bs=l=>{ht.value[l.id]=!ht.value[l.id]},Vl=async()=>{var l,e;try{De.value=!0,it.value.splice(0),dt.value=1;const d=(Ht.value||"").trim(),i=await mt("comments",{q:d,page:dt.value,pageSize:5},{credentials:"include"});if(i&&i.code===1){const h=Array.isArray((l=i.data)==null?void 0:l.items)?i.data.items:[];h.forEach(C=>{it.value.push(C),ht.value[C.id]=!0});const x=Number(((e=i.data)==null?void 0:e.total)||0);_t.value=dt.value*5<x,h.length===0?w().add({title:"无结果",description:"未找到匹配评论",color:"gray"}):w().add({title:"已加载",description:`本页 ${h.length} 条${_t.value?"，还有更多":""}`,color:"green"})}else throw new Error((i==null?void 0:i.msg)||"加载失败")}catch(d){w().add({title:"加载失败",description:d.message,color:"red"})}},$s=async()=>{var l,e;try{dt.value+=1;const d=(Ht.value||"").trim(),i=await mt("comments",{q:d,page:dt.value,pageSize:5},{credentials:"include"});if(i&&i.code===1){(Array.isArray((l=i.data)==null?void 0:l.items)?i.data.items:[]).forEach(C=>it.value.push(C));const x=Number(((e=i.data)==null?void 0:e.total)||0);_t.value=dt.value*5<x}else throw new Error((i==null?void 0:i.msg)||"加载失败")}catch(d){w().add({title:"加载失败",description:d.message,color:"red"})}},Rs=async l=>{try{const e=await zl(`messages/${l.message_id}/comments/${l.id}`,void 0,{credentials:"include"});if(e&&e.code===1){const d=it.value.findIndex(i=>i.id===l.id);d>=0&&it.value.splice(d,1),delete ht.value[l.id],w().add({title:"成功",description:"已删除该评论",color:"green"})}else throw new Error((e==null?void 0:e.msg)||"删除失败")}catch(e){w().add({title:"删除失败",description:e.message,color:"red"})}},Mt=V(!1),rt=V(!1),Ke=V(null),js=I(()=>{var e;const l=String(((e=Ke.value)==null?void 0:e.content)||"").trim();return l.length>120?l.slice(0,120)+"...":l}),Ps=l=>{confirm("确认删除该评论吗？此操作不可恢复。")&&(Ke.value=l,rt.value=!1,Mt.value=!0)},sl=()=>{rt.value=!1,Mt.value=!1,Ke.value=null},Is=async()=>{if(!rt.value||!Ke.value){w().add({title:"请先勾选确认",color:"orange"});return}await Rs(Ke.value),sl()};Be(()=>String(r.commentSystem||"").toLowerCase(),l=>{tl.value=l,l!=="builtin"&&(De.value=!1)}),Be(()=>!!r.commentEnabled,l=>{l||(De.value=!1)});const Ds=async()=>{try{const l={frontendSettings:{enableGithubCard:!!Fe.value}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)r.enableGithubCard=!!Fe.value,await qe(),window.dispatchEvent(new Event("frontend-config-updated")),w().add({title:"成功",description:"GitHub 解析设置已保存",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){w().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Ul=async()=>{try{const l={frontendSettings:{musicEnabled:!!r.musicEnabled,musicPlaylistId:String(r.musicPlaylistId||""),musicSongId:String(r.musicSongId||""),musicPosition:String(r.musicPosition||"bottom-left"),musicTheme:String(r.musicTheme||"auto"),musicLyric:!!r.musicLyric,musicAutoplay:!!r.musicAutoplay,musicDefaultMinimized:!!r.musicDefaultMinimized,musicEmbed:!!r.musicEmbed,musicCssCdnURL:String(r.musicCssCdnURL||""),musicJsCdnURL:String(r.musicJsCdnURL||"")}},e=await fetch("/api/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}),d=await e.json();if(e.ok&&d.code===1)await qe(),ol(),window.dispatchEvent(new Event("frontend-config-updated")),w().add({title:"成功",description:"音乐配置已更新",color:"green"});else throw new Error(d.msg||"保存失败")}catch(l){w().add({title:"错误",description:l.message||"保存失败",color:"red"})}},Hs=()=>{r.musicEnabled=oe.musicEnabled,r.musicPlaylistId=oe.musicPlaylistId,r.musicSongId=oe.musicSongId,r.musicPosition=oe.musicPosition,r.musicTheme=oe.musicTheme,r.musicLyric=oe.musicLyric,r.musicAutoplay=oe.musicAutoplay,r.musicDefaultMinimized=oe.musicDefaultMinimized,r.musicEmbed=oe.musicEmbed,r.musicCssCdnURL=oe.musicCssCdnURL,r.musicJsCdnURL=oe.musicJsCdnURL},_s=()=>{r.leftAdEnabled=!0;const l=oe,e=Array.isArray(l.leftAds)?l.leftAds:[];r.leftAds=e.map(d=>({imageURL:String((d==null?void 0:d.imageURL)||""),linkURL:String((d==null?void 0:d.linkURL)||""),description:String((d==null?void 0:d.description)||"")})),r.leftAdsIntervalMs=Number(l.leftAdsIntervalMs)},al=I({get:()=>r.musicEmbed?"embed":"float",set:l=>{r.musicEmbed=l==="embed"}}),He=V("hypcvgm"),ol=()=>{const l=String(r.musicCssCdnURL||"").trim(),e=String(r.musicJsCdnURL||"").trim(),d=[],i=[];l&&d.push({rel:"stylesheet",href:l}),e&&i.push({src:e,body:!0}),(d.length||i.length)&&Nl({link:d,script:i})};Be(He,l=>{l==="hypcvgm"?(r.musicCssCdnURL="https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css",r.musicJsCdnURL="https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js"):l==="jsdelivr"?(r.musicCssCdnURL="https://cdn.jsdelivr.net/gh/ImBHCN/NeteaseMiniPlayer@v2/netease-mini-player-v2.css",r.musicJsCdnURL="https://cdn.jsdelivr.net/gh/ImBHCN/NeteaseMiniPlayer@v2/netease-mini-player-v2.js"):l==="unpkg"&&(r.musicCssCdnURL="https://unpkg.com/netease-mini-player/dist/netease-mini-player-v2.css",r.musicJsCdnURL="https://unpkg.com/netease-mini-player/dist/netease-mini-player-v2.js"),ol()});const Ms=async()=>{try{await de("githubOAuthEnabled"),await de("githubClientId"),await de("githubClientSecret"),await de("githubCallbackURL"),w().add({title:"成功",description:"GitHub 登录配置已保存",color:"green"})}catch(l){w().add({title:"错误",description:(l==null?void 0:l.message)||"保存失败",color:"red"})}},nl=V(!1),zt=V(0),il=V(""),zs=async l=>{const e=l.target.files;if(!e)return;const d=["image/jpeg","image/png","image/webp"];for(const i of Array.from(e))try{if(!d.includes(i.type))throw new Error("仅支持 JPG/PNG/WEBP 格式");nl.value=!0,zt.value=0,il.value=i.name;const h=new FormData;h.append("image",i);const x=new XMLHttpRequest,C=await new Promise((re,Ge)=>{x.upload.onprogress=Ve=>{Ve.lengthComputable&&(zt.value=Math.round(Ve.loaded/Ve.total*100))},x.onreadystatechange=()=>{if(x.readyState===4)if(x.status>=200&&x.status<300)try{re(JSON.parse(x.responseText))}catch{Ge(new Error("响应解析失败"))}else Ge(new Error("上传失败"))},x.open("POST","/api/images/upload",!0),x.withCredentials=!0,x.send(h)});if(!C||C.code!==1)throw new Error((C==null?void 0:C.msg)||"上传失败");const Z=String(C.data||""),te=Z.startsWith("http")?Z:`/api${Z}`,ge=[...r.backgrounds,te];r.backgrounds=ge,await de("backgrounds"),w().add({title:"上传成功",description:`${i.name} 已添加到背景图片列表`,color:"green"})}catch(h){w().add({title:"错误",description:(h==null?void 0:h.message)||"上传失败",color:"red"})}finally{nl.value=!1,zt.value=0,il.value=""}wt.value&&(wt.value.value="")};Ue(()=>{window.addEventListener("frontend-config-updated",l=>{const{key:e,value:d}=l.detail;e&&d!==void 0&&(r[e]=d);try{const i=document.documentElement,h=u.value!=="light",x=i.classList.contains("dark");h&&!x?i.classList.add("dark"):!h&&x&&i.classList.remove("dark")}catch{}})});const Ns=()=>{qe(),yl.value=!1},Os=async()=>{r.backgrounds.push("")},Ws=async l=>{r.backgrounds.splice(l,1),await de("backgrounds")},Fs=()=>{var l;(l=wt.value)==null||l.click()},dl=V(!1),El=V(""),rl=l=>{l&&(El.value=l,dl.value=!0)},qs=l=>{if(l<=0)return;const e=[...r.backgrounds],[d]=e.splice(l,1);e.splice(l-1,0,d),r.backgrounds=e},Ks=l=>{const e=[...r.backgrounds];if(l>=e.length-1)return;const[d]=e.splice(l,1);e.splice(l+1,0,d),r.backgrounds=e},Gs=l=>{var h;const e=(h=l.dataTransfer)==null?void 0:h.files;if(!e||e.length===0)return;const d=wt.value;if(!d)return;const i=new DataTransfer;Array.from(e).forEach(x=>i.items.add(x)),d.files=i.files,d.dispatchEvent(new Event("change"))};Be(()=>k.isLogin,l=>{l||(k.getStatus(),k.getUser(),k.$reset())});const ul=V(!1);Ue(async()=>{var l;try{if(ul.value=!0,await Promise.all([k.getStatus(),k.getUser(),qe(),ne()]),k.isLogin){const d=await(await fetch("/api/user/token",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}})).json();d.code===1&&((l=d.data)!=null&&l.token)&&(O.value=d.data.token)}}catch(e){console.error("初始化失败:",e),w().add({title:"系统提示",description:"当前未登录",color:"red",timeout:3e3})}finally{ul.value=!1}});const kt=V(null),ut=V("sqlite"),Js=I(()=>({sqlite:"SQLite",postgres:"Postgres",mysql:"MySQL",other:"其它"})[ut.value]||ut.value),Xs=async()=>{try{const l=await fetch("/api/backup/download",{credentials:"include"});if(!l.ok)throw new Error("下载失败");const e=await l.blob(),d=window.URL.createObjectURL(e),i=document.createElement("a");i.href=d,i.download=`noise_backup_${new Date().toISOString().slice(0,10)}.zip`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(d),document.body.removeChild(i)}catch(l){w().add({title:"错误",description:l.message||"备份下载失败",color:"red"})}},Ys=()=>{var l;(l=kt.value)==null||l.click()},Zs=J,Tl=async l=>{const e=l.target.files;if(!(!e||!e[0])){try{const d=new FormData;d.append("database",e[0]);const h=await(await fetch("/api/backup/restore",{method:"POST",credentials:"include",body:d})).json();if(h.code===1)w().add({title:"成功",description:"数据库恢复成功",color:"green"}),Zs("restore-success"),setTimeout(()=>{window.location.reload()},1500);else throw new Error(h.msg)}catch(d){w().add({title:"错误",description:d.message||"数据库恢复失败",color:"red"})}kt.value&&(kt.value.value="")}},ee=V(!1),A=fe({provider:"",endpoint:"",region:"",bucket:"",accessKey:"",secretKey:"",usePathStyle:!0,publicBaseURL:""}),lt=V(!1),Ct=V("instant"),Nt=V(15),Ll=V(""),Ot=V(""),Wt=V(""),cl=async()=>{try{const e=await(await fetch("/api/frontend/config",{credentials:"include"})).json();if((e==null?void 0:e.code)===1){const d=(e.data.dbType||"sqlite").toLowerCase();ut.value=d==="sqlite"||d==="postgres"||d==="mysql"?d:"other",ee.value=!!e.data.storageEnabled;const i=e.data.storageConfig||{};A.provider=i.provider||"",A.endpoint=i.endpoint||"",A.region=i.region||"",A.bucket=i.bucket||"",A.accessKey=i.accessKey||"",A.secretKey=i.secretKey||"",A.usePathStyle=!!i.usePathStyle,A.publicBaseURL=i.publicBaseURL||"",lt.value=!!i.autoSyncEnabled,Ct.value=i.syncMode||"instant",Nt.value=Number(i.syncIntervalMinute||15),Ll.value=(i.lastSyncTime||"").replace("T"," ").replace("Z","")}}catch{}},Qs=async()=>{try{const l={storageEnabled:ee.value,storageConfig:{...A,autoSyncEnabled:lt.value,syncMode:Ct.value,syncIntervalMinute:Nt.value}},d=await(await fetch("/api/settings",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json();if((d==null?void 0:d.code)===1)w().add({title:"已保存云存储配置",color:"green"});else throw new Error((d==null?void 0:d.msg)||"保存失败")}catch(l){w().add({title:"保存失败",description:l.message,color:"red"})}},ea=async()=>{try{const e=await(await fetch("/api/backup/storage/sync-now",{method:"POST",credentials:"include"})).json();if((e==null?void 0:e.code)===1)w().add({title:"已同步到云端",color:"green"}),await cl();else throw new Error((e==null?void 0:e.msg)||"同步失败")}catch(l){w().add({title:"同步失败",description:l.message,color:"red"})}};Be(()=>A.provider,l=>{l==="r2"?(A.usePathStyle=!0,A.region||(A.region="auto")):l==="s3"&&A.usePathStyle===void 0&&(A.usePathStyle=!1)});const ta=async()=>{try{const l=Ot.value.trim();if(!l)throw new Error("请填写预签名上传URL");const e=await ke("backup/storage/upload",{uploadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)w().add({title:"云备份上传成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"上传失败")}catch(l){w().add({title:"上传失败",description:l.message,color:"red"})}},la=async()=>{try{const l=Wt.value.trim();if(!l)throw new Error("请填写预签名下载URL");const e=await ke("backup/storage/restore",{downloadURL:l},{credentials:"include"});if((e==null?void 0:e.code)===1)w().add({title:"云备份恢复成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"恢复失败")}catch(l){w().add({title:"恢复失败",description:l.message,color:"red"})}},sa=async()=>{var l;try{const e=await ke("backup/storage/presign/upload",{objectKey:"backup.zip",contentType:"application/zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))Ot.value=e.data.url,w().add({title:"生成上传预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){w().add({title:"生成失败",description:e.message,color:"red"})}},aa=async()=>{var l;try{const e=await ke("backup/storage/presign/download",{objectKey:"backup.zip",expiresSeconds:3600},{credentials:"include"});if((e==null?void 0:e.code)===1&&((l=e==null?void 0:e.data)!=null&&l.url))Wt.value=e.data.url,w().add({title:"生成下载预签名成功",color:"green"});else throw new Error((e==null?void 0:e.msg)||"生成失败")}catch(e){w().add({title:"生成失败",description:e.message,color:"red"})}},oa=async()=>{try{const l=(A.publicBaseURL||"").trim();if(!l)throw new Error("请先在配置中填写公共访问前缀");const e=(l.endsWith("/")?l:l+"/")+"backup.zip",d=await ke("backup/storage/restore",{downloadURL:e},{credentials:"include"});if((d==null?void 0:d.code)===1)w().add({title:"云备份恢复成功",color:"green"});else throw new Error((d==null?void 0:d.msg)||"恢复失败")}catch(l){w().add({title:"恢复失败",description:l.message,color:"red"})}};return V(null),(l,e)=>{var Ft,ct,Sl,Al,Bl,$l,Rl,jl,Pl,Il,Dl,Hl;const d=Jt,i=gl,h=Ba,x=xa,C=fl,Z=bl,te=Ca,ge=Zl,re=Ql,Ge=ha,Ve=Xl,ye=Jl("USwitch"),K=Va,Q=ya;return f(),b("div",{class:n(["fixed inset-0 w-full h-full overflow-x-hidden overflow-y-auto",o.value.pageBg])},[t("div",Wo,[t("aside",{class:n(["w-72 h-screen overflow-y-auto backdrop-blur-md flex flex-col fixed left-0 top-0 z-40 transition-transform duration-300 md:transition-none border-r",[{"translate-x-0":U.value,"-translate-x-full md:translate-x-0":!U.value},o.value.sidebarBg,o.value.border,o.value.sidebarText]])},[t("div",Fo,[t("img",{src:z.value,class:"w-14 h-14 rounded-full ring-2 ring-indigo-400/60 shadow-lg object-cover",alt:"avatar"},null,8,qo),t("div",Ko,[t("div",Go,y(((Ft=he(k).user)==null?void 0:Ft.username)||"未登录"),1),t("div",{class:n(["text-xs",o.value.mutedText])},"总笔记 "+y(((Sl=(ct=he(k))==null?void 0:ct.status)==null?void 0:Sl.total_messages)||0),3)])]),t("nav",Jo,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[0]||(e[0]=a=>j("system"))},[s(d,{name:"i-heroicons-cpu-chip",class:"w-5 h-5 text-indigo-300"}),e[198]||(e[198]=t("span",{class:"text-sm text-center"},"系统信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[1]||(e[1]=a=>j("user"))},[s(d,{name:"i-heroicons-user-circle",class:"w-5 h-5 text-indigo-300"}),e[199]||(e[199]=t("span",{class:"text-sm text-center"},"用户信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[2]||(e[2]=a=>j("site"))},[s(d,{name:"i-heroicons-wrench-screwdriver",class:"w-5 h-5 text-indigo-300"}),e[200]||(e[200]=t("span",{class:"text-sm text-center"},"网站配置",-1))],2),Se.value?(f(),b("div",Xo,[t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[3]||(e[3]=a=>j("site-register"))},[s(d,{name:"i-heroicons-user-plus",class:"w-5 h-5 text-indigo-300"}),e[201]||(e[201]=t("span",{class:"text-sm text-center"},"注册开关",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[4]||(e[4]=a=>j("site-pwa"))},[s(d,{name:"i-heroicons-rocket-launch",class:"w-5 h-5 text-indigo-300"}),e[202]||(e[202]=t("span",{class:"text-sm text-center"},"PWA 模式",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[5]||(e[5]=a=>j("site-github-card"))},[s(d,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[203]||(e[203]=t("span",{class:"text-sm text-center"},"GitHub 卡片",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[6]||(e[6]=a=>j("site-github-login"))},[s(d,{name:"i-mdi-github",class:"w-5 h-5 text-indigo-300"}),e[204]||(e[204]=t("span",{class:"text-sm text-center"},"GitHub 登录",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[7]||(e[7]=a=>j("site-announcement"))},[s(d,{name:"i-heroicons-megaphone",class:"w-5 h-5 text-indigo-300"}),e[205]||(e[205]=t("span",{class:"text-sm text-center"},"公告栏",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[8]||(e[8]=a=>j("site-music"))},[s(d,{name:"i-heroicons-musical-note",class:"w-5 h-5 text-indigo-300"}),e[206]||(e[206]=t("span",{class:"text-sm text-center"},"音乐配置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[9]||(e[9]=a=>j("site-default-theme"))},[s(d,{name:"i-heroicons-swatch",class:"w-5 h-5 text-indigo-300"}),e[207]||(e[207]=t("span",{class:"text-sm text-center"},"默认主题",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[10]||(e[10]=a=>j("site-configs"))},[s(d,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5 text-indigo-300"}),e[208]||(e[208]=t("span",{class:"text-sm text-center"},"站点信息",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[11]||(e[11]=a=>j("comments"))},[s(d,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5 text-indigo-300"}),e[209]||(e[209]=t("span",{class:"text-sm text-center"},"评论系统",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[12]||(e[12]=a=>j("email"))},[s(d,{name:"i-heroicons-envelope",class:"w-5 h-5 text-indigo-300"}),e[210]||(e[210]=t("span",{class:"text-sm text-center"},"邮件设置",-1))],2),t("button",{class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[13]||(e[13]=a=>j("admin-users"))},[s(d,{name:"i-heroicons-shield-check",class:"w-5 h-5 text-indigo-300"}),e[211]||(e[211]=t("span",{class:"text-sm text-center"},"管理员用户",-1))],2)])):$("",!0),Se.value?(f(),b("button",{key:1,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[14]||(e[14]=a=>j("notify"))},[s(d,{name:"i-heroicons-bell-alert",class:"w-5 h-5 text-indigo-300"}),e[212]||(e[212]=t("span",{class:"text-sm text-center"},"推送配置",-1))],2)):$("",!0),Se.value?(f(),b("button",{key:2,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[15]||(e[15]=a=>j("attachments"))},[s(d,{name:"i-heroicons-paper-clip",class:"w-5 h-5 text-indigo-300"}),e[213]||(e[213]=t("span",{class:"text-sm text-center"},"附件管理",-1))],2)):$("",!0),Se.value?(f(),b("button",{key:3,class:n(["w-full flex justify-center items-center gap-2 px-3 py-2 rounded-lg transition shadow",[o.value.navBtnBg,o.value.navBtnHoverBg]]),onClick:e[16]||(e[16]=a=>j("db"))},[s(d,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[214]||(e[214]=t("span",{class:"text-sm text-center"},"数据库管理",-1))],2)):$("",!0)]),t("div",Yo,[t("div",Zo,"当前版本: "+y(Y.currentVersion||"最新"),1),t("div",Qo,[s(i,{size:"xs",color:"gray",variant:"soft",loading:Y.checking,class:"shadow-md",onClick:es},{default:m(()=>[v(y(Y.checking?"检测中...":"检查版本发布时间"),1)]),_:1},8,["loading"])]),Y.hasUpdate?(f(),b("div",en,[s(d,{name:"i-heroicons-arrow-up-circle",class:"w-4 h-4"}),t("span",null,"最近更新于 "+y(Y.latestVersion),1)])):$("",!0)])],2),t("main",{class:n(["w-full min-h-screen md:pl-72 overflow-y-auto",o.value.text])},[t("div",{class:n(["md:hidden flex items-center justify-between px-4 py-3 border-b rounded-b-2xl",[o.value.headerBg,o.value.border,o.value.text]])},[t("div",tn,[t("button",{class:"p-2 rounded-lg bg-slate-800/70 shadow",onClick:e[17]||(e[17]=a=>U.value=!U.value)},[s(d,{name:"i-heroicons-bars-3",class:"w-5 h-5"})]),e[215]||(e[215]=t("span",{class:"font-semibold"},"系统管理面板",-1))]),t("div",ln,[s(i,{variant:"soft",color:u.value==="light"?"gray":"white",class:"shadow",onClick:e[18]||(e[18]=a=>l.$router.push("/"))},{default:m(()=>e[216]||(e[216]=[v("返回首页")])),_:1},8,["color"]),Et.value?(f(),ml(i,{key:0,icon:"i-heroicons-power",color:"red",variant:"solid",onClick:wl},{default:m(()=>e[217]||(e[217]=[v("退出登录")])),_:1})):$("",!0)])],2),U.value?(f(),b("div",{key:0,class:"fixed inset-0 bg-black/40 md:hidden",onClick:e[19]||(e[19]=a=>U.value=!1)})):$("",!0),t("div",sn,[t("div",an,[t("h1",{class:n(["text-2xl md:text-3xl font-bold text-center",o.value.text])},"系统管理面板",2)]),t("div",on,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",nn,[t("div",dn,[t("span",{class:n(o.value.text)},"配色",2),t("div",rn,[t("div",un,[s(h,{modelValue:u.value,"onUpdate:modelValue":e[20]||(e[20]=a=>u.value=a),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",cn,[s(h,{modelValue:u.value,"onUpdate:modelValue":e[21]||(e[21]=a=>u.value=a),value:"midnight",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="midnight"?o.value.text:"text-slate-400")},"深蓝",2)]),t("div",mn,[s(h,{modelValue:u.value,"onUpdate:modelValue":e[22]||(e[22]=a=>u.value=a),value:"slate",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="slate"?o.value.text:"text-slate-400")},"石板",2)]),t("div",pn,[s(h,{modelValue:u.value,"onUpdate:modelValue":e[23]||(e[23]=a=>u.value=a),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(u.value==="light"?o.value.text:"text-slate-400")},"明亮",2)])])]),t("div",vn,[s(i,{size:"sm",color:"green",class:"shadow",onClick:W},{default:m(()=>e[218]||(e[218]=[v("保存")])),_:1})])])],2)]),$("",!0),$("",!0),t("div",gn,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",fn,[t("div",null,[t("span",{class:n(o.value.text)},"系统管理员",2),t("span",bn,y((Bl=(Al=he(k))==null?void 0:Al.status)==null?void 0:Bl.username),1)]),t("div",null,[t("span",{class:n(o.value.text)},"当前用户",2),t("span",wn,y(Et.value&&(($l=he(k).user)==null?void 0:$l.username)||"未登录"),1)]),t("div",null,[t("span",{class:n(o.value.text)},"笔记总数",2),t("span",yn,y((jl=(Rl=he(k))==null?void 0:Rl.status)==null?void 0:jl.total_messages)+" 条",1)])])],2)]),Et.value?(f(),b("div",xn,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",{class:n(["flex items-center justify-between px-4 py-3",o.value.text])},e[228]||(e[228]=[t("div",{class:"font-semibold"},"用户信息配置",-1)]),2),t("div",hn,[t("div",{class:n(["rounded-lg p-3 h-full",o.value.subtleBg])},[t("div",kn,[t("span",{class:n(o.value.mutedText)},"用户名",2),s(i,{size:"sm",onClick:e[31]||(e[31]=a=>G.username=!G.username),color:G.username?"gray":"green",variant:G.username?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(G.username?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),G.username?(f(),b("div",Cn,[s(C,{modelValue:L.username,"onUpdate:modelValue":e[32]||(e[32]=a=>L.username=a),placeholder:"新用户名",class:"w-full mb-2"},null,8,["modelValue"]),t("div",Vn,[s(i,{onClick:ns,color:"primary",class:"shadow"},{default:m(()=>e[229]||(e[229]=[v("保存")])),_:1})])])):(f(),b("div",Un,[s(te,{color:"primary",variant:"soft",class:"ml-0 text-xs px-2 py-1 rounded-md !text-slate-800 dark:!text-slate-200"},{default:m(()=>{var a;return[v(y((a=he(k).user)==null?void 0:a.username),1)]}),_:1})])),t("div",En,[t("div",Tn,[t("span",{class:n(o.value.mutedText)},"头像",2),t("div",Ln,[s(i,{size:"sm",onClick:vs,color:"gray",variant:"soft",class:"shadow"},{default:m(()=>e[230]||(e[230]=[v("上传头像")])),_:1}),s(i,{size:"sm",loading:Ae.value,onClick:xs,color:"orange",variant:"soft",class:"shadow"},{default:m(()=>e[231]||(e[231]=[v("使用首字母头像")])),_:1},8,["loading"])])]),t("div",Sn,[t("img",{src:z.value,class:"w-10 h-10 rounded-full object-cover",alt:"avatar"},null,8,An)]),t("p",{class:n(["text-xs mt-1",o.value.mutedText])},"选择图片后自动进入裁剪，裁剪完成即可保存并预览",2),t("input",{ref_key:"avatarInput",ref:bt,type:"file",accept:"image/*",class:"hidden",onChange:gs},null,544),t("div",Bn,[s(C,{modelValue:St.value,"onUpdate:modelValue":e[33]||(e[33]=a=>St.value=a),placeholder:"头像链接（http或/api开头）",class:"flex-1"},null,8,["modelValue"]),s(i,{size:"sm",loading:Ae.value,onClick:bs,color:"primary",variant:"solid",class:"shadow"},{default:m(()=>e[232]||(e[232]=[v("保存链接")])),_:1},8,["loading"])]),s(ge,{modelValue:yt.value,"onUpdate:modelValue":e[35]||(e[35]=a=>yt.value=a)},{default:m(()=>[t("div",$n,[t("div",{class:n([o.value.mutedText,"mb-2"])},"裁剪头像（拖动图片调整位置，滑块调整缩放）",2),t("div",Rn,[Ie.value?(f(),b("img",{key:0,src:Ie.value,alt:"to-crop",style:ma({position:"absolute",left:"50%",top:"50%",transform:`translate(-50%, -50%) translate(${At.value}px, ${Bt.value}px) scale(${xt.value})`,userSelect:"none"}),onMousedown:hl,onTouchstart:hl},null,44,jn)):$("",!0)]),t("div",Pn,[t("span",{class:n(o.value.mutedText)},"缩放",2),qt(t("input",{type:"range",min:"0.5",max:"3",step:"0.01","onUpdate:modelValue":e[34]||(e[34]=a=>xt.value=a)},null,512),[[pa,xt.value,void 0,{number:!0}]]),s(i,{loading:Ae.value,color:"green",onClick:ws},{default:m(()=>e[233]||(e[233]=[v("裁剪并保存")])),_:1},8,["loading"]),s(i,{color:"gray",variant:"soft",onClick:ys},{default:m(()=>e[234]||(e[234]=[v("取消")])),_:1})])])]),_:1},8,["modelValue"]),t("div",In,[t("div",Dn,[t("span",{class:n(o.value.mutedText)},"个性签名",2),s(i,{size:"sm",onClick:e[36]||(e[36]=a=>G.description=!G.description),color:G.description?"gray":"green",variant:G.description?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(G.description?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),G.description?(f(),b("div",Hn,[s(Z,{modelValue:L.description,"onUpdate:modelValue":e[37]||(e[37]=a=>L.description=a),placeholder:"一句话介绍自己",class:"w-full mb-2"},null,8,["modelValue"]),t("div",_n,[s(i,{onClick:is,color:"primary",class:"shadow"},{default:m(()=>e[235]||(e[235]=[v("保存")])),_:1})])])):(f(),b("div",Mn,[t("div",{class:n([o.value.subtleBg,o.value.border,"rounded-md p-3 border"])},[t("p",{class:n([o.value.text,"break-words"])},y(((Pl=he(k).user)==null?void 0:Pl.description)||"执迷不悟"),3)],2)]))])])],2),t("div",{class:n(["rounded-lg p-3 md:col-span-2",o.value.subtleBg])},[t("div",zn,[t("div",Nn,[t("span",{class:n(o.value.mutedText)},"API Token",2),s(te,{color:"primary",variant:"subtle",class:"text-xs px-2 py-1 rounded-md !text-primary-600 dark:!text-primary-300"},{default:m(()=>[v(y(O.value?"已生成":"未生成"),1)]),_:1}),s(i,{size:"xs",loading:Qt.value,onClick:ts,color:"gray",variant:"soft",class:"shadow text-xs px-2 py-1 rounded-md text-slate-600 dark:text-slate-200",title:"重新生成将使旧 Token 失效"},{default:m(()=>e[236]||(e[236]=[v("重新生成")])),_:1},8,["loading"])])]),O.value?(f(),b("div",On,[t("div",Wn,[s(C,{modelValue:O.value,"onUpdate:modelValue":e[38]||(e[38]=a=>O.value=a),type:ot.value?"text":"password",readonly:"",class:"font-mono text-sm flex-1 min-w-0"},null,8,["modelValue","type"]),s(i,{icon:ot.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[39]||(e[39]=a=>ot.value=!ot.value),title:ot.value?"隐藏":"显示"},null,8,["icon","title"]),s(i,{icon:"i-heroicons-clipboard",color:"gray",variant:"ghost",onClick:ls,title:"复制 Token"})]),t("p",{class:n(["text-xs mt-1",o.value.mutedText])},"请妥善保管此 Token",2)])):(f(),b("div",Fn,[t("p",{class:n(o.value.mutedText)},"暂无 Token",2)])),t("div",qn,[t("span",{class:n(o.value.mutedText)},"邮箱",2),t("span",{class:n((Il=he(k).user)!=null&&Il.email?o.value.text:"text-amber-400")},y((Dl=he(k).user)!=null&&Dl.email?(Hl=he(k).user)==null?void 0:Hl.email:"未绑定邮箱，请先绑定邮箱"),3)]),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",Kn,[t("span",{class:n(o.value.mutedText)},"修改密码",2),s(i,{size:"sm",onClick:e[40]||(e[40]=a=>G.password=!G.password),color:G.password?"gray":"green",variant:G.password?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(G.password?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),G.password?(f(),b("div",Gn,[t("div",Jn,[s(C,{modelValue:L.oldPassword,"onUpdate:modelValue":e[41]||(e[41]=a=>L.oldPassword=a),type:Rt.value?"text":"password",placeholder:"当前密码",class:"flex-1"},null,8,["modelValue","type"]),s(i,{icon:Rt.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[42]||(e[42]=a=>Rt.value=!Rt.value)},null,8,["icon"])]),t("div",Xn,[s(C,{modelValue:L.newPassword,"onUpdate:modelValue":e[43]||(e[43]=a=>L.newPassword=a),type:jt.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),s(te,{color:as.value,variant:"soft"},{default:m(()=>[v(y(ss.value),1)]),_:1},8,["color"]),s(i,{icon:jt.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[44]||(e[44]=a=>jt.value=!jt.value)},null,8,["icon"])]),t("div",Yn,[s(C,{modelValue:L.confirmPassword,"onUpdate:modelValue":e[45]||(e[45]=a=>L.confirmPassword=a),type:Pt.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"]),s(i,{icon:Pt.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[46]||(e[46]=a=>Pt.value=!Pt.value)},null,8,["icon"])]),t("div",Zn,[s(i,{onClick:ds,disabled:!os.value,color:"primary",class:"shadow"},{default:m(()=>e[237]||(e[237]=[v("保存")])),_:1},8,["disabled"])])])):$("",!0)],2),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",Qn,[t("span",{class:n(o.value.mutedText)},"绑定邮箱",2),s(i,{size:"sm",onClick:e[47]||(e[47]=a=>G.emailBind=!G.emailBind),color:G.emailBind?"gray":"green",variant:G.emailBind?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(G.emailBind?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),G.emailBind?(f(),b("div",ei,[t("div",ti,[s(C,{modelValue:L.email,"onUpdate:modelValue":e[48]||(e[48]=a=>L.email=a),type:"email",placeholder:"输入邮箱",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"gray",variant:"soft",onClick:rs},{default:m(()=>e[238]||(e[238]=[v("发送验证码")])),_:1})]),t("div",li,[s(C,{modelValue:L.emailCode,"onUpdate:modelValue":e[49]||(e[49]=a=>L.emailCode=a),placeholder:"验证码",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"primary",class:"shadow",onClick:us},{default:m(()=>e[239]||(e[239]=[v("绑定")])),_:1})])])):$("",!0)],2),t("div",{class:n(["border-t mt-4 pt-3",o.value.border])},[t("div",si,[t("span",{class:n(o.value.mutedText)},"更换邮箱",2),s(i,{size:"sm",onClick:e[50]||(e[50]=a=>G.emailChange=!G.emailChange),color:G.emailChange?"gray":"green",variant:G.emailChange?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(G.emailChange?"取消":"编辑"),1)]),_:1},8,["color","variant"])]),G.emailChange?(f(),b("div",ai,[t("div",oi,[s(i,{color:"gray",variant:"soft",onClick:cs},{default:m(()=>e[240]||(e[240]=[v("向当前邮箱发送验证码")])),_:1}),s(C,{modelValue:L.changeCode,"onUpdate:modelValue":e[51]||(e[51]=a=>L.changeCode=a),placeholder:"收到的验证码",class:"flex-1"},null,8,["modelValue"])]),t("div",ni,[s(C,{modelValue:L.newEmail,"onUpdate:modelValue":e[52]||(e[52]=a=>L.newEmail=a),type:"email",placeholder:"新的邮箱",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"primary",class:"shadow",onClick:ms},{default:m(()=>e[241]||(e[241]=[v("更换")])),_:1})]),Zt.value?(f(),b("div",ii,[s(C,{modelValue:L.emailCode,"onUpdate:modelValue":e[53]||(e[53]=a=>L.emailCode=a),placeholder:"新邮箱验证码",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"primary",class:"shadow",onClick:ps},{default:m(()=>e[242]||(e[242]=[v("确认更换")])),_:1})])):$("",!0)])):$("",!0)],2)],2)])],2)])):$("",!0),t("div",di,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",ri,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-cog-6-tooth",class:"w-5 h-5"}),e[243]||(e[243]=t("span",null,"网站配置",-1))],2)]),t("div",ui,[t("div",{class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",ci,[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-hand-thumb-up",class:"w-4 h-4"}),e[244]||(e[244]=t("span",null,"系统欢迎组件",-1))],2),t("div",mi,[s(i,{size:"sm",color:"gray",variant:"soft",onClick:Cs},{default:m(()=>e[245]||(e[245]=[v("使用管理员头像信息")])),_:1}),s(i,{size:"sm",color:"gray",variant:"soft",onClick:Vs},{default:m(()=>e[246]||(e[246]=[v("重置")])),_:1}),s(i,{size:"sm",color:"primary",class:"shadow",onClick:e[54]||(e[54]=a=>de("welcome"))},{default:m(()=>e[247]||(e[247]=[v("保存")])),_:1})])]),t("div",pi,[t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"显示名称",2),s(C,{modelValue:r.welcomeName,"onUpdate:modelValue":e[55]||(e[55]=a=>r.welcomeName=a),placeholder:"如 Noise 或站点名"},null,8,["modelValue"])]),t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"头像URL",2),s(C,{modelValue:r.welcomeAvatarURL,"onUpdate:modelValue":e[56]||(e[56]=a=>r.welcomeAvatarURL=a),placeholder:"http/https 或以 /api 开头的站内路径"},null,8,["modelValue"])]),t("div",vi,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"简介文案",2),s(Z,{modelValue:r.welcomeDescription,"onUpdate:modelValue":e[57]||(e[57]=a=>r.welcomeDescription=a),placeholder:"一句话欢迎语或个人签名"},null,8,["modelValue"])])]),t("div",{class:n(["text-xs mt-2",o.value.mutedText])},"未登录时展示该组件；登录后显示当前用户的头像与签名",2)],2),t("div",{id:"site-register-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-user-plus",class:"w-4 h-4"}),e[248]||(e[248]=v()),e[249]||(e[249]=t("span",null,"新用户注册",-1))],2),t("div",gi,[t("div",fi,[s(h,{modelValue:M.value,"onUpdate:modelValue":e[58]||(e[58]=a=>M.value=a),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(M.value?o.value.text:"text-slate-400")},"允许",2)]),t("div",bi,[s(h,{modelValue:M.value,"onUpdate:modelValue":e[59]||(e[59]=a=>M.value=a),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(M.value?"text-slate-400":o.value.text)},"不允许",2)]),s(i,{color:"green",onClick:se,class:"shadow"},{default:m(()=>e[250]||(e[250]=[v("保存")])),_:1})])],2),t("div",{id:"site-pwa-section",class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",wi,[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-rocket-launch",class:"w-4 h-4"}),e[251]||(e[251]=v()),e[252]||(e[252]=t("span",null,"PWA 模式",-1))],2),t("div",yi,[s(x,{modelValue:r.pwaEnabled,"onUpdate:modelValue":e[60]||(e[60]=a=>r.pwaEnabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:ks,class:"shadow"},{default:m(()=>e[253]||(e[253]=[v("保存")])),_:1})])]),t("div",xi,[t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 标题",2),s(C,{modelValue:r.pwaTitle,"onUpdate:modelValue":e[61]||(e[61]=a=>r.pwaTitle=a),placeholder:r.siteTitle||"说说笔记"},null,8,["modelValue","placeholder"])]),t("div",null,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 图标",2),s(C,{modelValue:r.pwaIconURL,"onUpdate:modelValue":e[62]||(e[62]=a=>r.pwaIconURL=a),placeholder:"/favicon.ico"},null,8,["modelValue"])]),t("div",hi,[t("label",{class:n([o.value.mutedText,"text-sm mb-1 block"])},"PWA 描述",2),s(Z,{modelValue:r.pwaDescription,"onUpdate:modelValue":e[63]||(e[63]=a=>r.pwaDescription=a),placeholder:r.description||""},null,8,["modelValue","placeholder"])])])],2),t("div",{id:"site-github-card-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-mdi-github",class:"w-4 h-4"}),e[254]||(e[254]=v()),e[255]||(e[255]=t("span",null,"GitHub 链接卡片解析",-1))],2),t("div",ki,[t("div",Ci,[s(h,{modelValue:Fe.value,"onUpdate:modelValue":e[64]||(e[64]=a=>Fe.value=a),value:!0,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(Fe.value?o.value.text:"text-slate-400")},"开启",2)]),t("div",Vi,[s(h,{modelValue:Fe.value,"onUpdate:modelValue":e[65]||(e[65]=a=>Fe.value=a),value:!1,class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(Fe.value?"text-slate-400":o.value.text)},"关闭",2)]),s(i,{color:"green",onClick:Ds,class:"shadow"},{default:m(()=>e[256]||(e[256]=[v("保存")])),_:1})])],2),t("div",{id:"site-announcement-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-megaphone",class:"w-4 h-4"}),e[257]||(e[257]=v()),e[258]||(e[258]=t("span",null,"公告栏开关",-1))],2),t("div",Ui,[s(x,{modelValue:r.announcementEnabled,"onUpdate:modelValue":e[66]||(e[66]=a=>r.announcementEnabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:e[67]||(e[67]=a=>de("announcementEnabled")),class:"shadow"},{default:m(()=>e[259]||(e[259]=[v("保存")])),_:1})])],2),t("div",{class:n(["rounded-lg p-3 mt-3",o.value.subtleBg])},[t("div",{class:n(["text-sm mb-2",o.value.mutedText])},"公告栏文本",2),s(Z,{modelValue:r.announcementText,"onUpdate:modelValue":e[68]||(e[68]=a=>r.announcementText=a),placeholder:"请输入公告内容",class:"w-full mb-2"},null,8,["modelValue"]),t("div",Ei,[s(i,{color:"primary",class:"shadow",onClick:e[69]||(e[69]=a=>de("announcementText"))},{default:m(()=>e[260]||(e[260]=[v("保存公告文本")])),_:1})])],2),t("div",Ti,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",Li,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-musical-note",class:"w-5 h-5"}),e[261]||(e[261]=t("span",null,"音乐配置",-1))],2),t("div",Si,[s(x,{modelValue:r.musicEnabled,"onUpdate:modelValue":e[70]||(e[70]=a=>r.musicEnabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:Ul,class:"shadow"},{default:m(()=>e[262]||(e[262]=[v("保存")])),_:1})])]),t("div",Ai,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",Bi,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌单 ID",2),s(C,{modelValue:r.musicPlaylistId,"onUpdate:modelValue":e[71]||(e[71]=a=>r.musicPlaylistId=a),disabled:(r.musicSongId||"").trim()!=="",placeholder:"如 14273792576"},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"歌曲 ID",2),s(C,{modelValue:r.musicSongId,"onUpdate:modelValue":e[72]||(e[72]=a=>r.musicSongId=a),disabled:(r.musicPlaylistId||"").trim()!=="",placeholder:"可选，优先歌单"},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"显示位置",2),s(re,{modelValue:r.musicPosition,"onUpdate:modelValue":e[73]||(e[73]=a=>r.musicPosition=a),disabled:al.value==="embed",options:[{label:"左下角",value:"bottom-left"},{label:"右下角",value:"bottom-right"},{label:"左上角",value:"top-left"},{label:"右上角",value:"top-right"}]},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"主题",2),s(re,{modelValue:r.musicTheme,"onUpdate:modelValue":e[74]||(e[74]=a=>r.musicTheme=a),options:[{label:"自动",value:"auto"},{label:"深色",value:"dark"},{label:"浅色",value:"light"}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"CDN 源",2),s(re,{modelValue:He.value,"onUpdate:modelValue":e[75]||(e[75]=a=>He.value=a),options:[{label:"官方 CDN",value:"hypcvgm"},{label:"jsDelivr",value:"jsdelivr"},{label:"unpkg",value:"unpkg"},{label:"自定义",value:"custom"}]},null,8,["modelValue"])]),He.value==="custom"?(f(),b("div",$i,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"CSS CDN 地址",2),s(C,{modelValue:r.musicCssCdnURL,"onUpdate:modelValue":e[76]||(e[76]=a=>r.musicCssCdnURL=a),placeholder:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.css"},null,8,["modelValue"])])):$("",!0),He.value==="custom"?(f(),b("div",Ri,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"JS CDN 地址",2),s(C,{modelValue:r.musicJsCdnURL,"onUpdate:modelValue":e[77]||(e[77]=a=>r.musicJsCdnURL=a),placeholder:"https://api.hypcvgm.top/NeteaseMiniPlayer/netease-mini-player-v2.js"},null,8,["modelValue"])])):$("",!0),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"显示歌词",2),s(re,{modelValue:r.musicLyric,"onUpdate:modelValue":e[78]||(e[78]=a=>r.musicLyric=a),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"自动播放",2),s(re,{modelValue:r.musicAutoplay,"onUpdate:modelValue":e[79]||(e[79]=a=>r.musicAutoplay=a),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"默认最小化",2),s(re,{modelValue:r.musicDefaultMinimized,"onUpdate:modelValue":e[80]||(e[80]=a=>r.musicDefaultMinimized=a),options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["modelValue"])]),t("div",ji,[t("span",{class:n(["text-sm",o.value.mutedText])},"展示模式",2),s(re,{modelValue:al.value,"onUpdate:modelValue":e[81]||(e[81]=a=>al.value=a),options:[{label:"嵌入",value:"embed"},{label:"浮动",value:"float"}]},null,8,["modelValue"])])]),t("div",Pi,[s(i,{variant:"soft",color:"gray",onClick:Hs},{default:m(()=>e[263]||(e[263]=[v("重置")])),_:1}),s(i,{color:"green",onClick:Ul},{default:m(()=>e[264]||(e[264]=[v("保存")])),_:1})]),t("div",{class:n(["text-xs mt-2",o.value.mutedText])},"保存后首页自动刷新显示播放器；歌单与单曲任选其一",2)],2)])],2)]),t("div",{id:"site-default-theme-section",class:n(["flex items-center rounded-lg p-3 justify-between",o.value.subtleBg])},[t("div",{class:n(["flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-swatch",class:"w-4 h-4"}),e[265]||(e[265]=v()),e[266]||(e[266]=t("span",null,"默认主题色",-1))],2),t("div",Ii,[t("div",Di,[s(h,{modelValue:r.defaultContentTheme,"onUpdate:modelValue":e[82]||(e[82]=a=>r.defaultContentTheme=a),value:"dark",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(r.defaultContentTheme==="dark"?o.value.text:"text-slate-400")},"暗黑",2)]),t("div",Hi,[s(h,{modelValue:r.defaultContentTheme,"onUpdate:modelValue":e[83]||(e[83]=a=>r.defaultContentTheme=a),value:"light",class:"mr-2"},null,8,["modelValue"]),t("span",{class:n(r.defaultContentTheme==="light"?o.value.text:"text-slate-400")},"白天",2)]),s(i,{color:"green",onClick:e[84]||(e[84]=a=>de("defaultContentTheme")),class:"shadow"},{default:m(()=>e[267]||(e[267]=[v("保存")])),_:1})])],2),t("div",_i,[(f(),b(ue,null,ce(el,(a,R)=>t("div",{key:R,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",Mi,[t("span",{class:n(o.value.mutedText)},y(a),3),s(i,{size:"sm",onClick:H=>ve[R]=!ve[R],color:ve[R]?"gray":"green",variant:ve[R]?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(ve[R]?"取消":"编辑"),1)]),_:2},1032,["onClick","color","variant"])]),ve[R]?(f(),b("div",zi,[R==="背景图片"||R==="backgrounds"?(f(),b("div",Ni,[(f(!0),b(ue,null,ce(r.backgrounds,(H,xe)=>(f(),b("div",{key:xe,class:"flex items-center gap-3"},[t("img",{src:H||"/favicon.ico",class:n(["w-14 h-14 rounded object-cover border",o.value.border]),onClick:st=>rl(H)},null,10,Oi),s(C,{modelValue:r.backgrounds[xe],"onUpdate:modelValue":st=>r.backgrounds[xe]=st,placeholder:"输入图片URL",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),t("div",Wi,[s(i,{size:"xs",variant:"soft",icon:"i-heroicons-arrow-up",onClick:st=>qs(xe)},{default:m(()=>e[268]||(e[268]=[v("上移")])),_:2},1032,["onClick"]),s(i,{size:"xs",variant:"soft",icon:"i-heroicons-arrow-down",onClick:st=>Ks(xe)},{default:m(()=>e[269]||(e[269]=[v("下移")])),_:2},1032,["onClick"]),s(i,{size:"xs",variant:"soft",icon:"i-heroicons-eye",onClick:st=>rl(H)},{default:m(()=>e[270]||(e[270]=[v("预览")])),_:2},1032,["onClick"]),s(i,{size:"xs",color:"red",variant:"soft",icon:"i-heroicons-trash",onClick:st=>Ws(xe)},{default:m(()=>e[271]||(e[271]=[v("删除")])),_:2},1032,["onClick"])])]))),128)),t("div",{class:n(["rounded border-2 border-dashed p-4 text-center",o.value.border]),onDragover:e[85]||(e[85]=Ml(()=>{},["prevent"])),onDrop:Ml(Gs,["prevent"])},[t("div",Fi,[s(i,{onClick:Os,icon:"i-heroicons-plus",variant:"ghost"},{default:m(()=>e[272]||(e[272]=[v("添加链接")])),_:1}),s(i,{onClick:Fs,icon:"i-heroicons-cloud-arrow-up",variant:"ghost"},{default:m(()=>e[273]||(e[273]=[v("上传图片")])),_:1})]),nl.value?(f(),b("div",qi,[t("div",{class:n(["text-xs",o.value.mutedText])},y(il.value),3),s(Ge,{value:zt.value,class:"mt-1"},null,8,["value"])])):$("",!0)],34)])):R==="avatarURL"?(f(),b("div",Ki,[t("div",Gi,[t("img",{src:r.avatarURL,class:"w-12 h-12 rounded-full object-cover",alt:"site-avatar"},null,8,Ji),s(i,{size:"sm",color:"gray",variant:"soft",onClick:e[86]||(e[86]=H=>{var xe;return(xe=Lt.value)==null?void 0:xe.click()})},{default:m(()=>e[274]||(e[274]=[v("上传图片")])),_:1}),t("input",{ref_for:!0,ref_key:"siteAvatarInput",ref:Lt,type:"file",accept:"image/*",class:"hidden",onChange:Us},null,544)]),s(C,{modelValue:r.avatarURL,"onUpdate:modelValue":e[87]||(e[87]=H=>r.avatarURL=H),placeholder:"输入图片URL",class:"w-full"},null,8,["modelValue"])])):R==="subtitleText"||R==="linksDescription"||R==="commentPageDescription"||R==="aboutPageDescription"||R==="aboutMarkdown"?(f(),ml(Z,{key:2,modelValue:r[R],"onUpdate:modelValue":H=>r[R]=H,placeholder:`输入${a}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(f(),ml(C,{key:3,modelValue:r[R],"onUpdate:modelValue":H=>r[R]=H,placeholder:`输入${a}`,class:"w-full mb-2"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),t("div",Xi,[s(i,{onClick:H=>hs(R),variant:"ghost",color:"gray"},{default:m(()=>e[275]||(e[275]=[v("重置")])),_:2},1032,["onClick"]),s(i,{onClick:H=>de(R),color:"primary",class:"shadow"},{default:m(()=>e[276]||(e[276]=[v("保存")])),_:2},1032,["onClick"])])])):(f(),b("div",Yi,[R==="backgrounds"?(f(),b("div",Zi,[(f(!0),b(ue,null,ce(r.backgrounds,(H,xe)=>(f(),b("img",{key:xe,src:H,class:n(["w-full h-24 object-cover rounded cursor-pointer border",o.value.border]),onClick:st=>rl(H)},null,10,Qi))),128))])):R==="avatarURL"?(f(),b("div",ed,[t("img",{src:r.avatarURL,class:"w-12 h-12 rounded-full object-cover",alt:"site-avatar"},null,8,td),t("span",{class:n(o.value.mutedText)},"站点头像预览",2)])):(f(),b("div",{key:2,class:n([o.value.subtleBg,o.value.border,"rounded-md p-3 border"])},[t("p",{class:n([o.value.text,"break-words"])},y(r[R]),3)],2))]))],2)),64))]),yl.value?(f(),b("div",ld,[s(i,{onClick:Ns,variant:"ghost",color:"gray"},{default:m(()=>e[277]||(e[277]=[v("重置")])),_:1}),s(i,{onClick:l.saveConfig,color:"primary",class:"shadow"},{default:m(()=>e[278]||(e[278]=[v("保存所有更改")])),_:1},8,["onClick"])])):$("",!0),t("div",sd,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",ad,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-megaphone",class:"w-5 h-5"}),e[279]||(e[279]=t("span",null,"左侧广告模块",-1))],2),t("div",od,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.leftAdEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.leftAdEnabled?"已启用":"未启用"),3),s(x,{modelValue:r.leftAdEnabled,"onUpdate:modelValue":e[88]||(e[88]=a=>r.leftAdEnabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:e[89]||(e[89]=a=>de("leftAdEnabled")),class:"shadow"},{default:m(()=>e[280]||(e[280]=[v("保存")])),_:1})])]),t("div",nd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",id,[t("div",{class:n(["text-sm font-semibold mb-2",o.value.text])},"多广告（自动轮播）",2),t("div",{class:n(["text-xs mb-2",o.value.mutedText])},"若同时配置单条与多条，优先显示多条",2),t("div",dd,[(f(!0),b(ue,null,ce(r.leftAds,(a,R)=>(f(),b("div",{key:R,class:n(["rounded-md border p-3",o.value.border])},[t("div",rd,[t("div",{class:n(["text-sm",o.value.text])},"广告 #"+y(R+1),3),t("div",ud,[s(i,{size:"xs",color:"red",variant:"soft",onClick:H=>r.leftAds.splice(R,1)},{default:m(()=>e[281]||(e[281]=[v("删除")])),_:2},1032,["onClick"])])]),t("div",cd,[s(C,{modelValue:a.imageURL,"onUpdate:modelValue":H=>a.imageURL=H,placeholder:"海报图片 URL"},null,8,["modelValue","onUpdate:modelValue"]),s(C,{modelValue:a.linkURL,"onUpdate:modelValue":H=>a.linkURL=H,placeholder:"跳转链接"},null,8,["modelValue","onUpdate:modelValue"]),s(Z,{modelValue:a.description,"onUpdate:modelValue":H=>a.description=H,placeholder:"描述文本（可选）",class:"md:col-span-2"},null,8,["modelValue","onUpdate:modelValue"])])],2))),128)),t("div",md,[t("div",pd,[s(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:e[90]||(e[90]=a=>r.leftAds.push({imageURL:"",linkURL:"",description:""}))},{default:m(()=>e[282]||(e[282]=[v("新增广告")])),_:1}),s(i,{size:"sm",color:"gray",variant:"soft",class:"shadow",onClick:_s},{default:m(()=>e[283]||(e[283]=[v("重置为默认")])),_:1})]),t("div",vd,[t("span",{class:n(["text-sm",o.value.mutedText])},"轮播间隔(ms)",2),s(C,{modelValue:r.leftAdsIntervalMs,"onUpdate:modelValue":e[91]||(e[91]=a=>r.leftAdsIntervalMs=a),modelModifiers:{number:!0},type:"number",class:"w-28"},null,8,["modelValue"])])])])]),t("div",gd,[s(i,{color:"primary",class:"shadow",onClick:e[92]||(e[92]=a=>de("leftAds"))},{default:m(()=>e[284]||(e[284]=[v("保存广告配置")])),_:1})])],2)])],2)]),t("div",fd,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",bd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-sparkles",class:"w-5 h-5"}),e[285]||(e[285]=t("span",null,"随机一言（Hitokoto）",-1))],2),t("div",wd,[s(x,{modelValue:r.hitokotoEnabled,"onUpdate:modelValue":e[93]||(e[93]=a=>r.hitokotoEnabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:e[94]||(e[94]=a=>de("hitokotoEnabled")),class:"shadow"},{default:m(()=>e[286]||(e[286]=[v("保存")])),_:1})])]),t("div",yd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[t("div",{class:n(["text-sm",o.value.mutedText])},"开启后，首页左栏广告位下方显示随机一言",2)],2)])],2)]),t("div",xd,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",hd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-link",class:"w-5 h-5"}),e[287]||(e[287]=t("span",null,"社交链接配置",-1))],2),t("div",kd,[s(i,{size:"sm",onClick:e[95]||(e[95]=a=>ve.socialLinks=!ve.socialLinks),color:ve.socialLinks?"gray":"green",variant:ve.socialLinks?"soft":"solid",class:"shadow"},{default:m(()=>[v(y(ve.socialLinks?"取消":"编辑"),1)]),_:1},8,["color","variant"]),s(i,{color:"green",class:"shadow",onClick:Ls},{default:m(()=>e[288]||(e[288]=[v("保存")])),_:1})])]),t("div",Cd,[t("div",{class:n(["rounded-lg p-4",o.value.subtleBg])},[ve.socialLinks?(f(),b("div",Vd,[(f(!0),b(ue,null,ce(r.socialLinks,(a,R)=>(f(),b("div",{key:R,class:n(["rounded-md border p-3",o.value.border])},[t("div",Ud,[s(C,{modelValue:a.name,"onUpdate:modelValue":H=>a.name=H,placeholder:"名称"},null,8,["modelValue","onUpdate:modelValue"]),s(C,{modelValue:a.url,"onUpdate:modelValue":H=>a.url=H,placeholder:"链接 URL"},null,8,["modelValue","onUpdate:modelValue"]),s(C,{modelValue:a.icon,"onUpdate:modelValue":H=>a.icon=H,placeholder:"图标名称(可选)"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ed,[s(i,{size:"xs",color:"red",variant:"soft",onClick:H=>Ts(R)},{default:m(()=>e[289]||(e[289]=[v("删除")])),_:2},1032,["onClick"])])],2))),128)),t("div",Td,[s(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:Es},{default:m(()=>e[290]||(e[290]=[v("新增链接")])),_:1})])])):(f(),b("div",{key:1,class:n(["text-sm",o.value.mutedText])},"共有 "+y((r.socialLinks||[]).length)+" 条社交链接",3))],2)])],2)]),t("div",Ld,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",Sd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-link",class:"w-5 h-5"}),e[291]||(e[291]=t("span",null,"友链配置",-1))],2),t("div",Ad,[s(i,{size:"sm",color:"indigo",variant:"soft",class:"shadow",onClick:e[96]||(e[96]=a=>r.friendLinks.push({title:"",link:"",icon:"",description:""}))},{default:m(()=>e[292]||(e[292]=[v("新增友链")])),_:1}),s(i,{color:"primary",class:"shadow",onClick:e[97]||(e[97]=a=>de("friendLinks"))},{default:m(()=>e[293]||(e[293]=[v("保存")])),_:1})])]),t("div",Bd,[t("div",{class:n(["rounded-lg p-4 space-y-3",o.value.subtleBg])},[(f(!0),b(ue,null,ce(r.friendLinks,(a,R)=>(f(),b("div",{key:R,class:n(["rounded-md border p-3 space-y-2",o.value.border])},[t("div",$d,[t("div",{class:n(["text-sm",o.value.text])},"友链 #"+y(R+1),3),s(i,{size:"xs",color:"red",variant:"soft",onClick:H=>r.friendLinks.splice(R,1)},{default:m(()=>e[294]||(e[294]=[v("删除")])),_:2},1032,["onClick"])]),t("div",Rd,[s(C,{modelValue:a.title,"onUpdate:modelValue":H=>a.title=H,placeholder:"网站标题"},null,8,["modelValue","onUpdate:modelValue"]),s(C,{modelValue:a.link,"onUpdate:modelValue":H=>a.link=H,placeholder:"链接 (http/https)"},null,8,["modelValue","onUpdate:modelValue"]),s(C,{modelValue:a.icon,"onUpdate:modelValue":H=>a.icon=H,placeholder:"图标名称 (如 i-mdi-github，可选)"},null,8,["modelValue","onUpdate:modelValue"]),s(Z,{modelValue:a.description,"onUpdate:modelValue":H=>a.description=H,placeholder:"网站介绍 (可选)",class:"md:col-span-2"},null,8,["modelValue","onUpdate:modelValue"])])],2))),128))],2)])],2)])])],2)]),t("div",jd,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",Pd,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-chat-bubble-left-right",class:"w-5 h-5"}),e[295]||(e[295]=t("span",{class:"whitespace-nowrap"},"评论系统",-1))],2),t("div",Id,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.commentEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.commentEnabled?"已启用":"未启用"),3),s(x,{modelValue:r.commentEnabled,"onUpdate:modelValue":e[98]||(e[98]=a=>r.commentEnabled=a)},null,8,["modelValue"]),t("div",Dd,[t("span",{class:n(["text-sm",o.value.mutedText])},"邮件通知",2),s(x,{modelValue:r.commentEmailEnabled,"onUpdate:modelValue":e[99]||(e[99]=a=>r.commentEmailEnabled=a),disabled:!r.commentEnabled},null,8,["modelValue","disabled"])]),t("div",Hd,[t("span",{class:n(["text-sm",o.value.mutedText])},"仅登录后评论",2),s(x,{modelValue:r.commentLoginRequired,"onUpdate:modelValue":e[100]||(e[100]=a=>r.commentLoginRequired=a),disabled:!r.commentEnabled},null,8,["modelValue","disabled"])]),s(i,{color:"green",onClick:kl,class:"shadow"},{default:m(()=>e[296]||(e[296]=[v("保存")])),_:1})])]),t("div",_d,[s(bo,{config:r,"onUpdate:config":e[101]||(e[101]=a=>r=a),theme:o.value,onCommentSystemChanged:e[102]||(e[102]=a=>tl.value=a)},null,8,["config","theme"]),Se.value&&r.commentEnabled&&String(tl.value||r.commentSystem).toLowerCase()==="builtin"?(f(),b("div",{key:0,class:n(["mt-4 rounded-lg p-3",o.value.subtleBg])},[t("div",Md,[s(C,{modelValue:Ht.value,"onUpdate:modelValue":e[103]||(e[103]=a=>Ht.value=a),placeholder:"搜索评论内容/昵称/邮箱/网址",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"primary",variant:"soft",onClick:Vl},{default:m(()=>e[297]||(e[297]=[v("搜索")])),_:1}),s(i,{variant:"soft",color:De.value?"gray":"indigo",onClick:As},{default:m(()=>[v(y(De.value?"折叠":"展开"),1)]),_:1},8,["color"])]),De.value?(f(),b("div",zd,[(f(!0),b(ue,null,ce(it.value,a=>(f(),b("div",{key:a.id,class:n(["rounded border px-3 py-2",o.value.border])},[t("div",Nd,[t("div",{class:n(["text-sm truncate",o.value.text])},"#"+y(a.id)+" · "+y(a.nick||"匿名")+" · "+y(Ss(a.created_at)),3),s(i,{size:"xs",variant:"ghost",color:ll(a)?"gray":"primary",onClick:R=>Bs(a)},{default:m(()=>[v(y(ll(a)?"收起":"展开"),1)]),_:2},1032,["color","onClick"])]),t("div",{class:n(["mt-1 text-sm truncate",o.value.text])},y(a.content),3),ll(a)?(f(),b("div",Od,[t("div",null,[t("span",{class:n(o.value.mutedText)},"消息ID",2),e[298]||(e[298]=v("：")),t("span",{class:n(o.value.text)},y(a.message_id),3)]),t("div",null,[t("span",{class:n(o.value.mutedText)},"父评论ID",2),e[299]||(e[299]=v("：")),t("span",{class:n(o.value.text)},y(a.parent_id||0),3)]),t("div",null,[t("span",{class:n(o.value.mutedText)},"邮箱",2),e[300]||(e[300]=v("：")),t("span",{class:n(o.value.text)},y(a.mail||"-"),3)]),t("div",Wd,[t("span",{class:n(o.value.mutedText)},"网址",2),e[301]||(e[301]=v("：")),a.link?(f(),b("a",{key:0,href:a.link,target:"_blank",rel:"noopener",class:"underline"},y(a.link),9,Fd)):(f(),b("span",{key:1,class:n(o.value.text)},"-",2))]),t("div",qd,[s(i,{color:"red",variant:"soft",onClick:R=>Ps(a)},{default:m(()=>e[302]||(e[302]=[v("删除该评论")])),_:2},1032,["onClick"])])])):$("",!0)],2))),128)),_t.value?(f(),b("div",Kd,[s(i,{variant:"soft",onClick:$s},{default:m(()=>e[303]||(e[303]=[v("加载更多")])),_:1})])):$("",!0)])):$("",!0)],2)):$("",!0)])],2),s(ge,{modelValue:Mt.value,"onUpdate:modelValue":e[105]||(e[105]=a=>Mt.value=a),ui:{width:"sm:max-w-md"}},{default:m(()=>[s(Ve,null,{header:m(()=>[t("div",Gd,[e[304]||(e[304]=t("h3",{class:"text-lg font-medium"},"再次确认删除",-1)),s(i,{color:"gray",variant:"ghost",icon:"i-mdi-close",class:"-my-1",onClick:sl})])]),footer:m(()=>[t("div",tr,[s(i,{color:"gray",variant:"outline",onClick:sl},{default:m(()=>e[307]||(e[307]=[v("取消")])),_:1}),s(i,{color:"red",disabled:!rt.value,onClick:Is},{default:m(()=>e[308]||(e[308]=[v("确认删除")])),_:1},8,["disabled"])])]),default:m(()=>{var a,R,H;return[t("div",Jd,[e[306]||(e[306]=t("div",{class:"text-sm"},"此操作不可恢复，确认删除该评论？",-1)),t("div",Xd,"评论ID："+y((a=Ke.value)==null?void 0:a.id),1),t("div",Yd,"消息ID："+y((R=Ke.value)==null?void 0:R.message_id),1),t("div",Zd,"昵称："+y(((H=Ke.value)==null?void 0:H.nick)||"匿名"),1),t("div",Qd,"内容片段："+y(js.value),1),t("label",er,[qt(t("input",{type:"checkbox","onUpdate:modelValue":e[104]||(e[104]=xe=>rt.value=xe)},null,512),[[va,rt.value]]),e[305]||(e[305]=v(" 我已知晓此操作不可恢复 "))])])]}),_:1})]),_:1},8,["modelValue"])]),t("div",{class:n(["mx-4 my-2 border-t",o.value.border])},null,2),Se.value?(f(),b("div",lr,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",sr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-envelope",class:"w-5 h-5"}),e[309]||(e[309]=t("span",null,"邮件设置（SMTP）",-1))],2),t("div",ar,[s(x,{modelValue:g.enabled,"onUpdate:modelValue":e[106]||(e[106]=a=>g.enabled=a)},null,8,["modelValue"]),s(i,{color:"green",onClick:me,class:"shadow"},{default:m(()=>e[310]||(e[310]=[v("保存")])),_:1})])]),t("div",or,[t("div",{class:n(["rounded-lg p-4 space-y-4",o.value.subtleBg])},[t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"地址",2),s(C,{modelValue:g.from,"onUpdate:modelValue":e[107]||(e[107]=a=>g.from=a),placeholder:"发件地址，如 name@example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm font-medium mb-2",o.value.text])},"驱动",2),s(re,{modelValue:g.driver,"onUpdate:modelValue":e[108]||(e[108]=a=>g.driver=a),options:["smtp"]},null,8,["modelValue"])]),t("div",{class:n(["text-sm font-semibold mt-1 mb-2",o.value.text])},"SMTP 设置",2),t("div",nr,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"主机",2),s(C,{modelValue:g.host,"onUpdate:modelValue":e[109]||(e[109]=a=>g.host=a),placeholder:"smtp.example.com"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"端口",2),s(C,{modelValue:g.port,"onUpdate:modelValue":e[110]||(e[110]=a=>g.port=a),placeholder:"465 或 587"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"加密协议（小写 ssl 或 tls）",2),s(re,{modelValue:g.encryption,"onUpdate:modelValue":e[111]||(e[111]=a=>g.encryption=a),options:["ssl","tls"]},null,8,["modelValue"])]),e[311]||(e[311]=t("div",{class:"md:col-span-1"},null,-1)),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"用户名",2),s(C,{modelValue:g.user,"onUpdate:modelValue":e[112]||(e[112]=a=>g.user=a),placeholder:"通常与发件地址一致"},null,8,["modelValue"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"密码",2),s(C,{modelValue:g.pass,"onUpdate:modelValue":e[113]||(e[113]=a=>g.pass=a),type:be.value?"text":"password",placeholder:"邮箱或应用专用密码"},null,8,["modelValue","type"])])]),t("div",{class:n(["flex items-center justify-between mt-2",o.value.mutedText])},[t("span",ir,"使用上述设置发送测试邮件到："+y(g.from||g.user||"请先填写地址"),1),s(i,{disabled:!(g.from||g.user),loading:Pe.value,color:"primary",onClick:Qe},{default:m(()=>e[312]||(e[312]=[v("发送测试邮件")])),_:1},8,["disabled","loading"])],2),t("div",dr,[s(i,{variant:"soft",color:"gray",onClick:we},{default:m(()=>e[313]||(e[313]=[v("刷新")])),_:1}),s(i,{color:"green",onClick:me},{default:m(()=>e[314]||(e[314]=[v("保存")])),_:1})])],2)])],2)])):$("",!0),Se.value?(f(),b("div",rr,[t("div",{class:n([o.value.cardBg,o.value.border,Me])},[t("div",ur,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-shield-check",class:"w-5 h-5"}),e[315]||(e[315]=t("span",null,"用户管理",-1))],2)]),t("div",cr,[t("div",{class:n(["rounded-lg p-3 mb-3",o.value.subtleBg])},[t("div",mr,[s(C,{modelValue:vt.value,"onUpdate:modelValue":e[114]||(e[114]=a=>vt.value=a),placeholder:"搜索用户名或ID",class:"flex-1"},null,8,["modelValue"]),s(i,{color:"primary",variant:"soft",onClick:ft},{default:m(()=>e[316]||(e[316]=[v("搜索")])),_:1}),s(i,{variant:"soft",color:"gray",onClick:ft},{default:m(()=>e[317]||(e[317]=[v("刷新")])),_:1}),s(i,{variant:"soft",color:Ne.value?"gray":"indigo",onClick:e[115]||(e[115]=a=>Ne.value=!Ne.value)},{default:m(()=>[v(y(Ne.value?"折叠":"展开"),1)]),_:1},8,["color"])])],2),Ne.value?(f(),b("div",{key:0,class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",pr,[(f(!0),b(ue,null,ce(Ut.value,a=>(f(),b("div",{key:a.id??a.ID,class:n(["rounded border px-3 py-2",o.value.border])},[t("div",vr,[s(te,{color:"gray",variant:"soft"},{default:m(()=>[v("#"+y(a.id??a.ID),1)]),_:2},1024),t("span",{class:n(["truncate",o.value.text])},y(a.username??a.Username),3),s(te,{color:a.is_admin??a.IsAdmin?"primary":"gray",variant:"subtle"},{default:m(()=>[v(y(a.is_admin??a.IsAdmin?"管理员":"普通"),1)]),_:2},1032,["color"]),e[318]||(e[318]=t("div",{class:"flex-1"},null,-1)),s(i,{size:"xs",variant:"ghost",color:Ce(a)?"gray":"primary",onClick:R=>Oe(a)},{default:m(()=>[v(y(Ce(a)?"收起":"展开"),1)]),_:2},1032,["color","onClick"])]),t("div",gr,[s(i,{color:a.is_admin??a.IsAdmin?"orange":"green",variant:a.is_admin??a.IsAdmin?"soft":"solid",class:"shadow",onClick:R=>ie(a)},{default:m(()=>[v(y(a.is_admin??a.IsAdmin?"取消管理员":"设为管理员"),1)]),_:2},1032,["color","variant","onClick"]),s(i,{color:"red",variant:"soft",class:"shadow",onClick:R=>Ze(a)},{default:m(()=>e[319]||(e[319]=[v("删除")])),_:2},1032,["onClick"])]),Ce(a)?(f(),b("div",{key:0,class:n(["mt-3 rounded p-3",o.value.subtleBg])},[t("div",fr,[t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"用户ID",2),t("div",{class:n(o.value.text)},y(a.id??a.ID),3)]),t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"用户名",2),t("div",{class:n(o.value.text)},y(a.username??a.Username),3)]),t("div",null,[t("div",{class:n(["text-xs",o.value.mutedText])},"角色",2),t("div",{class:n(o.value.text)},y(a.is_admin??a.IsAdmin?"管理员":"普通用户"),3)])]),t("div",br,[t("div",{class:n(["text-sm mb-1",o.value.text])},"重置密码",2),t("div",wr,[s(C,{modelValue:Le.password[a.id??a.ID],"onUpdate:modelValue":R=>Le.password[a.id??a.ID]=R,type:Re.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","type"]),s(i,{icon:Re.value?"i-heroicons-eye-slash":"i-heroicons-eye",color:"gray",variant:"ghost",onClick:e[116]||(e[116]=R=>Re.value=!Re.value)},null,8,["icon"]),s(i,{disabled:!Xe(a),color:"primary",onClick:R=>Ye(a)},{default:m(()=>e[320]||(e[320]=[v("保存")])),_:2},1032,["disabled","onClick"])])])],2)):$("",!0)],2))),128))])],2)):$("",!0)])],2)])):$("",!0),s(ge,{modelValue:Te.value,"onUpdate:modelValue":e[120]||(e[120]=a=>Te.value=a)},{default:m(()=>[s(Ve,null,{default:m(()=>[e[323]||(e[323]=t("div",{class:"font-semibold mb-2"},"重置管理员密码",-1)),t("div",yr,[t("div",xr,[s(C,{modelValue:S.newPass,"onUpdate:modelValue":e[117]||(e[117]=a=>S.newPass=a),type:$e.value?"text":"password",placeholder:"新密码",class:"flex-1"},null,8,["modelValue","type"]),s(te,{color:E.value,variant:"soft"},{default:m(()=>[v(y(_.value),1)]),_:1},8,["color"])]),t("div",hr,[s(C,{modelValue:S.confirmPass,"onUpdate:modelValue":e[118]||(e[118]=a=>S.confirmPass=a),type:$e.value?"text":"password",placeholder:"确认新密码",class:"flex-1"},null,8,["modelValue","type"])]),t("div",kr,[s(i,{variant:"ghost",color:"gray",onClick:e[119]||(e[119]=a=>Te.value=!1)},{default:m(()=>e[321]||(e[321]=[v("取消")])),_:1}),s(i,{disabled:!pe.value,color:"primary",onClick:Xt},{default:m(()=>e[322]||(e[322]=[v("保存")])),_:1},8,["disabled"])])])]),_:1})]),_:1},8,["modelValue"]),Se.value?(f(),b("div",Cr,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Vr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-bell-alert",class:"w-5 h-5"}),e[324]||(e[324]=t("span",null,"推送配置",-1))],2),t("div",Ur,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.notifyEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.notifyEnabled?"已启用":"未启用"),3),s(ye,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[121]||(e[121]=a=>r.notifyEnabled=a),color:"primary",size:"lg"},null,8,["modelValue"]),t("div",Er,[s(h,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[122]||(e[122]=a=>r.notifyEnabled=a),value:!0},null,8,["modelValue"]),t("span",{class:n(r.notifyEnabled?o.value.text:"text-gray-400")},"开启",2),s(h,{modelValue:r.notifyEnabled,"onUpdate:modelValue":e[123]||(e[123]=a=>r.notifyEnabled=a),value:!1},null,8,["modelValue"]),t("span",{class:n(r.notifyEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",Tr,[s(mo,{config:he(ae),"onUpdate:config":e[124]||(e[124]=a=>ga(ae)?ae.value=a:ae=a),immediate:!0,subtleBg:o.value.subtleBg,text:o.value.text,mutedText:o.value.mutedText,disabled:!r.notifyEnabled},null,8,["config","subtleBg","text","mutedText","disabled"])])],2)])):$("",!0),Se.value?(f(),b("div",Lr,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Sr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-mdi-github",class:"w-5 h-5"}),e[325]||(e[325]=t("span",null,"GitHub 登录",-1))],2),t("div",Ar,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([r.githubOAuthEnabled?"text-green-400":"text-red-400","text-sm"])},y(r.githubOAuthEnabled?"已启用":"未启用"),3),s(ye,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[125]||(e[125]=a=>r.githubOAuthEnabled=a),color:"primary",size:"lg"},null,8,["modelValue"]),s(x,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[126]||(e[126]=a=>r.githubOAuthEnabled=a)},null,8,["modelValue"]),t("div",Br,[s(h,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[127]||(e[127]=a=>r.githubOAuthEnabled=a),value:!0},null,8,["modelValue"]),t("span",{class:n(r.githubOAuthEnabled?o.value.text:"text-gray-400")},"开启",2),s(h,{modelValue:r.githubOAuthEnabled,"onUpdate:modelValue":e[128]||(e[128]=a=>r.githubOAuthEnabled=a),value:!1},null,8,["modelValue"]),t("span",{class:n(r.githubOAuthEnabled?"text-gray-400":o.value.text)},"关闭",2)])])]),t("div",$r,[t("div",Rr,[t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client ID",2),s(C,{modelValue:r.githubClientId,"onUpdate:modelValue":e[129]||(e[129]=a=>r.githubClientId=a),placeholder:"GitHub OAuth App Client ID",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",null,[t("div",{class:n(["text-sm mb-2",o.value.text])},"Client Secret",2),s(C,{modelValue:r.githubClientSecret,"onUpdate:modelValue":e[130]||(e[130]=a=>r.githubClientSecret=a),type:"password",placeholder:"GitHub OAuth App Client Secret",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])]),t("div",jr,[t("div",{class:n(["text-sm mb-2",o.value.text])},"回调地址",2),s(C,{modelValue:r.githubCallbackURL,"onUpdate:modelValue":e[131]||(e[131]=a=>r.githubCallbackURL=a),placeholder:"例如 https://your.domain.com/oauth/github/callback",disabled:!r.githubOAuthEnabled},null,8,["modelValue","disabled"])])]),t("div",Pr,[s(i,{variant:"soft",color:"gray",onClick:qe},{default:m(()=>e[326]||(e[326]=[v("刷新")])),_:1}),s(i,{color:"green",onClick:Ms},{default:m(()=>e[327]||(e[327]=[v("保存")])),_:1}),s(i,{color:"primary",onClick:et},{default:m(()=>e[328]||(e[328]=[v("测试")])),_:1})]),t("div",{class:n(["text-xs",o.value.mutedText])},"默认不开启，开启后登录页显示“GitHub 一键登录”按钮",2)])],2)])):$("",!0),Se.value?(f(),b("div",Ir,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[s(Oo,{theme:o.value},null,8,["theme"])],2)])):$("",!0),Se.value?(f(),b("div",Dr,[t("div",{class:n(["rounded-xl border shadow-xl",[o.value.cardBg,o.value.border]])},[t("div",Hr,[t("div",{class:n(["font-semibold flex items-center gap-2",o.value.text])},[s(d,{name:"i-heroicons-circle-stack",class:"w-5 h-5 text-indigo-300"}),e[329]||(e[329]=t("span",null,"本地数据库管理配置",-1)),t("span",{class:n(["ml-2 text-xs px-2 py-1 rounded",o.value.subtleBg])},"当前 DB："+y(Js.value),3)],2),t("div",_r,[s(i,{color:"primary",icon:"i-heroicons-arrow-down-tray",disabled:ut.value!=="sqlite",onClick:Xs},{default:m(()=>e[330]||(e[330]=[v("下载本地备份")])),_:1},8,["disabled"]),s(i,{color:"warning",variant:"soft",icon:"i-heroicons-arrow-up-tray",disabled:ut.value!=="sqlite",onClick:Ys},{default:m(()=>e[331]||(e[331]=[v("恢复本地数据库")])),_:1},8,["disabled"]),t("input",{type:"file",ref_key:"databaseFileInput",ref:kt,accept:".zip",class:"hidden",onChange:Tl},null,544)])]),t("div",Mr,[t("div",{class:n(["text-yellow-400 text-sm rounded p-2",o.value.subtleBg])},"🔔：仅针对 SQLite 本地数据库；"+y(ut.value!=="sqlite"?"当前为云/外部数据库，请在服务端操作":"可在此下载与恢复本地备份"),3),t("input",{type:"file",ref_key:"databaseFileInput",ref:kt,accept:".zip",class:"hidden",onChange:Tl},null,544),t("div",{class:n(["rounded-lg p-3",o.value.subtleBg])},[t("div",{class:n(["font-semibold mb-2 flex items-center justify-between",o.value.text])},[e[332]||(e[332]=t("span",null,"云存储接入（R2/S3）",-1)),t("div",zr,[t("span",{class:n(["text-sm",o.value.mutedText])},"状态",2),t("span",{class:n([ee.value?"text-green-400":"text-red-400","text-sm"])},y(ee.value?"已启用":"未启用"),3),s(ye,{modelValue:ee.value,"onUpdate:modelValue":e[132]||(e[132]=a=>ee.value=a)},null,8,["modelValue"]),t("div",Nr,[s(h,{modelValue:ee.value,"onUpdate:modelValue":e[133]||(e[133]=a=>ee.value=a),value:!0},null,8,["modelValue"]),t("span",{class:n(ee.value?o.value.text:"text-gray-400")},"开启",2),s(h,{modelValue:ee.value,"onUpdate:modelValue":e[134]||(e[134]=a=>ee.value=a),value:!1},null,8,["modelValue"]),t("span",{class:n(ee.value?"text-gray-400":o.value.text)},"关闭",2)])])],2),t("div",Or,[t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"提供方",2),s(re,{modelValue:A.provider,"onUpdate:modelValue":e[135]||(e[135]=a=>A.provider=a),options:[{label:"S3",value:"s3"},{label:"R2",value:"r2"}],disabled:!ee.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Endpoint",2),s(C,{modelValue:A.endpoint,"onUpdate:modelValue":e[136]||(e[136]=a=>A.endpoint=a),placeholder:"https://...",disabled:!ee.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Region",2),s(C,{modelValue:A.region,"onUpdate:modelValue":e[137]||(e[137]=a=>A.region=a),placeholder:"auto 或区域名",disabled:!ee.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Bucket",2),s(C,{modelValue:A.bucket,"onUpdate:modelValue":e[138]||(e[138]=a=>A.bucket=a),placeholder:"bucket 名称",disabled:!ee.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Access Key",2),s(C,{modelValue:A.accessKey,"onUpdate:modelValue":e[139]||(e[139]=a=>A.accessKey=a),disabled:!ee.value},null,8,["modelValue","disabled"])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"Secret Key",2),s(C,{modelValue:A.secretKey,"onUpdate:modelValue":e[140]||(e[140]=a=>A.secretKey=a),type:"password",disabled:!ee.value},null,8,["modelValue","disabled"])]),A.provider==="s3"?(f(),b("div",Wr,[t("span",{class:n(["text-sm",o.value.mutedText])},"使用路径风格地址",2),s(ye,{modelValue:A.usePathStyle,"onUpdate:modelValue":e[141]||(e[141]=a=>A.usePathStyle=a),disabled:!ee.value},null,8,["modelValue","disabled"])])):$("",!0),t("div",Fr,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"公共访问前缀",2),s(C,{modelValue:A.publicBaseURL,"onUpdate:modelValue":e[142]||(e[142]=a=>A.publicBaseURL=a),placeholder:"https://bucket.example.com/",disabled:!ee.value},null,8,["modelValue","disabled"])])]),t("div",qr,[s(i,{variant:"soft",color:"gray",onClick:cl},{default:m(()=>e[333]||(e[333]=[v("刷新")])),_:1}),s(i,{color:"green",onClick:Qs},{default:m(()=>e[334]||(e[334]=[v("保存")])),_:1})]),t("div",Kr,[t("div",Gr,[t("div",Jr,[t("span",{class:n(["text-sm",o.value.mutedText])},"自动同步至云端",2),s(ye,{modelValue:lt.value,"onUpdate:modelValue":e[143]||(e[143]=a=>lt.value=a),disabled:!(ee.value&&A.provider&&A.endpoint&&A.bucket&&A.accessKey&&A.secretKey)},null,8,["modelValue","disabled"])]),t("div",Xr,[t("span",{class:n(["text-sm",o.value.mutedText])},"模式",2),s(re,{modelValue:Ct.value,"onUpdate:modelValue":e[144]||(e[144]=a=>Ct.value=a),options:[{label:"即时",value:"instant"},{label:"定时",value:"scheduled"}],disabled:!lt.value||!(ee.value&&A.provider&&A.endpoint&&A.bucket&&A.accessKey&&A.secretKey)},null,8,["modelValue","disabled"])]),Ct.value==="scheduled"?(f(),b("div",Yr,[t("span",{class:n(["text-sm",o.value.mutedText])},"间隔(分钟)",2),s(C,{modelValue:Nt.value,"onUpdate:modelValue":e[145]||(e[145]=a=>Nt.value=a),modelModifiers:{number:!0},type:"number",min:"1",class:"w-24",disabled:!lt.value||!(ee.value&&A.provider&&A.endpoint&&A.bucket&&A.accessKey&&A.secretKey)},null,8,["modelValue","disabled"])])):$("",!0),t("div",Zr,[t("span",{class:n(["text-sm",o.value.mutedText])},"上次同步",2),t("span",{class:n(["text-sm",o.value.text])},y(Ll.value||"—"),3),s(i,{color:"primary",disabled:!lt.value||!(ee.value&&A.provider&&A.endpoint&&A.bucket&&A.accessKey&&A.secretKey),onClick:ea},{default:m(()=>e[335]||(e[335]=[v("立即同步")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"上传URL（预签名）",2),t("div",Qr,[s(C,{modelValue:Ot.value,"onUpdate:modelValue":e[146]||(e[146]=a=>Ot.value=a),placeholder:"粘贴R2/S3预签名上传URL",class:"flex-1"},null,8,["modelValue"]),s(i,{disabled:!ee.value,onClick:sa},{default:m(()=>e[336]||(e[336]=[v("生成")])),_:1},8,["disabled"])])]),t("div",null,[t("label",{class:n(["text-sm mb-1 block",o.value.mutedText])},"下载URL（预签名）",2),t("div",eu,[s(C,{modelValue:Wt.value,"onUpdate:modelValue":e[147]||(e[147]=a=>Wt.value=a),placeholder:"粘贴R2/S3预签名下载URL",class:"flex-1"},null,8,["modelValue"]),s(i,{disabled:!ee.value,onClick:aa},{default:m(()=>e[337]||(e[337]=[v("生成")])),_:1},8,["disabled"])])])]),t("div",tu,[s(i,{color:"primary",onClick:ta},{default:m(()=>e[338]||(e[338]=[v("上传备份到云")])),_:1}),s(i,{color:"warning",onClick:la},{default:m(()=>e[339]||(e[339]=[v("从云恢复备份")])),_:1}),s(i,{color:"blue",variant:"solid",disabled:!ee.value||!A.publicBaseURL,onClick:oa},{default:m(()=>e[340]||(e[340]=[v("按配置恢复")])),_:1},8,["disabled"])])],2)])],2)])):$("",!0)])],2),qt(t("div",{class:n(["flex fixed bottom-0 left-0 right-0 md:left-72 z-50 border-t px-3 py-3 justify-between items-center backdrop-blur-md shadow-xl",[o.value.bottomBg,o.value.border]])},[s(i,{icon:"i-heroicons-arrow-left",color:u.value==="light"?"gray":u.value==="midnight"?"blue":u.value==="slate"?"slate":"gray",variant:u.value==="light"?"soft":"solid",onClick:e[148]||(e[148]=a=>l.$router.push("/")),class:"shadow ring-1 ring-inset ring-slate-400/30 transition hover:opacity-90"},{default:m(()=>e[341]||(e[341]=[v(" 返回首页 ")])),_:1},8,["color","variant"]),Et.value?(f(),b("div",lu,[s(i,{icon:"i-heroicons-power",color:"red",variant:"solid",onClick:wl,class:"shadow transition hover:opacity-90"},{default:m(()=>e[342]||(e[342]=[v(" 退出登录 ")])),_:1})])):(f(),b("div",su,[s(i,{color:"primary",onClick:e[149]||(e[149]=a=>{Tt.value=!0,We.value=!0})},{default:m(()=>e[343]||(e[343]=[v("登录")])),_:1}),s(i,{color:"secondary",onClick:e[150]||(e[150]=a=>{Tt.value=!0,We.value=!1})},{default:m(()=>e[344]||(e[344]=[v("注册")])),_:1})]))],2),[[fa,T.value]]),$("",!0)]),s(ge,{modelValue:Tt.value,"onUpdate:modelValue":e[196]||(e[196]=a=>Tt.value=a)},{default:m(()=>[t("div",{class:n(["p-6 rounded-lg",o.value.cardBg])},[t("h3",{class:n(["text-xl font-semibold mb-4",o.value.text])},y(We.value?"用户登录":"用户注册"),3),s(Q,{state:tt,class:"space-y-4"},{default:m(()=>[s(K,null,{default:m(()=>[s(C,{modelValue:tt.username,"onUpdate:modelValue":e[192]||(e[192]=a=>tt.username=a),placeholder:"用户名",class:"w-full"},null,8,["modelValue"])]),_:1}),s(K,null,{default:m(()=>[s(C,{modelValue:tt.password,"onUpdate:modelValue":e[193]||(e[193]=a=>tt.password=a),type:"password",placeholder:"密码",class:"w-full"},null,8,["modelValue"])]),_:1}),t("div",au,[s(i,{variant:"ghost",onClick:e[194]||(e[194]=a=>We.value=!We.value)},{default:m(()=>[v(y(We.value?"去注册":"去登录"),1)]),_:1}),s(i,{color:"primary",onClick:e[195]||(e[195]=a=>We.value?he(c)(tt):he(N)(tt))},{default:m(()=>[v(y(We.value?"登录":"注册"),1)]),_:1})])]),_:1},8,["state"])],2)]),_:1},8,["modelValue"]),s(ge,{modelValue:dl.value,"onUpdate:modelValue":e[197]||(e[197]=a=>dl.value=a)},{default:m(()=>[t("div",ou,[t("img",{src:El.value,class:"max-h-[70vh] w-auto mx-auto rounded"},null,8,nu)])]),_:1},8,["modelValue"]),t("input",{type:"file",ref_key:"bgFileInput",ref:wt,accept:"image/*",multiple:"",class:"hidden",onChange:zs},null,544)],2)}}}),du=vl(iu,[["__scopeId","data-v-db47fc4f"]]),fu=at({__name:"status",setup(p){const J=typeof document<"u"?Array.from(document.documentElement.classList):[];return Ue(()=>{if(typeof window>"u")return;const U=(localStorage.getItem("adminTheme")||"dark").toLowerCase(),u=document.documentElement;u.classList.remove("dark"),U!=="light"&&u.classList.add("dark")}),wa(()=>{if(typeof window>"u")return;const U=document.documentElement;Array.from(U.classList).forEach(u=>U.classList.remove(u)),J.forEach(u=>U.classList.add(u))}),(U,u)=>(f(),b(ue,null,[s(du),s(ka)],64))}});export{fu as default};
