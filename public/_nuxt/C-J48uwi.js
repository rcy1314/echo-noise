import{p as B,a3 as E,F as U,ai as V,L as M,k as T,r as p,M as F,c as A,O as G,P as n,Q as t,x as l,Z as O,a4 as R,v as L,a1 as P,a5 as z,T as w,a0 as H,h as o,X as k,S as J}from"./Cqtbhlpx.js";import{_ as Q,a as W}from"./ERbK3GVq.js";import{_ as X,a as Z}from"./C9baz-cf.js";import{_ as q}from"./DxWncjM2.js";import{s as K}from"./x_rD_Ya3.js";const Y={class:"fixed inset-0 bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-800"},ee={class:"relative z-10 flex min-h-screen items-center justify-center p-4"},te={class:"flex items-center justify-between mb-4"},oe={class:"flex items-center gap-2"},ae={class:"flex items-center gap-2"},se=["src"],ne={class:"flex justify-end"},le={class:"mt-2"},pe=B({__name:"register",setup(re){E();const b=U(),C=V(),u=M().public.baseApi||"/api",a=T({username:"",password:"",captcha:""}),m=p(!1),x=p(""),_=p(null),r=p(0);let i=null;const f=async()=>{try{x.value=`${u}/captcha?ts=${Date.now()}`,_.value=Date.now()+12e4,r.value=120,i&&clearInterval(i),i=K(()=>{const s=Math.max(0,Math.ceil(((_.value||Date.now())-Date.now())/1e3));r.value=s,s<=0&&clearInterval(i)},1e3)}catch{r.value=0}},S=async()=>{try{if(m.value=!0,!a.username||!a.password||!a.captcha)throw new Error("请完整填写用户名、密码与验证码");if((_.value||0)<Date.now())throw new Error("验证码已过期，请刷新后再提交");const s=await fetch(`${u}/register`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:a.username,password:a.password,captcha:a.captcha})}),e=await s.json().catch(()=>({}));if(!s.ok||e.code!==1)throw new Error((e==null?void 0:e.msg)||"注册失败");b.add({title:"注册成功",color:"green"}),C.push("/auth/login")}catch(s){b.add({title:"注册失败",description:s.message||"请稍后重试",color:"red"}),f()}finally{m.value=!1}},j=()=>{window.location.href=`${u}/oauth/github/login`};return F(()=>{f(),(async()=>{var s;try{const c=await(await fetch(`${u}/frontend/config`,{credentials:"include"})).json();!!((s=c==null?void 0:c.data)!=null&&s.allowRegistration)||(U().add({title:"提示",description:"站点已关闭用户注册",color:"orange"}),V().push("/auth/login"))}catch{}})()}),A(()=>{i&&clearInterval(i)}),(s,e)=>{const c=P,v=z,h=Q,g=Z,D=q,y=J,I=X,N=R,$=W;return L(),G(O,null,[n("div",Y,[e[6]||(e[6]=n("div",{class:"absolute inset-0 backdrop-blur-xl"},null,-1)),n("div",ee,[t(N,{class:"w-full max-w-md bg-slate-900/70 text-white border border-slate-700/40 shadow-2xl"},{default:l(()=>[n("div",te,[n("div",oe,[t(c,{name:"i-heroicons-user-plus",class:"w-6 h-6 text-indigo-300"}),e[3]||(e[3]=n("h1",{class:"text-lg font-semibold"},"注册",-1))]),t(v,{to:"/auth/login",class:"text-sm text-indigo-300 hover:text-indigo-200"},{default:l(()=>e[4]||(e[4]=[w("去登录")])),_:1})]),t(I,{onSubmit:H(S,["prevent"])},{default:l(()=>[t(g,{label:"用户名",class:"mb-3"},{default:l(()=>[t(h,{modelValue:o(a).username,"onUpdate:modelValue":e[0]||(e[0]=d=>o(a).username=d),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(g,{label:"密码",class:"mb-3"},{default:l(()=>[t(h,{modelValue:o(a).password,"onUpdate:modelValue":e[1]||(e[1]=d=>o(a).password=d),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(g,{label:"验证码",class:"mb-2"},{default:l(()=>[n("div",ae,[t(h,{modelValue:o(a).captcha,"onUpdate:modelValue":e[2]||(e[2]=d=>o(a).captcha=d),placeholder:"请输入验证码"},null,8,["modelValue"]),n("img",{src:o(x),onClick:f,class:"h-10 w-24 rounded border border-slate-700/40 cursor-pointer",alt:"captcha"},null,8,se),t(D,{color:o(r)>0?"primary":"red",variant:"soft"},{default:l(()=>[w(k(o(r)>0?`有效 ${o(r)}s`:"已过期"),1)]),_:1},8,["color"])])]),_:1}),n("div",ne,[t(y,{loading:o(m),disabled:o(r)<=0||o(m),type:"submit",color:"primary"},{default:l(()=>[w(k(o(r)>0?"注册":"验证码已过期"),1)]),_:1},8,["loading","disabled"])])]),_:1}),n("div",le,[t(y,{class:"w-full h-10 px-3 gap-2 justify-center font-medium bg-[#24292f] hover:bg-[#1f2328] text-white ring-1 ring-black/20",onClick:j},{default:l(()=>[t(c,{name:"i-mdi-github",class:"w-5 h-5"}),e[5]||(e[5]=n("span",null,"GitHub 一键注册/登录",-1))]),_:1})])]),_:1})])]),t($)],64)}}});export{pe as default};
